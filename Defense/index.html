<html><head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"/><title>Detecting Vulnerable-Flask-Application</title><style>
/* cspell:disable-file */
/* webkit printing magic: print all background colors */
html {
	-webkit-print-color-adjust: exact;
}
* {
	box-sizing: border-box;
	-webkit-print-color-adjust: exact;
}

html,
body {
	margin: 0;
	padding: 0;
}
@media only screen {
	body {
		margin: 2em auto;
		max-width: 900px;
		color: rgb(55, 53, 47);
	}
}

body {
	line-height: 1.5;
	white-space: pre-wrap;
}

a,
a.visited {
	color: inherit;
	text-decoration: underline;
}

.pdf-relative-link-path {
	font-size: 80%;
	color: #444;
}

h1,
h2,
h3 {
	letter-spacing: -0.01em;
	line-height: 1.2;
	font-weight: 600;
	margin-bottom: 0;
}

.page-title {
	font-size: 2.5rem;
	font-weight: 700;
	margin-top: 0;
	margin-bottom: 0.75em;
}

h1 {
	font-size: 1.875rem;
	margin-top: 1.875rem;
}

h2 {
	font-size: 1.5rem;
	margin-top: 1.5rem;
}

h3 {
	font-size: 1.25rem;
	margin-top: 1.25rem;
}

.source {
	border: 1px solid #ddd;
	border-radius: 3px;
	padding: 1.5em;
	word-break: break-all;
}

.callout {
	border-radius: 3px;
	padding: 1rem;
}

figure {
	margin: 1.25em 0;
	page-break-inside: avoid;
}

figcaption {
	opacity: 0.5;
	font-size: 85%;
	margin-top: 0.5em;
}

mark {
	background-color: transparent;
}

.indented {
	padding-left: 1.5em;
}

hr {
	background: transparent;
	display: block;
	width: 100%;
	height: 1px;
	visibility: visible;
	border: none;
	border-bottom: 1px solid rgba(55, 53, 47, 0.09);
}

img {
	max-width: 100%;
}

@media only print {
	img {
		max-height: 100vh;
		object-fit: contain;
	}
}

@page {
	margin: 1in;
}

.collection-content {
	font-size: 0.875rem;
}

.column-list {
	display: flex;
	justify-content: space-between;
}

.column {
	padding: 0 1em;
}

.column:first-child {
	padding-left: 0;
}

.column:last-child {
	padding-right: 0;
}

.table_of_contents-item {
	display: block;
	font-size: 0.875rem;
	line-height: 1.3;
	padding: 0.125rem;
}

.table_of_contents-indent-1 {
	margin-left: 1.5rem;
}

.table_of_contents-indent-2 {
	margin-left: 3rem;
}

.table_of_contents-indent-3 {
	margin-left: 4.5rem;
}

.table_of_contents-link {
	text-decoration: none;
	opacity: 0.7;
	border-bottom: 1px solid rgba(55, 53, 47, 0.18);
}

table,
th,
td {
	border: 1px solid rgba(55, 53, 47, 0.09);
	border-collapse: collapse;
}

table {
	border-left: none;
	border-right: none;
}

th,
td {
	font-weight: normal;
	padding: 0.25em 0.5em;
	line-height: 1.5;
	min-height: 1.5em;
	text-align: left;
}

th {
	color: rgba(55, 53, 47, 0.6);
}

ol,
ul {
	margin: 0;
	margin-block-start: 0.6em;
	margin-block-end: 0.6em;
}

li > ol:first-child,
li > ul:first-child {
	margin-block-start: 0.6em;
}

ul > li {
	list-style: disc;
}

ul.to-do-list {
	padding-inline-start: 0;
}

ul.to-do-list > li {
	list-style: none;
}

.to-do-children-checked {
	text-decoration: line-through;
	opacity: 0.375;
}

ul.toggle > li {
	list-style: none;
}

ul {
	padding-inline-start: 1.7em;
}

ul > li {
	padding-left: 0.1em;
}

ol {
	padding-inline-start: 1.6em;
}

ol > li {
	padding-left: 0.2em;
}

.mono ol {
	padding-inline-start: 2em;
}

.mono ol > li {
	text-indent: -0.4em;
}

.toggle {
	padding-inline-start: 0em;
	list-style-type: none;
}

/* Indent toggle children */
.toggle > li > details {
	padding-left: 1.7em;
}

.toggle > li > details > summary {
	margin-left: -1.1em;
}

.selected-value {
	display: inline-block;
	padding: 0 0.5em;
	background: rgba(206, 205, 202, 0.5);
	border-radius: 3px;
	margin-right: 0.5em;
	margin-top: 0.3em;
	margin-bottom: 0.3em;
	white-space: nowrap;
}

.collection-title {
	display: inline-block;
	margin-right: 1em;
}

.page-description {
    margin-bottom: 2em;
}

.simple-table {
	margin-top: 1em;
	font-size: 0.875rem;
	empty-cells: show;
}
.simple-table td {
	height: 29px;
	min-width: 120px;
}

.simple-table th {
	height: 29px;
	min-width: 120px;
}

.simple-table-header-color {
	background: rgb(247, 246, 243);
	color: black;
}
.simple-table-header {
	font-weight: 500;
}

time {
	opacity: 0.5;
}

.icon {
	display: inline-block;
	max-width: 1.2em;
	max-height: 1.2em;
	text-decoration: none;
	vertical-align: text-bottom;
	margin-right: 0.5em;
}

img.icon {
	border-radius: 3px;
}

.user-icon {
	width: 1.5em;
	height: 1.5em;
	border-radius: 100%;
	margin-right: 0.5rem;
}

.user-icon-inner {
	font-size: 0.8em;
}

.text-icon {
	border: 1px solid #000;
	text-align: center;
}

.page-cover-image {
	display: block;
	object-fit: cover;
	width: 100%;
	max-height: 30vh;
}

.page-header-icon {
	font-size: 3rem;
	margin-bottom: 1rem;
}

.page-header-icon-with-cover {
	margin-top: -0.72em;
	margin-left: 0.07em;
}

.page-header-icon img {
	border-radius: 3px;
}

.link-to-page {
	margin: 1em 0;
	padding: 0;
	border: none;
	font-weight: 500;
}

p > .user {
	opacity: 0.5;
}

td > .user,
td > time {
	white-space: nowrap;
}

input[type="checkbox"] {
	transform: scale(1.5);
	margin-right: 0.6em;
	vertical-align: middle;
}

p {
	margin-top: 0.5em;
	margin-bottom: 0.5em;
}

.image {
	border: none;
	margin: 1.5em 0;
	padding: 0;
	border-radius: 0;
	text-align: center;
}

.code,
code {
	background: rgba(135, 131, 120, 0.15);
	border-radius: 3px;
	padding: 0.2em 0.4em;
	border-radius: 3px;
	font-size: 85%;
	tab-size: 2;
}

code {
	color: #eb5757;
}

.code {
	padding: 1.5em 1em;
}

.code-wrap {
	white-space: pre-wrap;
	word-break: break-all;
}

.code > code {
	background: none;
	padding: 0;
	font-size: 100%;
	color: inherit;
}

blockquote {
	font-size: 1.25em;
	margin: 1em 0;
	padding-left: 1em;
	border-left: 3px solid rgb(55, 53, 47);
}

.bookmark {
	text-decoration: none;
	max-height: 8em;
	padding: 0;
	display: flex;
	width: 100%;
	align-items: stretch;
}

.bookmark-title {
	font-size: 0.85em;
	overflow: hidden;
	text-overflow: ellipsis;
	height: 1.75em;
	white-space: nowrap;
}

.bookmark-text {
	display: flex;
	flex-direction: column;
}

.bookmark-info {
	flex: 4 1 180px;
	padding: 12px 14px 14px;
	display: flex;
	flex-direction: column;
	justify-content: space-between;
}

.bookmark-image {
	width: 33%;
	flex: 1 1 180px;
	display: block;
	position: relative;
	object-fit: cover;
	border-radius: 1px;
}

.bookmark-description {
	color: rgba(55, 53, 47, 0.6);
	font-size: 0.75em;
	overflow: hidden;
	max-height: 4.5em;
	word-break: break-word;
}

.bookmark-href {
	font-size: 0.75em;
	margin-top: 0.25em;
}

.sans { font-family: ui-sans-serif, -apple-system, BlinkMacSystemFont, "Segoe UI Variable Display", "Segoe UI", Helvetica, "Apple Color Emoji", Arial, sans-serif, "Segoe UI Emoji", "Segoe UI Symbol"; }
.code { font-family: "SFMono-Regular", Menlo, Consolas, "PT Mono", "Liberation Mono", Courier, monospace; }
.serif { font-family: Lyon-Text, Georgia, ui-serif, serif; }
.mono { font-family: iawriter-mono, Nitti, Menlo, Courier, monospace; }
.pdf .sans { font-family: Inter, ui-sans-serif, -apple-system, BlinkMacSystemFont, "Segoe UI Variable Display", "Segoe UI", Helvetica, "Apple Color Emoji", Arial, sans-serif, "Segoe UI Emoji", "Segoe UI Symbol", 'Twemoji', 'Noto Color Emoji', 'Noto Sans CJK JP'; }
.pdf:lang(zh-CN) .sans { font-family: Inter, ui-sans-serif, -apple-system, BlinkMacSystemFont, "Segoe UI Variable Display", "Segoe UI", Helvetica, "Apple Color Emoji", Arial, sans-serif, "Segoe UI Emoji", "Segoe UI Symbol", 'Twemoji', 'Noto Color Emoji', 'Noto Sans CJK SC'; }
.pdf:lang(zh-TW) .sans { font-family: Inter, ui-sans-serif, -apple-system, BlinkMacSystemFont, "Segoe UI Variable Display", "Segoe UI", Helvetica, "Apple Color Emoji", Arial, sans-serif, "Segoe UI Emoji", "Segoe UI Symbol", 'Twemoji', 'Noto Color Emoji', 'Noto Sans CJK TC'; }
.pdf:lang(ko-KR) .sans { font-family: Inter, ui-sans-serif, -apple-system, BlinkMacSystemFont, "Segoe UI Variable Display", "Segoe UI", Helvetica, "Apple Color Emoji", Arial, sans-serif, "Segoe UI Emoji", "Segoe UI Symbol", 'Twemoji', 'Noto Color Emoji', 'Noto Sans CJK KR'; }
.pdf .code { font-family: Source Code Pro, "SFMono-Regular", Menlo, Consolas, "PT Mono", "Liberation Mono", Courier, monospace, 'Twemoji', 'Noto Color Emoji', 'Noto Sans Mono CJK JP'; }
.pdf:lang(zh-CN) .code { font-family: Source Code Pro, "SFMono-Regular", Menlo, Consolas, "PT Mono", "Liberation Mono", Courier, monospace, 'Twemoji', 'Noto Color Emoji', 'Noto Sans Mono CJK SC'; }
.pdf:lang(zh-TW) .code { font-family: Source Code Pro, "SFMono-Regular", Menlo, Consolas, "PT Mono", "Liberation Mono", Courier, monospace, 'Twemoji', 'Noto Color Emoji', 'Noto Sans Mono CJK TC'; }
.pdf:lang(ko-KR) .code { font-family: Source Code Pro, "SFMono-Regular", Menlo, Consolas, "PT Mono", "Liberation Mono", Courier, monospace, 'Twemoji', 'Noto Color Emoji', 'Noto Sans Mono CJK KR'; }
.pdf .serif { font-family: PT Serif, Lyon-Text, Georgia, ui-serif, serif, 'Twemoji', 'Noto Color Emoji', 'Noto Serif CJK JP'; }
.pdf:lang(zh-CN) .serif { font-family: PT Serif, Lyon-Text, Georgia, ui-serif, serif, 'Twemoji', 'Noto Color Emoji', 'Noto Serif CJK SC'; }
.pdf:lang(zh-TW) .serif { font-family: PT Serif, Lyon-Text, Georgia, ui-serif, serif, 'Twemoji', 'Noto Color Emoji', 'Noto Serif CJK TC'; }
.pdf:lang(ko-KR) .serif { font-family: PT Serif, Lyon-Text, Georgia, ui-serif, serif, 'Twemoji', 'Noto Color Emoji', 'Noto Serif CJK KR'; }
.pdf .mono { font-family: PT Mono, iawriter-mono, Nitti, Menlo, Courier, monospace, 'Twemoji', 'Noto Color Emoji', 'Noto Sans Mono CJK JP'; }
.pdf:lang(zh-CN) .mono { font-family: PT Mono, iawriter-mono, Nitti, Menlo, Courier, monospace, 'Twemoji', 'Noto Color Emoji', 'Noto Sans Mono CJK SC'; }
.pdf:lang(zh-TW) .mono { font-family: PT Mono, iawriter-mono, Nitti, Menlo, Courier, monospace, 'Twemoji', 'Noto Color Emoji', 'Noto Sans Mono CJK TC'; }
.pdf:lang(ko-KR) .mono { font-family: PT Mono, iawriter-mono, Nitti, Menlo, Courier, monospace, 'Twemoji', 'Noto Color Emoji', 'Noto Sans Mono CJK KR'; }
.highlight-default {
	color: rgba(55, 53, 47, 1);
}
.highlight-gray {
	color: rgba(120, 119, 116, 1);
	fill: rgba(120, 119, 116, 1);
}
.highlight-brown {
	color: rgba(159, 107, 83, 1);
	fill: rgba(159, 107, 83, 1);
}
.highlight-orange {
	color: rgba(217, 115, 13, 1);
	fill: rgba(217, 115, 13, 1);
}
.highlight-yellow {
	color: rgba(203, 145, 47, 1);
	fill: rgba(203, 145, 47, 1);
}
.highlight-teal {
	color: rgba(68, 131, 97, 1);
	fill: rgba(68, 131, 97, 1);
}
.highlight-blue {
	color: rgba(51, 126, 169, 1);
	fill: rgba(51, 126, 169, 1);
}
.highlight-purple {
	color: rgba(144, 101, 176, 1);
	fill: rgba(144, 101, 176, 1);
}
.highlight-pink {
	color: rgba(193, 76, 138, 1);
	fill: rgba(193, 76, 138, 1);
}
.highlight-red {
	color: rgba(212, 76, 71, 1);
	fill: rgba(212, 76, 71, 1);
}
.highlight-gray_background {
	background: rgba(241, 241, 239, 1);
}
.highlight-brown_background {
	background: rgba(244, 238, 238, 1);
}
.highlight-orange_background {
	background: rgba(251, 236, 221, 1);
}
.highlight-yellow_background {
	background: rgba(251, 243, 219, 1);
}
.highlight-teal_background {
	background: rgba(237, 243, 236, 1);
}
.highlight-blue_background {
	background: rgba(231, 243, 248, 1);
}
.highlight-purple_background {
	background: rgba(244, 240, 247, 0.8);
}
.highlight-pink_background {
	background: rgba(249, 238, 243, 0.8);
}
.highlight-red_background {
	background: rgba(253, 235, 236, 1);
}
.block-color-default {
	color: inherit;
	fill: inherit;
}
.block-color-gray {
	color: rgba(120, 119, 116, 1);
	fill: rgba(120, 119, 116, 1);
}
.block-color-brown {
	color: rgba(159, 107, 83, 1);
	fill: rgba(159, 107, 83, 1);
}
.block-color-orange {
	color: rgba(217, 115, 13, 1);
	fill: rgba(217, 115, 13, 1);
}
.block-color-yellow {
	color: rgba(203, 145, 47, 1);
	fill: rgba(203, 145, 47, 1);
}
.block-color-teal {
	color: rgba(68, 131, 97, 1);
	fill: rgba(68, 131, 97, 1);
}
.block-color-blue {
	color: rgba(51, 126, 169, 1);
	fill: rgba(51, 126, 169, 1);
}
.block-color-purple {
	color: rgba(144, 101, 176, 1);
	fill: rgba(144, 101, 176, 1);
}
.block-color-pink {
	color: rgba(193, 76, 138, 1);
	fill: rgba(193, 76, 138, 1);
}
.block-color-red {
	color: rgba(212, 76, 71, 1);
	fill: rgba(212, 76, 71, 1);
}
.block-color-gray_background {
	background: rgba(241, 241, 239, 1);
}
.block-color-brown_background {
	background: rgba(244, 238, 238, 1);
}
.block-color-orange_background {
	background: rgba(251, 236, 221, 1);
}
.block-color-yellow_background {
	background: rgba(251, 243, 219, 1);
}
.block-color-teal_background {
	background: rgba(237, 243, 236, 1);
}
.block-color-blue_background {
	background: rgba(231, 243, 248, 1);
}
.block-color-purple_background {
	background: rgba(244, 240, 247, 0.8);
}
.block-color-pink_background {
	background: rgba(249, 238, 243, 0.8);
}
.block-color-red_background {
	background: rgba(253, 235, 236, 1);
}
.select-value-color-uiBlue { background-color: rgba(35, 131, 226, .07); }
.select-value-color-pink { background-color: rgba(245, 224, 233, 1); }
.select-value-color-purple { background-color: rgba(232, 222, 238, 1); }
.select-value-color-green { background-color: rgba(219, 237, 219, 1); }
.select-value-color-gray { background-color: rgba(227, 226, 224, 1); }
.select-value-color-transparentGray { background-color: rgba(227, 226, 224, 0); }
.select-value-color-translucentGray { background-color: rgba(0, 0, 0, 0.06); }
.select-value-color-orange { background-color: rgba(250, 222, 201, 1); }
.select-value-color-brown { background-color: rgba(238, 224, 218, 1); }
.select-value-color-red { background-color: rgba(255, 226, 221, 1); }
.select-value-color-yellow { background-color: rgba(253, 236, 200, 1); }
.select-value-color-blue { background-color: rgba(211, 229, 239, 1); }
.select-value-color-pageGlass { background-color: undefined; }
.select-value-color-washGlass { background-color: undefined; }

.checkbox {
	display: inline-flex;
	vertical-align: text-bottom;
	width: 16;
	height: 16;
	background-size: 16px;
	margin-left: 2px;
	margin-right: 5px;
}

.checkbox-on {
	background-image: url("data:image/svg+xml;charset=UTF-8,%3Csvg%20width%3D%2216%22%20height%3D%2216%22%20viewBox%3D%220%200%2016%2016%22%20fill%3D%22none%22%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%3E%0A%3Crect%20width%3D%2216%22%20height%3D%2216%22%20fill%3D%22%2358A9D7%22%2F%3E%0A%3Cpath%20d%3D%22M6.71429%2012.2852L14%204.9995L12.7143%203.71436L6.71429%209.71378L3.28571%206.2831L2%207.57092L6.71429%2012.2852Z%22%20fill%3D%22white%22%2F%3E%0A%3C%2Fsvg%3E");
}

.checkbox-off {
	background-image: url("data:image/svg+xml;charset=UTF-8,%3Csvg%20width%3D%2216%22%20height%3D%2216%22%20viewBox%3D%220%200%2016%2016%22%20fill%3D%22none%22%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%3E%0A%3Crect%20x%3D%220.75%22%20y%3D%220.75%22%20width%3D%2214.5%22%20height%3D%2214.5%22%20fill%3D%22white%22%20stroke%3D%22%2336352F%22%20stroke-width%3D%221.5%22%2F%3E%0A%3C%2Fsvg%3E");
}
	
</style></head><body><article id="28b07495-fafd-4267-886f-45a6a50ce273" class="page sans"><header><img class="page-cover-image" src="https://www.notion.so/images/page-cover/rijksmuseum_rembrandt_1642.jpg" style="object-position:center 60%"/><div class="page-header-icon page-header-icon-with-cover"><span class="icon">ðŸ¤“</span></div><h1 class="page-title">Detecting Vulnerable-Flask-Application</h1><p class="page-description"></p></header><div class="page-body"><p id="a6184454-3ccf-4329-86d2-73ef59722170" class=""><code>Team</code>:</p><ol type="1" id="366a7b03-c134-4188-a65e-5fe9b1ec5b92" class="numbered-list" start="1"><li><mark class="highlight-blue"><strong>Khasan Abdurakhmanov</strong></mark></li></ol><ol type="1" id="0f4235fe-93e9-403e-8682-7d109251131f" class="numbered-list" start="2"><li><mark class="highlight-teal"><strong>Mbachan Fabrice</strong></mark></li></ol><ol type="1" id="eb7e5c58-947c-454f-960c-dadf46893b6b" class="numbered-list" start="3"><li><mark class="highlight-yellow"><strong>Ahmed Saad</strong></mark></li></ol><ol type="1" id="8b58f2ca-e805-4ba3-ad18-aaff6a9d6f3d" class="numbered-list" start="4"><li><mark class="highlight-orange"><strong>Vanel Nara</strong></mark></li></ol><hr id="4980c66d-5663-4df2-bb9a-d263bda2fa0f"/><nav id="428380bc-0248-43c5-9030-d11c4d9fff2d" class="block-color-gray table_of_contents"><div class="table_of_contents-item table_of_contents-indent-0"><a class="table_of_contents-link" href="#42cc0fde-3f09-4b3a-8d5a-0eebbfc16f53">Introduction</a></div><div class="table_of_contents-item table_of_contents-indent-1"><a class="table_of_contents-link" href="#af566da2-7336-4471-8840-3e8196bc075e">Importance of Monitoring Docker Containers</a></div><div class="table_of_contents-item table_of_contents-indent-0"><a class="table_of_contents-link" href="#5a080ad2-9db8-42fb-882c-69c28d25a595">1. Tools and Setup</a></div><div class="table_of_contents-item table_of_contents-indent-1"><a class="table_of_contents-link" href="#3e9c6404-6348-4623-843f-c8c7fd4e3742">1.1 Docker Engine</a></div><div class="table_of_contents-item table_of_contents-indent-1"><a class="table_of_contents-link" href="#82e49e1e-0258-4a47-8c7f-43e9f122831f">1.2 Vulnerable Docker Container FLASK</a></div><div class="table_of_contents-item table_of_contents-indent-1"><a class="table_of_contents-link" href="#def71764-d281-4370-a70c-b17cf23af256">1.3 <strong>Wazuh - The Open Source Security Platform</strong></a></div><div class="table_of_contents-item table_of_contents-indent-2"><a class="table_of_contents-link" href="#e002263d-106f-41ad-867c-b9df9a8aa89a"><strong>1.3.1 Architecture</strong></a></div><div class="table_of_contents-item table_of_contents-indent-1"><a class="table_of_contents-link" href="#6c1f7b1e-e19f-4193-b432-78a3307183bd">1.4 Deployment Methods</a></div><div class="table_of_contents-item table_of_contents-indent-2"><a class="table_of_contents-link" href="#a529f2fb-a746-4d4f-9a0b-68e9f8e89da5">1.4.1 <strong>Wazuh Docker deployment</strong></a></div><div class="table_of_contents-item table_of_contents-indent-2"><a class="table_of_contents-link" href="#151d47c5-c8e9-4b40-98de-3e09b06617e6">1.4.2 Wazuh Manual Deployment</a></div><div class="table_of_contents-item table_of_contents-indent-2"><a class="table_of_contents-link" href="#b5113c46-e804-4a7e-8a6a-9fddf19b4668">1.4.3 Wazuh Cloud</a></div><div class="table_of_contents-item table_of_contents-indent-0"><a class="table_of_contents-link" href="#f5701a41-c0a7-4e7c-b63f-cafe4936e059">2. Configuring Wazuh SIEM</a></div><div class="table_of_contents-item table_of_contents-indent-1"><a class="table_of_contents-link" href="#bfc696e3-aae5-4854-bfb1-8941c809e13c">2.1 Configuring Wazuh to Monitor Docker Containers</a></div><div class="table_of_contents-item table_of_contents-indent-2"><a class="table_of_contents-link" href="#12df3dd1-4c89-464b-956d-1260ef50920e">2.1.1 Installing Wazuh Agent on Docker Host</a></div><div class="table_of_contents-item table_of_contents-indent-2"><a class="table_of_contents-link" href="#820e9e53-f96d-4bc8-afb5-4b9097be353a">2.1.2 Monitoring Docker events</a></div><div class="table_of_contents-item table_of_contents-indent-2"><a class="table_of_contents-link" href="#199cd088-730d-4397-b26e-bcdcec810792">2.1.3 <strong>Monitoring Docker container logs</strong></a></div><div class="table_of_contents-item table_of_contents-indent-0"><a class="table_of_contents-link" href="#6038b825-c243-43e2-9971-91e45526eee6">3. Configuring Vulnerable Application</a></div><div class="table_of_contents-item table_of_contents-indent-0"><a class="table_of_contents-link" href="#32fc649c-6426-4ebc-9252-7780f5bc7cce">4 Detecting Attacks on Endpoints</a></div><div class="table_of_contents-item table_of_contents-indent-1"><a class="table_of_contents-link" href="#ed36f70c-c345-4bc1-86fc-33a8e730b8aa">4.1 Search</a></div><div class="table_of_contents-item table_of_contents-indent-1"><a class="table_of_contents-link" href="#549a142e-437c-48f6-9d7f-10c2ecd2e8dc">4.2 XXE</a></div><div class="table_of_contents-item table_of_contents-indent-2"><a class="table_of_contents-link" href="#9c62885d-5616-40f3-b398-a9bca78d0c4d">4.2.1 Enabling File Integrity Monitoring (FIM) in Wazuh</a></div><div class="table_of_contents-item table_of_contents-indent-2"><a class="table_of_contents-link" href="#c9d5b141-7541-4192-9771-96d42823b3bf">4.2.2 Docker Considerations</a></div><div class="table_of_contents-item table_of_contents-indent-2"><a class="table_of_contents-link" href="#24b02058-9975-4429-b852-2e5791b8ca17">4.2.3. Enhancing Application Logging</a></div><div class="table_of_contents-item table_of_contents-indent-0"><a class="table_of_contents-link" href="#554cb541-0508-40e0-9963-44dc907a618b">Conclusion</a></div></nav><hr id="e2d4bde0-0c48-40da-9bf0-fe1931f499a7"/><h1 id="42cc0fde-3f09-4b3a-8d5a-0eebbfc16f53" class="">Introduction</h1><p id="693653cb-2fc0-4cac-a0f4-c7e2418575aa" class="">The rapid development and deployment of web applications have underscored the importance of security in the <em>software lifecycle</em>. One of the widely-used frameworks for building web applications is <code>Flask</code>, a lightweight and flexible <strong>Python</strong> framework. However, like any other technology, <code>Flask</code> applications can <em>harbor vulnerabilities</em> if not properly secured. Detecting vulnerabilities in <em>web applications</em> is crucial for maintaining the <strong>integrity</strong>, <strong>confidentiality</strong>, and <strong>availability</strong> of data. Common vulnerabilities such as <em>SQL injection</em>, <em>cross-site scripting (XSS)</em>, and <em>cross-site request forgery (CSRF)</em> can lead to significant security breaches, <strong>data theft</strong>, and <strong>financial loss</strong>. By learning to identify and fix these vulnerabilities, individuals and organizations can protect their applications from malicious attacks.</p><p id="983d7320-7752-440f-877b-d265e475d096" class=""><strong>Wazuh</strong>, an open-source security monitoring platform, provides comprehensive capabilities to detect and respond to security incidents in <strong>Docker</strong> environments. By leveraging <strong>Wazuh&#x27;s</strong> powerful <em>detection engine</em>, <em>custom rules</em>, and <em>real-time monitoring</em>, organizations can significantly enhance their ability to identify and prevent attacks targeting vulnerable <strong>Docker</strong> containers.</p><div id="35b9b0bc-30c1-4716-9273-1864f6c53df3" class="column-list"><div id="32ddf3c7-e155-4fc4-86a5-1b943121bf90" style="width:43.75%" class="column"><figure id="67e877fc-025a-4f2d-87f0-32ee40bdade9" class="image"><a href="Detecting%20Vulnerable-Flask-Application%2028b07495fafd4267886f45a6a50ce273/Untitled.png"><img style="width:242px" src="Detecting%20Vulnerable-Flask-Application%2028b07495fafd4267886f45a6a50ce273/Untitled.png"/></a></figure></div><div id="53e8f971-d7e2-4025-825b-b36a69bd22fe" style="width:56.25%" class="column"><p id="57d79a31-0cc9-45e8-9a4e-fc5d3417153f" class="">
</p><figure id="253441cd-f291-4136-bb25-8b9d03d8b11b" class="image"><a href="Detecting%20Vulnerable-Flask-Application%2028b07495fafd4267886f45a6a50ce273/5c9462dc-2bdf-4e91-8c26-ac63e7d14ab6.png"><img style="width:432px" src="Detecting%20Vulnerable-Flask-Application%2028b07495fafd4267886f45a6a50ce273/5c9462dc-2bdf-4e91-8c26-ac63e7d14ab6.png"/></a></figure><p id="c6507002-6436-45f6-be10-ce2a206ceb32" class="">
</p></div></div><p id="7b491623-96f4-4298-9c74-2c08c78ad482" class="">This guide will walk you through the process of configuring <strong>Wazuh</strong> to detect various types of attacks exploiting vulnerabilities in <strong>Docker</strong> containers. We will cover the necessary steps to set up the <strong>Docker Listener</strong> module, create custom <strong>decoders</strong> and <strong>rules</strong>, and analyze the relevant logs to identify potential attacks. By following these best practices, you can strengthen the security posture of your <strong>Docker</strong> infrastructure and minimize the risk of successful exploits.</p><h2 id="af566da2-7336-4471-8840-3e8196bc075e" class="">Importance of Monitoring Docker Containers</h2><ul id="0e1663d2-cda4-4513-8023-c2eb30a8e488" class="bulleted-list"><li style="list-style-type:disc"><strong>Visibility:</strong> Monitoring Docker containers ensures visibility into the runtime behavior of applications and infrastructure, enabling early detection of malicious activities.</li></ul><ul id="62af1c94-3130-4c5a-9748-f4a2e88935d6" class="bulleted-list"><li style="list-style-type:disc"><strong>Compliance:</strong> Many regulatory standards require continuous monitoring of systems. Using Wazuh to monitor Docker environments helps in achieving compliance.</li></ul><ul id="ce343bb7-15e1-4d47-8607-c9c48a6e3028" class="bulleted-list"><li style="list-style-type:disc"><strong>Incident Response:</strong> With real-time alerts and logs, security teams can respond promptly to incidents, minimizing potential damage.</li></ul><ul id="ea7c3faf-7fe9-4318-861d-160e08280dbe" class="bulleted-list"><li style="list-style-type:disc"><strong>Improved Security Posture:</strong> Regular monitoring and analysis of container logs help in identifying and mitigating vulnerabilities, thereby improving the overall security posture of the environment.</li></ul><hr id="fc635206-df95-4d05-8110-efc10b6d83b8"/><h1 id="5a080ad2-9db8-42fb-882c-69c28d25a595" class="">1. Tools and Setup</h1><p id="5142b26a-692d-40b3-955c-d41a116376c2" class="">Before diving into the specifics of configuring <strong>Wazuh</strong> for monitoring <strong>Docker</strong> containers, it&#x27;s essential to have a clear understanding of the tools involved and their setup. This section will cover the installation and basic setup of the <strong>Docker engine</strong>, deploying a vulnerable container, and providing an in-depth explanation of the <strong>Wazuh</strong> architecture.</p><h2 id="3e9c6404-6348-4623-843f-c8c7fd4e3742" class="">1.1 Docker Engine</h2><p id="d63f408a-d30d-48d8-9f44-edb6af309d8b" class="">The foundation of our setup is the <strong>Docker engine</strong>, which is  responsible for running and managing the <strong>Docker</strong> containers. Ensure that you have <strong>Docker</strong> installed and configured on your system.</p><ol type="1" id="91d0814b-e39e-42d9-9128-da4b970d969e" class="numbered-list" start="1"><li><strong>Docker</strong> is a platform that has gained wide acceptance for <em>containerization</em>. It greatly simplifies the process of managing and deploying applications in containers, making it a vital tool for any developer.<figure id="dfa4dd47-55b7-49fe-a491-d0a36fd18dac" class="image"><a href="Detecting%20Vulnerable-Flask-Application%2028b07495fafd4267886f45a6a50ce273/Untitled%201.png"><img style="width:708px" src="Detecting%20Vulnerable-Flask-Application%2028b07495fafd4267886f45a6a50ce273/Untitled%201.png"/></a></figure></li></ol><ul id="42784bfd-7c98-4546-94c1-dab72910e288" class="bulleted-list"><li style="list-style-type:disc"><strong><a href="https://docs.docker.com/engine/install/">Install Docker</a></strong>: You can follow the detailed instructions provided on the <strong>Docker</strong> website to install <strong>Docker</strong> on your system. This will ensure that you have the latest and most secure version.</li></ul><p id="dec5f586-56c7-4598-86ac-f0224886e7f3" class="">In addition to <strong>Docker</strong>, this guide will also use <strong>Docker Compose</strong> to define and manage the multi-container application. <strong>Docker Compose</strong> allows you to define the services, networks, and volumes required for the application in a single configuration file, making it easier to set up and manage the environment.</p><h2 id="82e49e1e-0258-4a47-8c7f-43e9f122831f" class="">1.2 Vulnerable Docker Container FLASK</h2><p id="9c1d40d4-f504-4443-acb3-bba8a11cdeac" class="">In this guide, we will be using a deliberately vulnerable <strong>Docker</strong> container to demonstrate the detection capabilities of <strong>Wazuh</strong>.</p><figure id="8978869e-3c01-4c4a-828d-0585f29631c5" class="image"><a href="Detecting%20Vulnerable-Flask-Application%2028b07495fafd4267886f45a6a50ce273/Untitled%202.png"><img style="width:640px" src="Detecting%20Vulnerable-Flask-Application%2028b07495fafd4267886f45a6a50ce273/Untitled%202.png"/></a></figure><p id="e3bb55c2-59e6-4a97-a949-c257a9d718e5" class="">This project is intentionally designed as a vulnerable <strong>Flask</strong> application for the purpose of education. Its primary goal is to showcase a variety of common web vulnerabilities that frequently pose a risk in the digital world. By providing a real-life simulation of these vulnerabilities, this project serves as an invaluable learning tool for a diverse range of individuals. You can set up the vulnerable container by following the steps outlined in the <a href="https://sne-m23-sn.github.io/Vulnerable-Flask-App/">previous guide</a>.</p><h2 id="def71764-d281-4370-a70c-b17cf23af256" class="">1.3 <strong>Wazuh - The Open Source Security Platform</strong></h2><p id="54badcb2-c7c0-4783-ab1b-b6f34ba7d584" class=""><strong>Wazuh</strong> is a free and open source platform used for <em>threat prevention</em>, <em>detection</em>, and <em>response</em>. It is capable of protecting workloads across on-premises, <em><strong>virtualized</strong></em>, <em><strong>containerized</strong></em>, and <em><strong>cloud-based</strong></em> environments.</p><figure id="4680978b-2071-4cf0-b230-87d1b4b0bee9" class="image"><a href="Detecting%20Vulnerable-Flask-Application%2028b07495fafd4267886f45a6a50ce273/Untitled%203.png"><img style="width:708px" src="Detecting%20Vulnerable-Flask-Application%2028b07495fafd4267886f45a6a50ce273/Untitled%203.png"/></a></figure><p id="86428fba-9773-467e-8f77-c93986651c1d" class=""><strong>Wazuh</strong> solution consists of an <em>endpoint security agent</em>, deployed to the monitored systems, and a <em>management server</em>, which collects and analyzes data gathered by the agents. Besides, <strong>Wazuh </strong>has been fully integrated with the <strong>Elastic Stack</strong>, providing a <em>search engine</em> and <em>data visualization</em> tool that allows users to navigate through their security alerts.</p><h3 id="e002263d-106f-41ad-867c-b9df9a8aa89a" class=""><strong>1.3.1 Architecture</strong></h3><p id="163bbdb9-1884-4440-86c9-d87213966cc6" class="">The <strong>Wazuh</strong> architecture uses agents on monitored endpoints to forward security data to a central server. <strong>Agentless</strong> devices like <em>firewalls</em>, <em>switches</em>, <em>routers</em>, and access points can send log data via <strong>Syslog</strong>, <strong>SSH</strong>, or <strong>API</strong>. The server <em>decodes</em> and <em>analyzes</em> this information, then sends it to the <code>Wazuh indexer</code> for indexing and storage.</p><p id="4d8ca71a-8739-4517-9764-bab5fbce6ff6" class="">A <code>Wazuh indexer</code> cluster can have one or more nodes for read and write operations. Small deployments can use a <strong>single-node cluster</strong>, while <strong>multi-node clusters</strong> are better for large data volumes or high availability.</p><p id="535685f0-329d-41c7-8916-73a66fe601f9" class="">For production, it&#x27;s recommended to deploy the <code>Wazuh server</code> and <code>indexer</code> on different hosts. <code>Filebeat</code> securely forwards <strong>Wazuh</strong> alerts and events to the indexer cluster using <strong>TLS</strong> encryption.</p><p id="19a61de4-c7ae-42bb-9baa-37a06dde0ed5" class="">The diagram below shows a <strong>Wazuh</strong> deployment architecture, illustrating the components and how the server and indexer nodes can be configured as clusters for <em>load balancing</em> and <em>high availability</em>.<br/> <br/></p><figure id="272d5448-b79f-4d86-9cac-f649d58d485d" class="image"><a href="Detecting%20Vulnerable-Flask-Application%2028b07495fafd4267886f45a6a50ce273/Untitled%204.png"><img style="width:708px" src="Detecting%20Vulnerable-Flask-Application%2028b07495fafd4267886f45a6a50ce273/Untitled%204.png"/></a></figure><p id="b5628129-bcbe-49f3-816f-ec59ecdcaae4" class="">The <strong>Wazuh agent</strong> sends events to the <strong>Wazuh server</strong> for <em>analysis</em> and <em>threat detection</em>. The <strong>agent</strong> connects to the server on port <code>1514</code> (default, configurable). The server <em>decodes</em> and checks <em>events</em>, adding alert data if a rule is triggered. Events are saved to:</p><ul id="0cca6557-b60d-48b9-8f5f-e98b0b9b3159" class="bulleted-list"><li style="list-style-type:disc"><code>/var/ossec/logs/archives/archives.json</code> (all events)</li></ul><ul id="c72c443d-b292-4273-a1e2-8e990bce0e0b" class="bulleted-list"><li style="list-style-type:disc"><code>/var/ossec/logs/alerts/alerts.json</code> (events triggering high-priority rules, configurable)</li></ul><p id="93740fa4-6281-4b7b-b3ff-1f8843aa865b" class=""><strong>Wazuh</strong> uses <strong>AES</strong> encryption (128-bit blocks, 256-bit keys) by default, with optional Blowfish encryption.</p><p id="ac02f37b-cbc4-45e8-aff4-b3fc18d99604" class="">The <strong>Wazuh server</strong> uses <strong>Filebeat</strong> to send <em>alert</em> and <em>event data</em> to the <strong>Wazuh</strong> <strong>indexer</strong> with <strong>TLS </strong>encryption. <strong>Filebeat</strong> reads the server output and sends it to the indexer (default port 9200/TCP). The indexed data is then visualized using the <strong>Wazuh</strong> dashboard. The <strong>Wazuh dashboard</strong> queries the <strong>Wazuh RESTful API</strong> (default port 55000/TCP) to display configuration and status information of the <strong>Wazuh server</strong> and agents. It can also modify settings through API calls, with communication <em>encrypted</em> and <em>authenticated</em> by username and password.</p><hr id="fff40834-11a2-4ebb-9372-29aae013be82"/><h2 id="6c1f7b1e-e19f-4193-b432-78a3307183bd" class="">1.4 Deployment Methods</h2><p id="a467e967-c613-4d9d-bec9-dacc0d0269d5" class="">There are three methods to deploy Wazuh:</p><ol type="1" id="d910f63d-0816-4ab0-8364-456ce7115aa6" class="numbered-list" start="1"><li><strong>Wazuh via Docker:</strong> Deploy <strong>Wazuh</strong> components as <strong>Docker</strong> containers.<ul id="12e0c9f9-4a30-4c37-8fff-64991b1a3661" class="bulleted-list"><li style="list-style-type:disc">Building Docker images for the Wazuh manager, indexer, and dashboard components</li></ul><ul id="08c915e4-bd40-4332-81f7-f66b3ae77085" class="bulleted-list"><li style="list-style-type:disc">Configuring a multi-node Wazuh deployment using Docker Compose</li></ul><ul id="9f97b525-3869-487b-aa05-6e7402c9f833" class="bulleted-list"><li style="list-style-type:disc">Generating SSL/TLS certificates for secure communication between the Wazuh components</li></ul></li></ol><ol type="1" id="4eeaae4f-0316-4b2d-822b-19272c4a6b6e" class="numbered-list" start="2"><li><strong>Wazuh Manual Installation:</strong> Install <strong>Wazuh</strong> components directly on the host operating system.<ul id="01d7723c-14ef-4c86-9342-e38053d1e237" class="bulleted-list"><li style="list-style-type:disc">Installing the Wazuh central components (server, indexer, and dashboard) on one or more hosts</li></ul><ul id="077ee93f-08c9-4af4-8fdf-20320ddb2ee7" class="bulleted-list"><li style="list-style-type:disc">Deploying the Wazuh agent on the endpoints to be monitored</li></ul><ul id="349649ba-1d36-40ae-9920-1691c7e8e36f" class="bulleted-list"><li style="list-style-type:disc">Configuring the Wazuh components and integrating them into the infrastructure</li></ul></li></ol><ol type="1" id="12d5e0c6-7b2d-4600-b575-3a64abfcb032" class="numbered-list" start="3"><li><strong>Wazuh Cloud:</strong> Use the <strong>Wazuh Cloud</strong> service for a managed deployment.<ul id="8fa25ac2-c7b2-4232-8369-b560b34e5ed8" class="bulleted-list"><li style="list-style-type:disc">Wazuh Cloud hosts and manages all the Wazuh components in a single integrated platform</li></ul><ul id="2021cdf4-8751-42f2-bc34-6b64971e6356" class="bulleted-list"><li style="list-style-type:disc">It handles the installation, scaling, and updates of the Wazuh components</li></ul><ul id="c610dfbe-6d59-44ca-acad-de21ff0edec4" class="bulleted-list"><li style="list-style-type:disc">Wazuh Cloud provides a free trial to create and explore the cloud environment</li></ul><ul id="062c11f5-b638-4d7f-b4e4-ff3706d0f89e" class="bulleted-list"><li style="list-style-type:disc">It offers predefined environment profiles (Small, Medium, Large) to cater to different needs</li></ul></li></ol><p id="358b2eaf-4c30-4e47-a1bb-ff330fc7a20f" class="">In summary, you can choose from these three options to set up <strong>Wazuh</strong> based on your specific requirements, infrastructure, and resource constraints.</p><h3 id="a529f2fb-a746-4d4f-9a0b-68e9f8e89da5" class="">1.4.1 <strong>Wazuh Docker deployment</strong></h3><p id="9c264d13-b0ee-4cd0-9403-e8869a71cc13" class="">You can deploy <strong>Wazuh</strong> as a <em>single-node</em> or <em>multi-node</em> stack.</p><ul id="5a0976b5-217f-42a9-a20c-e88cbe25a470" class="bulleted-list"><li style="list-style-type:disc"><strong>Single-node deployment</strong>: Deploys one <strong>Wazuh manager</strong>, <strong>indexer</strong>, and <strong>dashboard node</strong>.</li></ul><ul id="ba040fb7-68ec-4475-846c-5ce923eac137" class="bulleted-list"><li style="list-style-type:disc"><strong>Multi-node deployment</strong>: Deploys two <strong>Wazuh</strong> <strong>manager nodes</strong> (one master and one worker), three <strong>Wazuh indexer nodes</strong>, and a <strong>Wazuh dashboard</strong> node.</li></ul><p id="0af33494-0abc-429c-a8a1-494b2cc1e021" class="">Both deployments use persistence and allow configuring certificates to secure communications between nodes. The multi-node stack is the only deployment that contains high availability.</p><p id="a3e4b203-e131-445d-82ac-8f2a9918f904" class="">In our case we will only consider <strong>Single-node deployment</strong>:</p><ol type="1" id="404b4890-2a8b-49cb-a4b8-b1093864580b" class="numbered-list" start="1"><li><strong>Clone the Wazuh repository to your system:</strong></li></ol><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="e76f8277-5aab-4a16-bdc7-3dc55c4c5640" class="code"><code class="language-Bash">git clone https://github.com/wazuh/wazuh-docker.git -b v4.3.0</code></pre><figure id="b9e5599c-4462-4bf6-a9cb-723264ee2cfb" class="image"><a href="Detecting%20Vulnerable-Flask-Application%2028b07495fafd4267886f45a6a50ce273/Untitled%205.png"><img style="width:708px" src="Detecting%20Vulnerable-Flask-Application%2028b07495fafd4267886f45a6a50ce273/Untitled%205.png"/></a></figure><p id="fa99efc8-691d-49f3-83f2-689905cd6f4a" class="">Provide a group of certificates for each node in the stack to secure communication between the nodes. You have two alternatives to provide these certificates:</p><ul id="3b74018c-2a72-4d10-8922-0451ff35a231" class="bulleted-list"><li style="list-style-type:disc"><strong>Generate self-signed certificates for each cluster node</strong><ul id="9c6f2109-1dbd-4baa-81f9-a39696236f19" class="bulleted-list"><li style="list-style-type:circle">We have created a <strong>Docker</strong> image to automate certificate generation using the <strong>Wazuh</strong> certs gen tool.</li></ul><ul id="a79b796f-77d0-4be4-9831-21a1fe9f8eff" class="bulleted-list"><li style="list-style-type:circle">If your system uses a proxy, add the following to the <code>generate-indexer-certs.yml</code> file. If not, skip this particular step:<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="45e47a90-6243-4e0a-b7fe-bd70306ef544" class="code"><code class="language-Bash">environment:
  - HTTP_PROXY=YOUR_PROXY_ADDRESS_OR_DNS</code></pre></li></ul><p id="d63afc00-0071-4b17-b724-31b4b7a4e761" class=""><strong>A completed example looks like:</strong><div class="indented"><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="804e29e4-168d-480e-89ec-8adaa60e36f0" class="code"><code class="language-Bash"># Wazuh App Copyright (C) 2017 Wazuh Inc. (License GPLv2)
version: &#x27;3&#x27;

services:
  generator:
    image: wazuh/wazuh-certs-generator:0.0.2
    hostname: wazuh-certs-generator
    volumes:
      - ./config/wazuh_indexer_ssl_certs/:/certificates/
      - ./config/certs.yml:/config/certs.yml
    environment:
      - HTTP_PROXY=YOUR_PROXY_ADDRESS_OR_DNS</code></pre></div></p></li></ul><p id="d6531c7c-566c-4f45-9339-5b8290d42aef" class="">Execute the following command to get the desired certificates:</p><p id="1134384a-bfec-4927-abae-05cb1141c644" class=""><strong>Docker Compose version 2:</strong></p><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="a196d987-fc48-4b69-9928-b0c993887a39" class="code"><code class="language-Bash">docker-compose -f generate-indexer-certs.yml run --rm generator</code></pre><p id="459c8ead-44a4-4f7d-85f6-1ec8f435b790" class=""><strong>Docker Compose version 3:</strong></p><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="6370d2f7-460f-4efe-be99-19286ed076b2" class="code"><code class="language-Bash">docker compose -f generate-indexer-certs.yml run --rm generator</code></pre><figure id="46501747-2c40-4c97-9e54-e9c2c7cdffc0" class="image"><a href="Detecting%20Vulnerable-Flask-Application%2028b07495fafd4267886f45a6a50ce273/Untitled%206.png"><img style="width:708px" src="Detecting%20Vulnerable-Flask-Application%2028b07495fafd4267886f45a6a50ce273/Untitled%206.png"/></a></figure><p id="1a49451e-fd8e-405f-a8cf-8bd78f0e2558" class="">This saves the certificates into the <code>config/wazuh_indexer_ssl_certs</code> directory.</p><ol type="1" id="724b8745-4620-415f-b280-1e61de7bb534" class="numbered-list" start="2"><li><strong>Provide your own certificates for each node.</strong><ul id="1dbece8a-0009-4656-a253-65c01b2f0d28" class="bulleted-list"><li style="list-style-type:disc">In case you have your own certificates, provision them as follows in the <code>config/wazuh_indexer_ssl_certs</code> directory:<br/><br/><strong>Wazuh indexer</strong>:<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="92eada04-80d7-41a9-8c86-4d2b041f6205" class="code"><code class="language-Bash">config/wazuh_indexer_ssl_certs/root-ca.pem
config/wazuh_indexer_ssl_certs/wazuh.indexer-key.pem
config/wazuh_indexer_ssl_certs/wazuh.indexer.pem
config/wazuh_indexer_ssl_certs/admin.pem
config/wazuh_indexer_ssl_certs/admin-key.pem</code></pre></li></ul><p id="468d075a-e976-44b9-a1d7-38af9e01075d" class=""><strong>     Wazuh manager</strong>:<div class="indented"><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="5829dae2-26b9-4f33-82d9-24e495fa2391" class="code"><code class="language-Bash">config/wazuh_indexer_ssl_certs/root-ca-manager.pem
config/wazuh_indexer_ssl_certs/wazuh.manager.pem
config/wazuh_indexer_ssl_certs/wazuh.manager-key.pem</code></pre><p id="2acbac4a-7b30-49bb-8962-77c664d87701" class=""><strong>Wazuh dashboard</strong>:</p><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="1b521a64-cfdc-4d62-8dfd-1dafa78eb800" class="code"><code class="language-Bash">config/wazuh_indexer_ssl_certs/wazuh.dashboard.pem
config/wazuh_indexer_ssl_certs/wazuh.dashboard-key.pem
config/wazuh_indexer_ssl_certs/root-ca.pem</code></pre></div></p></li></ol><ol type="1" id="4b9b51ca-695e-4a4a-a46c-0f07eac18e1c" class="numbered-list" start="3"><li><strong>Start the Wazuh single-node deployment using docker-compose:</strong><p id="5b2bccca-0bef-467c-8cd5-30d36f6868fb" class=""><strong>Foreground</strong>:</p><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="60f495fa-59b2-430b-92de-37a0edeaa4eb" class="code"><code class="language-Bash">docker-compose up</code></pre><figure id="66242e0a-fea2-4fb9-8adb-ffd4c8981d3f" class="image"><a href="Detecting%20Vulnerable-Flask-Application%2028b07495fafd4267886f45a6a50ce273/Untitled%207.png"><img style="width:680px" src="Detecting%20Vulnerable-Flask-Application%2028b07495fafd4267886f45a6a50ce273/Untitled%207.png"/></a></figure><figure id="dfa3b510-a17a-45a5-bd21-cf7044cc665d" class="image"><a href="Detecting%20Vulnerable-Flask-Application%2028b07495fafd4267886f45a6a50ce273/Untitled%208.png"><img style="width:680px" src="Detecting%20Vulnerable-Flask-Application%2028b07495fafd4267886f45a6a50ce273/Untitled%208.png"/></a></figure><p id="0589a865-0a65-4570-8ddc-f4c255529702" class=""><strong>Background</strong>:</p><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="17340e25-5a9f-457f-9081-32c35c1b695c" class="code"><code class="language-Bash">docker compose up -d</code></pre><figure id="384ce04f-fc13-497b-ae62-27bf42211e36" class="image"><a href="Detecting%20Vulnerable-Flask-Application%2028b07495fafd4267886f45a6a50ce273/Untitled%209.png"><img style="width:680px" src="Detecting%20Vulnerable-Flask-Application%2028b07495fafd4267886f45a6a50ce273/Untitled%209.png"/></a></figure><p id="a72c70b3-66ec-46c9-839a-18a793c65f4c" class="">The default <em>username</em> and <em>password</em> for the <strong>Wazuh</strong> <strong>dashboard</strong> are <code>admin</code> and <code>SecretPassword</code>. For <a href="https://documentation.wazuh.com/current/deployment-options/docker/wazuh-container.html#change-pwd-existing-usr">additional security</a>, you can change the <em>default password</em> for the <strong>Wazuh indexer</strong> <em>admin</em> user.</p><figure id="6d9f06a9-5a01-4bbd-9b50-778942d2a45c" class="image"><a href="Detecting%20Vulnerable-Flask-Application%2028b07495fafd4267886f45a6a50ce273/Untitled%2010.png"><img style="width:680px" src="Detecting%20Vulnerable-Flask-Application%2028b07495fafd4267886f45a6a50ce273/Untitled%2010.png"/></a></figure><figure id="deeddd07-5322-4b4f-8342-1e3ed90c2a75" class="image"><a href="Detecting%20Vulnerable-Flask-Application%2028b07495fafd4267886f45a6a50ce273/Untitled%2011.png"><img style="width:680px" src="Detecting%20Vulnerable-Flask-Application%2028b07495fafd4267886f45a6a50ce273/Untitled%2011.png"/></a></figure><figure id="e7ae22e2-bcd3-4a32-a5c5-c3cb53400611" class="image"><a href="Detecting%20Vulnerable-Flask-Application%2028b07495fafd4267886f45a6a50ce273/Untitled%2012.png"><img style="width:680px" src="Detecting%20Vulnerable-Flask-Application%2028b07495fafd4267886f45a6a50ce273/Untitled%2012.png"/></a></figure><figure id="7b4172a4-e79e-46bf-af6f-1a6a742b4ce1" class="image"><a href="Detecting%20Vulnerable-Flask-Application%2028b07495fafd4267886f45a6a50ce273/Untitled%2013.png"><img style="width:680px" src="Detecting%20Vulnerable-Flask-Application%2028b07495fafd4267886f45a6a50ce273/Untitled%2013.png"/></a></figure></li></ol><figure class="block-color-gray_background callout" style="white-space:pre-wrap;display:flex" id="5d3b247d-49a6-43f9-8ff7-6a735012728f"><div style="font-size:1.5em"><span class="icon">ðŸ’¡</span></div><div style="width:100%">Itâ€™s recommended to use <strong>Wazuh</strong> version <code>4.3</code>. If you want to deploy it via <strong>Docker</strong>, use a <strong>Linux OS</strong> because the <em>certificates</em> are not created properly on <strong>Windows OS</strong>.</div></figure><hr id="e6769a8f-2e41-44ac-a4d1-0b35b9b9eeb4"/><h3 id="151d47c5-c8e9-4b40-98de-3e09b06617e6" class="">1.4.2 Wazuh Manual Deployment</h3><p id="6a7d811d-598e-49b3-9046-2470ac0b6410" class="">The <strong>Wazuh indexer</strong> and <strong>Wazuh server</strong> can be installed on a <strong>single host</strong> or distributed across <strong>multiple hosts</strong> in a cluster configuration. There are two main installation methods for each <strong>Wazuh</strong> central component. Both methods provide instructions for installing the components either on a single host or on separate hosts.</p><p id="3345a54c-df05-4c68-9765-333cf7a808da" class="">For greater deployment flexibility and customization, you can start with the <strong>Wazuh indexer</strong> deployment. This approach allows for an all-in-one installation as well as the installation of components on separate servers.</p><p id="2d5eb8ad-48a8-4f79-904a-bf4485f687b1" class=""><strong>Here is the installation workflow you will follow:</strong></p><figure id="9c34cba6-4136-4826-bb2a-cfdafb1dbe8a" class="image"><a href="Detecting%20Vulnerable-Flask-Application%2028b07495fafd4267886f45a6a50ce273/Untitled%2014.png"><img style="width:708px" src="Detecting%20Vulnerable-Flask-Application%2028b07495fafd4267886f45a6a50ce273/Untitled%2014.png"/></a></figure><blockquote id="424df440-c59e-4ac2-9131-07e58daad751" class="block-color-gray_background"><mark class="highlight-yellow"><strong>Wazuh Indexer</strong></mark></blockquote><p id="923bce4a-77a0-4569-9ea2-92183b0fab81" class="">The <strong>Wazuh indexer</strong> is a highly scalable, full-text search and analytics engine. This central component indexes and stores alerts generated by the <strong>Wazuh server</strong>, providing near real-time data search and analytics capabilities.</p><p id="1bd3df6b-5250-49db-b399-07d0c9c11dfb" class="">You can install the <strong>Wazuh indexer</strong> on a <em>single host</em> or distribute it across multiple nodes in a cluster configuration. A clustered setup offers scalability, high availability, and improved performance.</p><p id="6d886253-d078-4582-beee-0ac0e573a2dd" class=""><strong>The installation process is divided into three stages.</strong></p><ol type="1" id="2427b20f-ccaf-4c8c-a8af-6b5dba6f5a7e" class="numbered-list" start="1"><li><code><strong>Initial configuration</strong></code></li></ol><ol type="1" id="5ac85359-7d51-4c71-9c4b-7da85fa44743" class="numbered-list" start="2"><li><code><strong>Wazuh indexer nodes installation</strong></code></li></ol><ol type="1" id="9f60ef4d-8843-47c4-9c99-347aa34bf710" class="numbered-list" start="3"><li><code><strong>Cluster initialization</strong></code><strong> </strong></li></ol><figure class="block-color-gray_background callout" style="white-space:pre-wrap;display:flex" id="7bbbc1c7-9463-48be-8197-ce972d3d5ec7"><div style="font-size:1.5em"><span class="icon">ðŸ’¡</span></div><div style="width:100%"><strong>You need root user privileges to run all the commands described below.</strong></div></figure><blockquote id="e1cc9bdc-d099-41b3-929a-ff1e56dd95f8" class=""><mark class="highlight-yellow"><strong>1. Initial configuration</strong></mark></blockquote><p id="4cdebee0-8b04-41f7-a798-f68f58ee9322" class="">Indicate your deployment configuration, create the SSL certificates to encrypt communications between the Wazuh components, and generate random passwords to secure your installation.</p><ol type="1" id="a11001f4-32b9-415b-a9e9-7574bc9c7be9" class="numbered-list" start="1"><li><strong>Download the Wazuh installation assistant and the configuration file.</strong><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="887f9e15-b1cc-4018-99cd-3ee77261e956" class="code"><code class="language-Bash">curl -sO https://packages.wazuh.com/4.3/wazuh-install.sh
curl -sO https://packages.wazuh.com/4.3/config.yml</code></pre><figure id="8ae14a62-7d8c-4858-865d-bc33617e1799" class="image"><a href="Detecting%20Vulnerable-Flask-Application%2028b07495fafd4267886f45a6a50ce273/Untitled%2015.png"><img style="width:680px" src="Detecting%20Vulnerable-Flask-Application%2028b07495fafd4267886f45a6a50ce273/Untitled%2015.png"/></a></figure></li></ol><ol type="1" id="f4b842ee-908e-4983-981c-814204764aab" class="numbered-list" start="2"><li><strong>Edit the </strong><code><strong>./config.yml</strong></code><strong> and replace the node names and IP values with the corresponding names and IP addresses.</strong> You need to do this for all <strong>Wazuh server</strong>, <strong>Wazuh  indexer</strong>, and <strong>Wazuh dashboard</strong> nodes. Add as many node fields as needed.<figure id="bac20402-caa8-41a3-8d15-7ae221c7a84f" class="image"><a href="Detecting%20Vulnerable-Flask-Application%2028b07495fafd4267886f45a6a50ce273/Untitled%2016.png"><img style="width:680px" src="Detecting%20Vulnerable-Flask-Application%2028b07495fafd4267886f45a6a50ce273/Untitled%2016.png"/></a></figure></li></ol><ol type="1" id="40988065-a940-4a18-84a7-bc5f9e86f319" class="numbered-list" start="3"><li><strong>Run the assistant with the option</strong> <code>--generate-config-files</code> to generate the <strong>Wazuh cluster</strong> key, certificates, and passwords necessary for installation. You can find these files in <code>./wazuh-install-files.tar</code>.<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="ba498f83-a90e-4309-8854-5dcf9270711b" class="code"><code class="language-Bash">bash wazuh-install.sh --generate-config-files</code></pre><figure id="bcd07854-b96f-4a5d-9aac-8a6ae9fcb794" class="image"><a href="Detecting%20Vulnerable-Flask-Application%2028b07495fafd4267886f45a6a50ce273/Untitled%2017.png"><img style="width:680px" src="Detecting%20Vulnerable-Flask-Application%2028b07495fafd4267886f45a6a50ce273/Untitled%2017.png"/></a></figure><figure class="block-color-gray_background callout" style="white-space:pre-wrap;display:flex" id="9a32ccf2-ae2c-4835-beb9-dbdacbbd3b32"><div style="font-size:1.5em"><span class="icon">ðŸ’¡</span></div><div style="width:100%">Our system does not comply with recommended considerations, which is why we use the -i option to ignore unnecessary checks.</div></figure><ol type="1" id="8929fe23-14b8-423f-9647-714bc3927d27" class="numbered-list" start="4"><li>Copy the <code>wazuh-install-files.tar</code> file to all the servers of the distributed deployment, including the <strong>Wazuh server</strong>, the <strong>Wazuh indexer</strong>, and the <strong>Wazuh dashboard</strong> nodes. This can be done by using the <code>scp</code> utility.</li></ol></li></ol><hr id="f578a47e-d951-4791-a896-c7900de1694b"/><blockquote id="bb80eb41-44d6-4764-958b-9821c1fa7849" class=""><mark class="highlight-yellow"><strong>2. Wazuh indexer nodes installation</strong></mark></blockquote><p id="a8bd344b-3b10-4778-8c87-ea1dc9a51758" class="">Install and configure the <strong>Wazuh</strong> indexer nodes.</p><ol type="1" id="f47ec7b7-e9b4-47e3-bae2-3268c037c7e6" class="numbered-list" start="1"><li>Download the Wazuh installation assistant.<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="e9dc7932-8367-4c63-9478-85873accbd35" class="code"><code class="language-Bash" style="white-space:pre-wrap;word-break:break-all">curl -sO https://packages.wazuh.com/4.3/wazuh-install.sh</code></pre></li></ol><ol type="1" id="72870a71-c59a-4dfd-a6f6-cb15c39b023e" class="numbered-list" start="2"><li>Run the assistant with the option <code>-wazuh-indexer</code> and the node name to install and configure the <strong>Wazuh indexer</strong>. The node name must be the same one used in <code>config.yml</code> for the initial configuration, for example, <code>node-1</code>.<figure class="block-color-gray_background callout" style="white-space:pre-wrap;display:flex" id="6d232125-66ed-438d-9b8d-c4e77f683cbe"><div style="font-size:1.5em"><span class="icon">ðŸ’¡</span></div><div style="width:100%">Make sure that a copy of <code>wazuh-install-files.tar</code>, created during the initial configuration step, is placed in your working directory.</div></figure><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="cdd4d28d-1c4c-4485-9dfa-2fbe8b3379ce" class="code"><code class="language-Bash">bash wazuh-install.sh --wazuh-indexer node-1</code></pre><figure id="0ab53649-3562-4e29-bbfb-7d3d4b3a2825" class="image"><a href="Detecting%20Vulnerable-Flask-Application%2028b07495fafd4267886f45a6a50ce273/Untitled%2018.png"><img style="width:680px" src="Detecting%20Vulnerable-Flask-Application%2028b07495fafd4267886f45a6a50ce273/Untitled%2018.png"/></a></figure><figure class="block-color-gray_background callout" style="white-space:pre-wrap;display:flex" id="83805e33-e2b5-4043-95ba-fb863c6c87e3"><div style="font-size:1.5em"><span class="icon">ðŸ’¡</span></div><div style="width:100%">Our system does not comply with recommended considerations, which is why we use the -i option to ignore unnecessary checks.</div></figure><p id="0dc7b2a1-1fae-4e89-8157-9bd469b5f000" class="">Repeat this stage of the installation process for every <strong>Wazuh indexer</strong> node in your cluster. Then proceed with initializing your <strong>single-node</strong> or <strong>multi-node</strong> cluster in the next stage.</p><hr id="59314f77-f17b-479f-b373-2d53db8c4d5e"/></li></ol><blockquote id="e24e2b1a-507d-4634-ace4-72dd657a6c4b" class=""><mark class="highlight-yellow"><strong>3. Cluster initialization</strong></mark></blockquote><p id="98b4ca6b-27f5-4853-9d56-476890a45fd3" class="">The final stage of installing the <strong>Wazuh indexer</strong> <em>single-node</em> or <em>multi-node</em> cluster consists of running the security admin script.</p><ol type="1" id="16811ba8-ed83-4d97-bcf5-4a55c969fea8" class="numbered-list" start="1"><li>Run the Wazuh installation assistant with option <code>-start-cluster</code> on any <strong>Wazuh indexer</strong> node to load the new certificates information and start the cluster.<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="f8fc22b2-2c3a-4a8f-97c3-d79490fac0ea" class="code"><code class="language-Bash">bash wazuh-install.sh --start-cluster</code></pre><figure id="543b3c01-4952-490b-a4da-12a597538875" class="image"><a href="Detecting%20Vulnerable-Flask-Application%2028b07495fafd4267886f45a6a50ce273/Untitled%2019.png"><img style="width:680px" src="Detecting%20Vulnerable-Flask-Application%2028b07495fafd4267886f45a6a50ce273/Untitled%2019.png"/></a></figure><figure class="block-color-gray_background callout" style="white-space:pre-wrap;display:flex" id="5579b7bd-f742-4e44-8df3-2652848681fd"><div style="font-size:1.5em"><span class="icon">ðŸ’¡</span></div><div style="width:100%">You only have to initialize the cluster once, there is no need to run this command on every node.</div></figure></li></ol><blockquote id="e154ab6f-8cff-4351-8fd9-7c4219de4559" class=""><mark class="highlight-teal"><strong>Testing the cluster installation</strong></mark></blockquote><ol type="1" id="e368f358-e812-479a-bbf6-a6bf46cd9a0f" class="numbered-list" start="1"><li>Run the following command to get the <em>admin</em> password:<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="a9579aeb-1134-43e4-8713-5ddcda13dbba" class="code"><code class="language-Bash" style="white-space:pre-wrap;word-break:break-all">curl -k -u admin:&lt;ADMIN_PASSWORD&gt; https://&lt;WAZUH_INDEXER_IP&gt;:9200</code></pre><figure id="94bd7a07-2652-4434-b5b2-e134b4f4b573" class="image"><a href="Detecting%20Vulnerable-Flask-Application%2028b07495fafd4267886f45a6a50ce273/Untitled%2020.png"><img style="width:680px" src="Detecting%20Vulnerable-Flask-Application%2028b07495fafd4267886f45a6a50ce273/Untitled%2020.png"/></a></figure></li></ol><ol type="1" id="5dbaed94-b465-4d45-9688-8ae6a20ed361" class="numbered-list" start="2"><li>Run the following command to confirm that the installation is successful. Replace <code>&lt;ADMIN_PASSWORD&gt;</code> with the password gotten from the output of the previous command. Replace <code>&lt;WAZUH_INDEXER_IP&gt;</code> with the configured <strong>Wazuh indexer IP </strong>address:<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="42cef131-6a15-4dad-9cf8-444105bf8fc0" class="code"><code class="language-Bash">curl -k -u admin:&lt;ADMIN_PASSWORD&gt; https://&lt;WAZUH_INDEXER_IP&gt;:9200</code></pre><figure id="7ede0099-afc0-4403-9404-ee64767fce0e" class="image"><a href="Detecting%20Vulnerable-Flask-Application%2028b07495fafd4267886f45a6a50ce273/Untitled%2021.png"><img style="width:680px" src="Detecting%20Vulnerable-Flask-Application%2028b07495fafd4267886f45a6a50ce273/Untitled%2021.png"/></a></figure></li></ol><ol type="1" id="3344835a-1894-4e97-be2a-a109ae34e997" class="numbered-list" start="3"><li>Replace <code>&lt;WAZUH_INDEXER_IP&gt;</code> and <code>&lt;ADMIN_PASSWORD&gt;</code>, and run the following command to check if the cluster is working correctly:<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="2a9277f2-8023-4a69-84f4-9205e654a171" class="code"><code class="language-Bash">curl -k -u admin:&lt;ADMIN_PASSWORD&gt; https://&lt;WAZUH_INDEXER_IP&gt;:9200/_cat/nodes?v</code></pre><figure id="346b1ec5-9499-4d5d-9b7d-adba11bd6ff8" class="image"><a href="Detecting%20Vulnerable-Flask-Application%2028b07495fafd4267886f45a6a50ce273/Untitled%2022.png"><img style="width:680px" src="Detecting%20Vulnerable-Flask-Application%2028b07495fafd4267886f45a6a50ce273/Untitled%2022.png"/></a></figure></li></ol><p id="b77ae93d-c608-4a14-92e7-92b4cdd7a367" class="">The <strong>Wazuh indexer</strong> is now successfully installed, and you can proceed with installing the <strong>Wazuh server</strong>. </p><blockquote id="44212464-074d-41f5-8c96-9a06e4fb72c5" class=""><mark class="highlight-blue"><strong>Wazuh Server</strong></mark></blockquote><p id="8170340a-e058-4c3c-8dee-a1976fc3b67a" class="">The <strong>Wazuh server</strong> analyzes data received from <strong>Wazuh agents</strong>, triggering alerts when threats or anomalies are detected. It also allows for remote management of agent configurations and monitoring their status.</p><p id="830d35bd-968b-4bcd-965a-1f48fe363ce0" class="">You can install the <strong>Wazuh server</strong> on a <em>single host</em> or distribute it across <em>multiple nodes</em> in a cluster configuration. Multi-node configurations offer high availability and improved performance. When combined with a network load balancer, this setup can efficiently utilize its capacity.</p><figure id="c9154641-6872-4e9d-89a7-5340021d1a9e" class="image"><a href="Detecting%20Vulnerable-Flask-Application%2028b07495fafd4267886f45a6a50ce273/Untitled%2023.png"><img style="width:708px" src="Detecting%20Vulnerable-Flask-Application%2028b07495fafd4267886f45a6a50ce273/Untitled%2023.png"/></a></figure><blockquote id="434ae622-ae35-4169-b560-90f93c7a9ae6" class=""><mark class="highlight-blue"><strong>Wazuh server cluster installation</strong></mark></blockquote><ol type="1" id="ad3c556f-c52b-463f-87f4-05ff71e5073c" class="numbered-list" start="1"><li>Download the Wazuh installation assistant:<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="d5cf0e22-6cda-4e5c-a402-53a7f697f8e5" class="code"><code class="language-Bash">curl -sO https://packages.wazuh.com/4.3/wazuh-install.sh</code></pre></li></ol><ol type="1" id="2fb32ebb-dff0-4523-8e70-967ace96d66e" class="numbered-list" start="2"><li><strong>Run the assistant with the option</strong> <code>--wazuh-server</code> followed by the node name to install the <strong>Wazuh server</strong>. The node name must be the same one used in <code>config.yml</code> for the initial configuration, for example, <code>wazuh-1</code>.<figure class="block-color-gray_background callout" style="white-space:pre-wrap;display:flex" id="7a3175b0-fcf9-4025-bbed-028e41ba65e0"><div style="font-size:1.5em"><span class="icon">ðŸ’¡</span></div><div style="width:100%">Make sure that a copy of the <code>wazuh-install-files.tar</code>, created during the initial configuration step, is placed in your working directory.</div></figure><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="6ab8542d-114b-499d-8254-4f444a481a0f" class="code"><code class="language-Bash">bash wazuh-install.sh --wazuh-server wazuh-1</code></pre><figure id="b653b165-00bb-4669-8c10-178027c052ab" class="image"><a href="Detecting%20Vulnerable-Flask-Application%2028b07495fafd4267886f45a6a50ce273/Untitled%2024.png"><img style="width:680px" src="Detecting%20Vulnerable-Flask-Application%2028b07495fafd4267886f45a6a50ce273/Untitled%2024.png"/></a></figure><figure class="block-color-gray_background callout" style="white-space:pre-wrap;display:flex" id="355d41bf-b6f4-4467-a84f-7e9766c63b33"><div style="font-size:1.5em"><span class="icon">ðŸ’¡</span></div><div style="width:100%">Our system does not comply with recommended considerations, which is why we use the -i option to ignore unnecessary checks.</div></figure><p id="7371c748-5b99-4098-8fb0-91317815b8d3" class=""><strong>Your Wazuh server is now successfully installed.</strong></p><ul id="28bd9c77-5b5a-41bf-baf8-ec4556208f55" class="bulleted-list"><li style="list-style-type:disc">If you want a <strong>Wazuh server</strong> <em>single-node cluster</em>, everything is set and you can proceed directly with <em>Installing the Wazuh dashboard using the assistant</em>.</li></ul><ul id="4074d39b-8d0e-4ed9-9860-18d66301cf53" class="bulleted-list"><li style="list-style-type:disc">If you want a <strong>Wazuh server</strong> <em>multi-node cluster</em>, repeat this process on every <strong>Wazuh server </strong>node.</li></ul></li></ol><p id="0563b2bc-fe01-4d94-979d-4f2c78bd9cd3" class="">The <strong>Wazuh server</strong> installation is now complete, and you can proceed with installing the Wazuh dashboard.</p><hr id="85d5b03f-2924-4d9c-9267-af33515b1a17"/><blockquote id="478c9509-8461-4fbf-8e15-c6f735b17819" class=""><mark class="highlight-red"><strong>Wazuh Dashboard</strong></mark></blockquote><p id="c4929644-0149-4711-9a53-f8dd755c57d0" class="">The <strong>Wazuh dashboard</strong> is a flexible and intuitive web interface for mining, analyzing, and visualizing security data. It provides out-of-the-box dashboards, allowing seamless navigation through the user interface.</p><p id="8577e290-3c51-4b35-a6a6-467a2183ea8a" class="">With the <strong>Wazuh dashboard</strong>, users can visualize security events, detected vulnerabilities, file integrity monitoring data, configuration assessment results, cloud infrastructure monitoring events, and regulatory compliance standards.</p><figure id="d83cb7e0-7d09-408f-a01e-a2a01f4b5e11" class="image"><a href="Detecting%20Vulnerable-Flask-Application%2028b07495fafd4267886f45a6a50ce273/Untitled%2025.png"><img style="width:708px" src="Detecting%20Vulnerable-Flask-Application%2028b07495fafd4267886f45a6a50ce273/Untitled%2025.png"/></a></figure><blockquote id="abab8f55-bcae-4788-9d1e-bfb894e73424" class=""><mark class="highlight-red"><strong>Wazuh dashboard installation</strong></mark></blockquote><ol type="1" id="b308c869-6a99-429c-9b6e-a2dfda869020" class="numbered-list" start="1"><li>Download the Wazuh installation assistant. This step can be skipped if you have already installed <strong>Wazuh indexer</strong> on the same server.<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="ff4a866a-708a-4078-b3ed-64e936f13624" class="code"><code class="language-Bash">curl -sO https://packages.wazuh.com/4.3/wazuh-install.sh</code></pre></li></ol><ol type="1" id="07c05dae-22f4-42ca-b2e5-c6b0b02fb8c9" class="numbered-list" start="2"><li>Run the assistant with the option <code>--wazuh-dashboard</code> and the node name to install and configure the <strong>Wazuh dashboard</strong>. The node name must be the same one used in <code>config.yml</code> for the initial configuration, for example, <code>dashboard</code>.<figure class="block-color-gray_background callout" style="white-space:pre-wrap;display:flex" id="1da930e9-4972-4fdd-a6ca-5981de6bba62"><div style="font-size:1.5em"><span class="icon">ðŸ’¡</span></div><div style="width:100%">Make sure that a copy of the <code>wazuh-install-files.tar</code>, created during the initial configuration step, is placed in your working directory.</div></figure><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="a56ae230-67c3-4eae-b40a-f2104c18f0a6" class="code"><code class="language-Bash">bash wazuh-install.sh --wazuh-dashboard dashboard</code></pre><figure id="484b4497-b9be-4724-b89d-4fdc9e43251e" class="image"><a href="Detecting%20Vulnerable-Flask-Application%2028b07495fafd4267886f45a6a50ce273/Untitled%2026.png"><img style="width:680px" src="Detecting%20Vulnerable-Flask-Application%2028b07495fafd4267886f45a6a50ce273/Untitled%2026.png"/></a></figure><figure class="block-color-gray_background callout" style="white-space:pre-wrap;display:flex" id="81063a33-1d80-439e-8636-6b241a3c0490"><div style="font-size:1.5em"><span class="icon">ðŸ’¡</span></div><div style="width:100%">Our system does not comply with recommended considerations, which is why we use the -i option to ignore unnecessary checks.</div></figure><p id="ffdaf9bd-2176-4353-b6f5-db5980abcc77" class="">Once the assistant finishes the installation, the output shows the access credentials and a message that confirms that the installation was successful.</p><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="1a35ccda-a9f8-4cdd-a143-b2860265c5ca" class="code"><code class="language-Bash">INFO: --- Summary ---
INFO: You can access the web interface https://&lt;wazuh-dashboard-ip&gt;
   User: admin
   Password: &lt;ADMIN_PASSWORD&gt;

INFO: Installation finished.</code></pre><p id="f50e4187-0a6f-4408-86e6-6be493364c5b" class="">You now have installed and configured <strong>Wazuh</strong>. All passwords generated by the <strong>Wazuh</strong> installation assistant can be found in the <code>wazuh-passwords.txt</code> file inside the <code>wazuh-install-files.tar</code> archive. To print them, run the following command:</p><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="1c32b1f8-90d4-433e-af0b-4336ef8a9052" class="code"><code class="language-Bash">tar -O -xvf wazuh-install-files.tar wazuh-install-files/wazuh-passwords.txt</code></pre><figure id="7f8b8c63-94c6-48dc-b710-fbfedb2b1d98" class="image"><a href="Detecting%20Vulnerable-Flask-Application%2028b07495fafd4267886f45a6a50ce273/Untitled%2027.png"><img style="width:680px" src="Detecting%20Vulnerable-Flask-Application%2028b07495fafd4267886f45a6a50ce273/Untitled%2027.png"/></a></figure></li></ol><ol type="1" id="0ddad21d-4b5e-4a60-9d73-bdab446c9060" class="numbered-list" start="3"><li>Access the <strong>Wazuh</strong> web interface with your credentials.<ol type="a" id="2b17c6f5-0912-4ec9-afdd-e9f8230a5892" class="numbered-list" start="1"><li><strong>URL</strong>: <em>https://&lt;wazuh-dashboard-ip&gt;</em></li></ol><ol type="a" id="e6b1782f-68d7-44bf-8af9-4470e4940bc9" class="numbered-list" start="2"><li><strong>Username</strong>: <em>admin</em></li></ol><ol type="a" id="270e80bd-459c-411b-bb6a-3945bbd0a1cc" class="numbered-list" start="3"><li><strong>Password</strong>: <em>&lt;ADMIN_PASSWORD&gt;</em></li></ol><figure id="c117dda9-3dfe-4c04-9da6-03f4778be4bc" class="image"><a href="Detecting%20Vulnerable-Flask-Application%2028b07495fafd4267886f45a6a50ce273/Untitled%2028.png"><img style="width:680px" src="Detecting%20Vulnerable-Flask-Application%2028b07495fafd4267886f45a6a50ce273/Untitled%2028.png"/></a></figure><figure id="f02ef535-d813-4d24-8cf6-3cf35b1da39a" class="image"><a href="Detecting%20Vulnerable-Flask-Application%2028b07495fafd4267886f45a6a50ce273/Untitled%2029.png"><img style="width:680px" src="Detecting%20Vulnerable-Flask-Application%2028b07495fafd4267886f45a6a50ce273/Untitled%2029.png"/></a></figure><figure id="4d1ce2a5-dad9-427f-a218-16b1197fefab" class="image"><a href="Detecting%20Vulnerable-Flask-Application%2028b07495fafd4267886f45a6a50ce273/Untitled%2030.png"><img style="width:680px" src="Detecting%20Vulnerable-Flask-Application%2028b07495fafd4267886f45a6a50ce273/Untitled%2030.png"/></a></figure><figure id="35ad8832-4957-4ce3-9c57-e2b0adf4892d" class="image"><a href="Detecting%20Vulnerable-Flask-Application%2028b07495fafd4267886f45a6a50ce273/Untitled%2031.png"><img style="width:680px" src="Detecting%20Vulnerable-Flask-Application%2028b07495fafd4267886f45a6a50ce273/Untitled%2031.png"/></a></figure><p id="ea5bc778-d742-4215-b47e-f0d250c68748" class="">When you access the <strong>Wazuh dashboard</strong> for the first time, the browser shows a warning message stating that the certificate was not issued by a trusted authority. An exception can be added in the advanced options of the web browser. For increased security, the <code>root-ca.pem</code> file previously generated can be imported to the certificate manager of the browser instead. Alternatively, a certificate from a trusted authority can be configured.</p><hr id="b1583ba3-90c2-4c50-83a1-923e887cc8ec"/></li></ol><h3 id="b5113c46-e804-4a7e-8a6a-9fddf19b4668" class="">1.4.3 Wazuh Cloud</h3><p id="9d6f7e69-2b6e-42d9-8ccd-2445f6d7a697" class=""><strong>Wazuh Cloud</strong> is a <em>cloud-based</em> security monitoring solution that provides organizations with a comprehensive approach to <em>security information</em> and <em>event management</em> (<strong>SIEM</strong>) and extended detection and response (<strong>XDR</strong>). Below are the key details about <strong>Wazuh Cloud</strong>:</p><figure id="6225bf58-4009-4fea-b166-862bc8d14af4" class="image"><a href="Detecting%20Vulnerable-Flask-Application%2028b07495fafd4267886f45a6a50ce273/Untitled%2032.png"><img style="width:708px" src="Detecting%20Vulnerable-Flask-Application%2028b07495fafd4267886f45a6a50ce273/Untitled%2032.png"/></a></figure><p id="44bbdea2-449e-402b-86c0-871985636998" class=""><strong>Wazuh Cloud</strong> enables organizations to monitor their <strong>IT infrastructure</strong>, including <em>on-premises</em>, <em>cloud</em>, and <em>hybrid</em> environments, by leveraging the capabilities of the <strong>Wazuh</strong> platform. It provides a centralized view of security events and incidents, allowing for real-time analysis and response.</p><p id="d4eced07-487c-4eb7-8527-3586ed8caa4f" class=""><strong>Key Features</strong></p><ol type="1" id="ac40f542-92b5-46d8-9704-3e525e9d209f" class="numbered-list" start="1"><li><strong>Centralized Management</strong>:<ul id="55227a92-fd08-4bd1-aa38-b55f938556ec" class="bulleted-list"><li style="list-style-type:disc"><strong>Wazuh Cloud</strong> allows for the centralized management of security events from multiple sources, including servers, workstations, and cloud services.</li></ul></li></ol><ol type="1" id="f6c13b52-fbea-4202-a2e5-0bb4acc25cc9" class="numbered-list" start="2"><li><strong>Real-time Monitoring</strong>:<ul id="911e44d5-672c-4369-acb6-119bd27a8c6e" class="bulleted-list"><li style="list-style-type:disc">The platform provides real-time monitoring of security events, enabling organizations to detect threats and anomalies as they occur.</li></ul></li></ol><ol type="1" id="d712b239-48db-4fff-9319-9f7b6a8c5b3a" class="numbered-list" start="3"><li><strong>Scalability</strong>:<ul id="780241a7-aa91-43a9-9f6f-71e8acf0aeed" class="bulleted-list"><li style="list-style-type:disc">Wazuh Cloud is designed to scale with the organization&#x27;s needs, allowing for the addition of new agents and resources without significant overhead.</li></ul></li></ol><ol type="1" id="0766f37e-add4-4bb8-ab13-3971635c9d69" class="numbered-list" start="4"><li><strong>Compliance Management</strong>:<ul id="d61ded86-7d44-4032-aba8-09e25c0e519e" class="bulleted-list"><li style="list-style-type:disc">Wazuh Cloud helps organizations meet compliance requirements by providing tools for auditing and reporting on security events.</li></ul></li></ol><ol type="1" id="75d9cf22-d04a-48fc-ba48-651ee86ecaeb" class="numbered-list" start="5"><li><strong>Integration with Cloud Providers</strong>:<ul id="e28ca5dd-141c-4e75-b1bc-6c124e246d8f" class="bulleted-list"><li style="list-style-type:disc">The solution supports integrations with major cloud service providers, allowing for seamless monitoring of cloud resources.</li></ul></li></ol><ol type="1" id="97e9e82e-fcb2-4221-acf0-66212b29d827" class="numbered-list" start="6"><li><strong>Threat Intelligence</strong>:<ul id="cf7c4aa7-6081-441b-ada0-26f8c78261a3" class="bulleted-list"><li style="list-style-type:disc">Wazuh Cloud incorporates threat intelligence feeds to enhance the detection capabilities and provide context around security events.</li></ul></li></ol><figure id="8043db91-c3b0-454c-8c1a-ee38734d4626" class="image"><a href="Detecting%20Vulnerable-Flask-Application%2028b07495fafd4267886f45a6a50ce273/Untitled%2033.png"><img style="width:708px" src="Detecting%20Vulnerable-Flask-Application%2028b07495fafd4267886f45a6a50ce273/Untitled%2033.png"/></a></figure><p id="e9c2e6e4-1b5d-4797-817d-91c52195240a" class=""><strong>Trial Offer</strong></p><p id="318560e5-e831-432e-b220-f1458b5343aa" class="">The trial lasts for <strong>14 days</strong>, allowing organizations to explore the features and capabilities of <strong>Wazuh Cloud</strong> without any commitment.</p><figure id="74ca0818-bf49-4374-9eb3-f8edf2ef1fbc" class="image"><a href="Detecting%20Vulnerable-Flask-Application%2028b07495fafd4267886f45a6a50ce273/Untitled%2034.png"><img style="width:708px" src="Detecting%20Vulnerable-Flask-Application%2028b07495fafd4267886f45a6a50ce273/Untitled%2034.png"/></a></figure><p id="a18dce9c-4315-4a75-a4bf-de3834b7d62a" class="">During the <em>trial</em>, users can access all the functionalities of <strong>Wazuh Cloud</strong>, including <em>agent management</em>, <em>alerting</em>, <em>reporting</em>, and compliance features.</p><figure class="block-color-gray_background callout" style="white-space:pre-wrap;display:flex" id="313f394e-2830-4faf-813c-dd0ec7d83cc9"><div style="font-size:1.5em"><span class="icon">ðŸ’¡</span></div><div style="width:100%">The trial version is offered free of charge and without the use of a <strong>credit card</strong>, making it a great opportunity for organizations to evaluate the solution.<br/>After the trial period, organizations can choose from several pricing plans based on their requirements:<br/></div></figure><figure id="8c3d466e-cc4c-4601-9098-a5f6db2571ea" class="image"><a href="Detecting%20Vulnerable-Flask-Application%2028b07495fafd4267886f45a6a50ce273/Untitled%2035.png"><img style="width:708px" src="Detecting%20Vulnerable-Flask-Application%2028b07495fafd4267886f45a6a50ce273/Untitled%2035.png"/></a></figure><p id="342a1e9e-2bd9-4e7f-8a04-d1b364595bab" class=""><strong>Wazuh Cloud</strong> is a valuable tool for organizations looking to enhance their security posture. For more information or to sign up for the trial, you can visit the official <strong>Wazuh</strong> website.</p><hr id="8094545d-8efe-412a-805c-271f9ca17d6c"/><h1 id="f5701a41-c0a7-4e7c-b63f-cafe4936e059" class="">2. Configuring Wazuh SIEM</h1><h2 id="bfc696e3-aae5-4854-bfb1-8941c809e13c" class="">2.1 Configuring Wazuh to Monitor Docker Containers</h2><p id="4c9eaefb-239d-4491-9e49-156544af366e" class="">To effectively monitor <strong>Docker containers</strong> using <strong>Wazuh</strong>, you need to configure both the <strong>Wazuh Manager</strong> and the <strong>Wazuh Agent</strong>. This section provides a step-by-step guide on how to set up <strong>Wazuh</strong> to collect logs from <strong>Docker containers</strong>, including installing and configuring the <strong>Wazuh Agent</strong>.</p><h3 id="12df3dd1-4c89-464b-956d-1260ef50920e" class="">2.1.1 Installing Wazuh Agent on Docker Host</h3><p id="a179f03e-94b3-4579-824d-44fb60240234" class="">You can install the <strong>Wazuh agent</strong> on the <strong>Docker host</strong> (<em>the machine where your Docker containers are running</em>) in two primary ways: <strong>manually</strong> or through the <strong>Wazuh UI</strong>. Below, Iâ€™ll outline both methods for installing the Wazuh agent.</p><ol type="1" id="86cb753d-f27e-4ea9-86fe-874c46d7b943" class="numbered-list" start="1"><li><strong>Add Wazuh Repository and Install Agent:</strong><ol type="a" id="e4dc14bd-97fd-4b46-9405-95ac7bbb7db2" class="numbered-list" start="1"><li>First, add the <strong>Wazuh</strong> repository and install the Wazuh Agent on the host where Docker is running.<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="c17f73be-3ee1-424d-a5f9-0d5d4024f102" class="code"><code class="language-Bash">curl -s https://packages.wazuh.com/key/GPG-KEY-WAZUH | gpg --no-default-keyring --keyring gnupg-ring:/usr/share/keyrings/wazuh.gpg --import &amp;&amp; chmod 644 /usr/share/keyrings/wazuh.gpg
echo &quot;deb [signed-by=/usr/share/keyrings/wazuh.gpg] https://packages.wazuh.com/4.x/apt/ stable main&quot; | tee -a /etc/apt/sources.list.d/wazuh.list
apt-get update</code></pre><figure id="63c28ab3-5a21-4bec-839b-1b9e4ebcea09" class="image"><a href="Detecting%20Vulnerable-Flask-Application%2028b07495fafd4267886f45a6a50ce273/Untitled%2036.png"><img style="width:652px" src="Detecting%20Vulnerable-Flask-Application%2028b07495fafd4267886f45a6a50ce273/Untitled%2036.png"/></a></figure><figure class="block-color-gray_background callout" style="white-space:pre-wrap;display:flex" id="354dd4b3-1c47-4873-9a15-199fa9de0054"><div style="font-size:1.5em"><span class="icon">ðŸ’¡</span></div><div style="width:100%">For Debian 7, 8, and Ubuntu 14 systems import the GCP key and add the Wazuh repository (steps 1 and 2) using the following commands.<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="1638ae2d-451d-4c80-b103-cfac09be2264" class="code"><code class="language-Bash">apt-get install gnupg apt-transport-https
curl -s https://packages.wazuh.com/key/GPG-KEY-WAZUH | apt-key add -
echo &quot;deb https://packages.wazuh.com/4.x/apt/ stable main&quot; | tee -a /etc/apt/sources.list.d/wazuh.list</code></pre></div></figure></li></ol></li></ol><ol type="1" id="62eacd02-48fb-4cc0-9dcf-c31d2f91772a" class="numbered-list" start="2"><li><strong>Deploy a Wazuh agent</strong><ol type="a" id="562b3140-72c8-457b-88f8-61907bf6ebb7" class="numbered-list" start="1"><li>To deploy the <strong>Wazuh agent</strong> on your endpoint, select your package manager and edit the <code>WAZUH_MANAGER</code> variable to contain your <strong>Wazuh manager IP</strong> address or hostname.<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="cc907581-1d2e-4a27-990f-ed4cb0d220f8" class="code"><code class="language-Bash">WAZUH_MANAGER=&quot;IP_ADDRESS&quot; apt-get install wazuh-agent</code></pre><figure id="1b130258-7181-467f-b1f3-5c0b96ed4da0" class="image"><a href="Detecting%20Vulnerable-Flask-Application%2028b07495fafd4267886f45a6a50ce273/Untitled%2037.png"><img style="width:652px" src="Detecting%20Vulnerable-Flask-Application%2028b07495fafd4267886f45a6a50ce273/Untitled%2037.png"/></a></figure><figure id="03bdb53f-b5f3-4892-b63b-ccd9452645cc" class="image"><a href="Detecting%20Vulnerable-Flask-Application%2028b07495fafd4267886f45a6a50ce273/Untitled%2038.png"><img style="width:652px" src="Detecting%20Vulnerable-Flask-Application%2028b07495fafd4267886f45a6a50ce273/Untitled%2038.png"/></a></figure></li></ol></li></ol><ol type="1" id="b00527cb-43e3-4ba1-ae86-11c9cc9bda8c" class="numbered-list" start="3"><li><strong>Enable and start the Wazuh agent service</strong><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="a9e5af9e-b7a9-4fa0-8e42-bb819bb458bf" class="code"><code class="language-Bash">systemctl daemon-reload
systemctl enable wazuh-agent
systemctl start wazuh-agent</code></pre><figure id="cf3ea835-0097-4f12-879e-c83584b73339" class="image"><a href="Detecting%20Vulnerable-Flask-Application%2028b07495fafd4267886f45a6a50ce273/Untitled%2039.png"><img style="width:680px" src="Detecting%20Vulnerable-Flask-Application%2028b07495fafd4267886f45a6a50ce273/Untitled%2039.png"/></a></figure><figure id="3eb017ba-00cf-4f1a-ac80-0b3ede0824b1" class="image"><a href="Detecting%20Vulnerable-Flask-Application%2028b07495fafd4267886f45a6a50ce273/Untitled%2040.png"><img style="width:684px" src="Detecting%20Vulnerable-Flask-Application%2028b07495fafd4267886f45a6a50ce273/Untitled%2040.png"/></a></figure></li></ol><p id="96423ffa-3adb-40b0-a5c1-0901676d53b4" class="">The deployment process is now complete, and the <strong>Wazuh agent</strong> is successfully running on your <strong>Linux system</strong>.</p><figure class="block-color-gray_background callout" style="white-space:pre-wrap;display:flex" id="10f160c5-4608-4a85-a3ee-3cd8b73b3376"><div style="font-size:1.5em"><span class="icon">ðŸ’¡</span></div><div style="width:100%">The previous steps were for <strong>manual</strong> <strong>Wazuh Agent</strong> installation, but if you want to make it faster and easier, use the<strong> Wazuh UI</strong> to add agents.</div></figure><p id="8a4f72bb-c8f6-43ce-aa4d-aa54a298dc4e" class=""><strong>Follow these steps to enroll an agent:</strong></p><ol type="1" id="adcb5988-03e1-4127-ad2b-3fb2ac79ef0b" class="numbered-list" start="1"><li>Log into the <strong>Wazuh WUI</strong>.<figure id="ab1753c8-3df1-46b4-9f50-49a45665cd61" class="image"><a href="Detecting%20Vulnerable-Flask-Application%2028b07495fafd4267886f45a6a50ce273/Untitled%2041.png"><img style="width:680px" src="Detecting%20Vulnerable-Flask-Application%2028b07495fafd4267886f45a6a50ce273/Untitled%2041.png"/></a></figure></li></ol><ol type="1" id="b80b5e1f-988a-44e9-a06c-aa33be8fe983" class="numbered-list" start="2"><li>Click the upper-left <strong>Wazuh</strong> icon and then <strong>Agents</strong>.<figure id="35686321-e10d-4664-828e-fd7a3f40a6ac" class="image"><a href="Detecting%20Vulnerable-Flask-Application%2028b07495fafd4267886f45a6a50ce273/Untitled%2042.png"><img style="width:680px" src="Detecting%20Vulnerable-Flask-Application%2028b07495fafd4267886f45a6a50ce273/Untitled%2042.png"/></a></figure><figure id="728c0a2a-6a13-434a-866a-6261adc9aae5" class="image"><a href="Detecting%20Vulnerable-Flask-Application%2028b07495fafd4267886f45a6a50ce273/Untitled%2043.png"><img style="width:680px" src="Detecting%20Vulnerable-Flask-Application%2028b07495fafd4267886f45a6a50ce273/Untitled%2043.png"/></a></figure><figure id="8da4ba3f-c506-433a-8a42-5f824ca1b78f" class="image"><a href="Detecting%20Vulnerable-Flask-Application%2028b07495fafd4267886f45a6a50ce273/Untitled%2044.png"><img style="width:680px" src="Detecting%20Vulnerable-Flask-Application%2028b07495fafd4267886f45a6a50ce273/Untitled%2044.png"/></a></figure></li></ol><ol type="1" id="dd79f87a-b563-4153-8b71-c14211743470" class="numbered-list" start="3"><li>Click <strong>Deploy new agent</strong>.</li></ol><ol type="1" id="59306923-70d1-4866-ae6f-813d60417283" class="numbered-list" start="4"><li>Follow the steps described on the <strong>Deploy a new agent</strong> page.<figure id="ab9f1026-f806-48ae-927c-8f4972bef6fe" class="image"><a href="Detecting%20Vulnerable-Flask-Application%2028b07495fafd4267886f45a6a50ce273/Untitled%2045.png"><img style="width:680px" src="Detecting%20Vulnerable-Flask-Application%2028b07495fafd4267886f45a6a50ce273/Untitled%2045.png"/></a></figure><figure id="e37bfc98-3608-47fc-8fc2-6a83a3d7337d" class="image"><a href="Detecting%20Vulnerable-Flask-Application%2028b07495fafd4267886f45a6a50ce273/Untitled%2046.png"><img style="width:680px" src="Detecting%20Vulnerable-Flask-Application%2028b07495fafd4267886f45a6a50ce273/Untitled%2046.png"/></a></figure></li></ol><h3 id="820e9e53-f96d-4bc8-afb5-4b9097be353a" class="">2.1.2 Monitoring Docker events</h3><p id="57b58f88-bd11-4c40-b68e-e578509a1498" class=""><strong>Docker</strong> automates the deployment of different applications inside software containers. The <strong>Wazuh module</strong> for<strong> Docker</strong> identifies security incidents across containers and alerts in real-time. In this use case, you configure <strong>Wazuh</strong> to monitor <strong>Docker events</strong> on an <strong>Ubuntu</strong> endpoint hosting Docker containers.<br/>Before you start monitoring <br/><strong>Docker</strong> containers with <strong>Wazuh</strong>, it&#x27;s essential to enable the <strong>Docker Listener</strong> module in the <strong>Wazuh UI</strong>. This module allows the <strong>Wazuh</strong> agent to capture <strong>Docker</strong> events and forward them to the <strong>Wazuh</strong> server for analysis.</p><figure id="ee7f784d-3045-467a-850e-81e2a1f237c6" class="image"><a href="Detecting%20Vulnerable-Flask-Application%2028b07495fafd4267886f45a6a50ce273/Untitled%2047.png"><img style="width:708px" src="Detecting%20Vulnerable-Flask-Application%2028b07495fafd4267886f45a6a50ce273/Untitled%2047.png"/></a></figure><figure id="b6c0f3d2-e925-4405-b206-b93bd5b82f41" class="image"><a href="Detecting%20Vulnerable-Flask-Application%2028b07495fafd4267886f45a6a50ce273/Untitled%2048.png"><img style="width:708px" src="Detecting%20Vulnerable-Flask-Application%2028b07495fafd4267886f45a6a50ce273/Untitled%2048.png"/></a></figure><figure id="a72ce114-9c14-4354-8dbe-8d3275cd0fb3" class="image"><a href="Detecting%20Vulnerable-Flask-Application%2028b07495fafd4267886f45a6a50ce273/Untitled%2049.png"><img style="width:708px" src="Detecting%20Vulnerable-Flask-Application%2028b07495fafd4267886f45a6a50ce273/Untitled%2049.png"/></a></figure><p id="16c4bf78-b11a-4925-9cee-7db7ba99bf33" class="">Perform the following steps to install <strong>Docker</strong> on the <strong>Ubuntu</strong> endpoint and configure <strong>Wazuh</strong> to monitor <strong>Docker</strong> events.</p><ol type="1" id="87234f0a-86f3-4572-a936-6d4a81c69add" class="numbered-list" start="1"><li><strong>Install Python and pip</strong>:<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="7d533b4f-a5d1-4806-ba4c-451d647fa89f" class="code"><code class="language-Bash" style="white-space:pre-wrap;word-break:break-all">sudo apt install python3 python3-pip</code></pre><figure id="c91398e1-5377-4767-9e75-72060c17526e" class="image"><a href="Detecting%20Vulnerable-Flask-Application%2028b07495fafd4267886f45a6a50ce273/Untitled%2050.png"><img style="width:680px" src="Detecting%20Vulnerable-Flask-Application%2028b07495fafd4267886f45a6a50ce273/Untitled%2050.png"/></a></figure></li></ol><ol type="1" id="0603545c-33d4-46eb-8208-9a6bd8537774" class="numbered-list" start="2"><li><strong>Upgrade pip</strong>:<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="336d76ff-6949-49c7-ab56-35fb291f71fe" class="code"><code class="language-Bash" style="white-space:pre-wrap;word-break:break-all">pip3 install --upgrade pip</code></pre><figure id="831459cb-a8f7-4cad-84b4-d26f8abb6bee" class="image"><a href="Detecting%20Vulnerable-Flask-Application%2028b07495fafd4267886f45a6a50ce273/Untitled%2051.png"><img style="width:708px" src="Detecting%20Vulnerable-Flask-Application%2028b07495fafd4267886f45a6a50ce273/Untitled%2051.png"/></a></figure></li></ol><ol type="1" id="25b1b3f6-b85b-4823-9a42-88bf04a5a284" class="numbered-list" start="3"><li><strong>Install Docker and Python Docker Library</strong>:<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="3d4e1ca9-0d68-41b5-9387-4d820fce889d" class="code"><code class="language-Bash">curl -sSL https://get.docker.com/ | sh
sudo pip3 install docker==7.1.0 urllib3==2.2.2 requests==2.32.2</code></pre><figure id="4c9883f2-0fd4-4c14-b9fc-b317c8973afa" class="image"><a href="Detecting%20Vulnerable-Flask-Application%2028b07495fafd4267886f45a6a50ce273/Untitled%2052.png"><img style="width:680px" src="Detecting%20Vulnerable-Flask-Application%2028b07495fafd4267886f45a6a50ce273/Untitled%2052.png"/></a></figure><figure id="2bff0a9b-7a56-4c01-91d8-170a7b3ecbe0" class="image"><a href="Detecting%20Vulnerable-Flask-Application%2028b07495fafd4267886f45a6a50ce273/Untitled%2053.png"><img style="width:680px" src="Detecting%20Vulnerable-Flask-Application%2028b07495fafd4267886f45a6a50ce273/Untitled%2053.png"/></a></figure></li></ol><ol type="1" id="5bdfffb4-34c7-4e8c-96a6-f89d1082631f" class="numbered-list" start="4"><li>Edit the <strong>Wazuh agent</strong> configuration file <code>/var/ossec/etc/ossec.conf</code> and add this block to enable the <code>docker-listener</code> module:<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="9b8e1cb4-fa48-42ba-a0ad-0c6563d0fb4e" class="code"><code class="language-Bash">&lt;ossec_config&gt;
  &lt;wodle name=&quot;docker-listener&quot;&gt;
    &lt;interval&gt;5m&lt;/interval&gt;
    &lt;attempts&gt;5&lt;/attempts&gt;
    &lt;run_on_start&gt;yes&lt;/run_on_start&gt;
    &lt;disabled&gt;no&lt;/disabled&gt;
  &lt;/wodle&gt;
&lt;/ossec_config&gt;</code></pre><figure id="ad293b5a-eb0c-476a-b4e7-13f99142a931" class="image"><a href="Detecting%20Vulnerable-Flask-Application%2028b07495fafd4267886f45a6a50ce273/Untitled%2054.png"><img style="width:680px" src="Detecting%20Vulnerable-Flask-Application%2028b07495fafd4267886f45a6a50ce273/Untitled%2054.png"/></a></figure></li></ol><ol type="1" id="228b3683-625e-496a-ba36-923e52926df5" class="numbered-list" start="5"><li>Restart the <strong>Wazuh agent</strong> to apply the changes:<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="5b6e183c-e0db-4db2-b089-eec3be9cfe81" class="code"><code class="language-Bash">sudo systemctl restart wazuh-agent</code></pre><figure id="41fa8699-b33b-4a89-bcd7-69fcab3b15bc" class="image"><a href="Detecting%20Vulnerable-Flask-Application%2028b07495fafd4267886f45a6a50ce273/Untitled%2055.png"><img style="width:680px" src="Detecting%20Vulnerable-Flask-Application%2028b07495fafd4267886f45a6a50ce273/Untitled%2055.png"/></a></figure></li></ol><p id="8e596d53-0dfa-47a1-8c67-e0f7e7c046ed" class="">Perform several <strong>Docker </strong>activities like <em>pulling</em> a <strong>Docker image</strong>, <em>starting an instance</em>, <em>running</em> some other <strong>Docker</strong> commands, and then<em> deleting</em> the container.</p><ol type="1" id="931047e3-1bb2-4a7d-bf02-e73e8bc8ee7a" class="numbered-list" start="1"><li>Pull an image, such as the <strong>NGINX</strong> image, and run a container:<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="498775b7-2ec4-41db-a3b0-89c517868e9f" class="code"><code class="language-Bash">sudo docker pull nginx
sudo docker run -d -P --name nginx_container nginx
sudo docker exec -it nginx_container cat /etc/passwd
sudo docker exec -it nginx_container /bin/bash
exit</code></pre><figure id="235e8d9d-2e22-4522-89a0-3d9b57078298" class="image"><a href="Detecting%20Vulnerable-Flask-Application%2028b07495fafd4267886f45a6a50ce273/Untitled%2056.png"><img style="width:680px" src="Detecting%20Vulnerable-Flask-Application%2028b07495fafd4267886f45a6a50ce273/Untitled%2056.png"/></a></figure><figure id="f86b2459-5917-4b15-a70e-9a66c0e7497a" class="image"><a href="Detecting%20Vulnerable-Flask-Application%2028b07495fafd4267886f45a6a50ce273/Untitled%2057.png"><img style="width:680px" src="Detecting%20Vulnerable-Flask-Application%2028b07495fafd4267886f45a6a50ce273/Untitled%2057.png"/></a></figure><figure id="f3365ebe-6d63-408a-a460-dcaee3529e0c" class="image"><a href="Detecting%20Vulnerable-Flask-Application%2028b07495fafd4267886f45a6a50ce273/Untitled%2058.png"><img style="width:680px" src="Detecting%20Vulnerable-Flask-Application%2028b07495fafd4267886f45a6a50ce273/Untitled%2058.png"/></a></figure><figure id="cf20fd76-d28e-4dd0-a1ce-ab7e5a52f760" class="image"><a href="Detecting%20Vulnerable-Flask-Application%2028b07495fafd4267886f45a6a50ce273/Untitled%2059.png"><img style="width:680px" src="Detecting%20Vulnerable-Flask-Application%2028b07495fafd4267886f45a6a50ce273/Untitled%2059.png"/></a></figure><figure id="fef0d9f6-842a-471f-a1e3-c1802695bfdb" class="image"><a href="Detecting%20Vulnerable-Flask-Application%2028b07495fafd4267886f45a6a50ce273/Untitled%2060.png"><img style="width:680px" src="Detecting%20Vulnerable-Flask-Application%2028b07495fafd4267886f45a6a50ce273/Untitled%2060.png"/></a></figure></li></ol><hr id="38a4296e-8441-4128-a52c-c9db03f069a6"/><p id="bbe91574-845a-487c-96c0-47b61b20620e" class="">To detect vulnerabilities in <strong>Docker containers</strong> using <strong>Wazuh</strong>, you first need to configure <strong>Wazuh</strong> to monitor the logs generated by your <strong>Docker containers</strong>.</p><h3 id="199cd088-730d-4397-b26e-bcdcec810792" class="">2.1.3 <strong>Monitoring Docker container logs</strong></h3><p id="a9a6666c-713e-4c28-ab8d-59d24a0d9690" class="">By default, <strong>Docker container</strong> logs only show <code>stdout</code> and <code>stderr</code> standard streams, which are cleared when the container is destroyed. However, when <strong>non-interactive</strong> processes, like a <em>database</em> or <em>web server</em> are run, logs pertaining to these processes are generated. These logs can be collected using <strong>Docker logging drivers</strong> and saved to a file. If the design of a container is good enough, it can provide valuable logs to be examined.</p><p id="7e0223ac-70a3-4744-9f80-073f8d736199" class="">By default, when a container is created by the docker engine, the <strong>JSON</strong> <strong>File logging</strong> driver is used. Logs captured this way can be found inÂ <code>/var/lib/docker/containers/[container-id]/[container-id]-json.log</code>. The <strong>Wazuh agent</strong> can collect logs directly from this location but the <br/>logs do not provide enough information about which container produced it. This might be a problem when we have a large number of containers. <br/><strong>Rsyslog</strong> is used to improve the container logs by tagging them with their respective container names and grouping them in a directory. The <strong>JSON File logging</strong> driver doesnâ€™t allow the log file location to be changed, so we will use the <strong>Syslog logging driver</strong> instead.</p><p id="c97f94b5-63ed-4a11-875b-67ae17f8f1d5" class="">When creating a container, theÂ <code>--log-driver</code>Â tag can be specified to set the log driver which will be used. A more global approach is to use a configuration that sets the logging driver for all containers created.</p><p id="b8317864-0359-437a-b363-479114cfcb3f" class="">To set the global logging driver, create or edit <code>/etc/docker/daemon.json</code>. This way all containers created henceforth will use the <strong>Syslog</strong> driver:</p><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="6da56a0f-65e5-4784-9a5c-7ca0f32bed4a" class="code"><code class="language-JSON">{
  &quot;log-driver&quot;: &quot;syslog&quot;,
  &quot;log-opts&quot;: {
    &quot;syslog-address&quot;: &quot;unixgram:///dev/log&quot;,
    &quot;tag&quot;: &quot;docker/{{.Name}}&quot;
  }
}</code></pre><figure id="097bebac-ae48-4196-ac3d-83583adb0ca2" class="image"><a href="Detecting%20Vulnerable-Flask-Application%2028b07495fafd4267886f45a6a50ce273/Untitled%2061.png"><img style="width:708px" src="Detecting%20Vulnerable-Flask-Application%2028b07495fafd4267886f45a6a50ce273/Untitled%2061.png"/></a></figure><p id="65a253df-0ce6-44f3-88f0-dfca784df95d" class="">The configuration above specifies:</p><ul id="55115c76-9838-4820-9cbf-b4e4e0d238d2" class="bulleted-list"><li style="list-style-type:disc">The type of log driver used, which in this case is <strong>Syslog</strong>.</li></ul><ul id="898ed768-9d71-4171-878e-1b35a6a5a0cf" class="bulleted-list"><li style="list-style-type:disc">That log messages will be channeled toÂ <code>unixgram:///dev/log</code>, then the <strong>Rsyslog</strong> daemon pulls data from that socket.</li></ul><ul id="35ebb455-47dc-4ce7-bc02-1176d4705b19" class="bulleted-list"><li style="list-style-type:disc">That log messages will be tagged withÂ <code>docker/{{.Name}}</code>, whereÂ <code>{{.Name}}</code>Â replaces the container name.</li></ul><p id="1e32c50b-0592-4423-8b9a-1a4997a859c7" class=""><strong>Restart the Docker service to apply changes:</strong></p><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="3b3ef999-43bf-4eeb-b66e-9abc78ac708b" class="code"><code class="language-Bash">systemctl restart docker</code></pre><figure id="ea3a4a23-083d-48e5-a0a5-64e420d4f89d" class="image"><a href="Detecting%20Vulnerable-Flask-Application%2028b07495fafd4267886f45a6a50ce273/Untitled%2062.png"><img style="width:708px" src="Detecting%20Vulnerable-Flask-Application%2028b07495fafd4267886f45a6a50ce273/Untitled%2062.png"/></a></figure><p id="d51e2059-0753-4c60-86d6-2d25e4c8f2fd" class="">We need to configure <strong>Rsyslog</strong> to create and tag new logs from containers in theÂ <code>/var/log/docker</code>Â folder.</p><p id="edc50684-e1b0-4ed9-ae52-fa1aa98258da" class="">Letâ€™s create a configuration file called <code>wazuh-docker.conf</code> in the <code>/etc/rsyslog.d/</code> directory:</p><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="36dfa2c2-ec8a-4e73-9e6e-c9e943b65eb7" class="code"><code class="language-Bash">$FileCreateMode 0644
$template DockerDaemonLogFileName,&quot;/var/log/docker/docker.log&quot;
$template DockerContainerLogFileName,&quot;/var/log/docker/%SYSLOGTAG:R,ERE,1,FIELD:docker/(.*)\[--end:secpath-replace%.log&quot;
if $programname == &#x27;dockerd&#x27; then {
  ?DockerDaemonLogFileName
  stop
}
if $programname == &#x27;containerd&#x27; then {
  ?DockerDaemonLogFileName
  stop
}
if $programname == &#x27;docker&#x27; then {
  if $syslogtag contains &#x27;docker/&#x27; then {
  ?DockerContainerLogFileName
  stop
  }
}
$FileCreateMode 0600</code></pre><figure id="459fb388-e1f3-4c64-8513-304e2b608b56" class="image"><a href="Detecting%20Vulnerable-Flask-Application%2028b07495fafd4267886f45a6a50ce273/Untitled%2063.png"><img style="width:708px" src="Detecting%20Vulnerable-Flask-Application%2028b07495fafd4267886f45a6a50ce273/Untitled%2063.png"/></a></figure><p id="b37d1f19-5f17-43e1-b001-9813128929ed" class="">The configuration above specifies:</p><ul id="07e414ca-45ad-4ce5-8534-a55a5ad0eb3b" class="bulleted-list"><li style="list-style-type:disc">The files created are inÂ <code>0644</code>Â mode, meaning they will be readable by all the user groups, but writable by the user only.</li></ul><ul id="1899c8bf-0cbe-4c8e-9131-b68116acdefb" class="bulleted-list"><li style="list-style-type:disc">That any log from <strong>dockerd</strong>, <strong>containerd</strong>, and docker runtime will be written toÂ <code>/var/log/docker/docker.log</code>.</li></ul><ul id="7aff969d-9124-43b6-a4c3-f871ffad69ab" class="bulleted-list"><li style="list-style-type:disc"><code>SYSLOGTAG:R,ERE,1,FIELD:docker/(.*)\[--end:secpath-replace%</code>Â is equivalent to theÂ <code>{{.Name}}</code>Â tag in the <strong>Docker</strong> daemon configuration. Therefore new logs will be located inÂ <code>/var/log/docker/[new container name].log</code>.</li></ul><p id="6ca580de-cd2b-43d1-835f-e1f30c468344" class=""><strong>Restart the Rsyslog service to apply changes:</strong></p><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="ecd2701f-735c-4104-962c-dae7ab1b0e40" class="code"><code class="language-Bash">systemctl restart rsyslog</code></pre><figure id="653d1628-c0a0-40ab-9e9f-e4a06a4c6953" class="image"><a href="Detecting%20Vulnerable-Flask-Application%2028b07495fafd4267886f45a6a50ce273/Untitled%2064.png"><img style="width:708px" src="Detecting%20Vulnerable-Flask-Application%2028b07495fafd4267886f45a6a50ce273/Untitled%2064.png"/></a></figure><p id="0dabf4da-a3ea-4399-b32e-9c9599c4d3a7" class="">New logs should start appearing in theÂ <code>/var/log/docker</code>Â directory when containers are created.</p><figure id="65be8e12-9ae1-4250-a3ee-a81adcc7c2bf" class="image"><a href="Detecting%20Vulnerable-Flask-Application%2028b07495fafd4267886f45a6a50ce273/Untitled%2065.png"><img style="width:708px" src="Detecting%20Vulnerable-Flask-Application%2028b07495fafd4267886f45a6a50ce273/Untitled%2065.png"/></a></figure><p id="e8c78b3b-0661-46b0-a2d7-c589501377ae" class="">To configure log collection locally on the agent, add the configuration below inside the <code>&lt;ossec_config&gt;</code> tag of the <code>/var/ossec/etc/ossec.conf</code> file. A wild card is used, this way the <strong>Wazuh agent</strong> will read every container log in that directory:</p><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="32bf1f57-c755-4fd9-bc94-9d11e075a994" class="code"><code class="language-Bash">&lt;localfile&gt;
  &lt;log_format&gt;syslog&lt;/log_format&gt;
  &lt;location&gt;/var/log/docker/*&lt;/location&gt;
&lt;/localfile&gt;</code></pre><figure id="268d7b52-915c-4780-93af-8cba734b7d0b" class="image"><a href="Detecting%20Vulnerable-Flask-Application%2028b07495fafd4267886f45a6a50ce273/Untitled%2066.png"><img style="width:708px" src="Detecting%20Vulnerable-Flask-Application%2028b07495fafd4267886f45a6a50ce273/Untitled%2066.png"/></a></figure><p id="b6ed49fa-34ea-4159-8991-b68b2ef0c5a3" class=""><strong>Restart the Wazuh agent for changes to apply:</strong></p><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="a137b7d4-ba28-4da3-aa0a-bd67d69b51c2" class="code"><code class="language-Bash">systemctl restart wazuh-agent</code></pre><figure id="3c96406b-f79e-4000-b431-87b473010cbc" class="image"><a href="Detecting%20Vulnerable-Flask-Application%2028b07495fafd4267886f45a6a50ce273/Untitled%2067.png"><img style="width:708px" src="Detecting%20Vulnerable-Flask-Application%2028b07495fafd4267886f45a6a50ce273/Untitled%2067.png"/></a></figure><p id="07bbfdec-51e0-4a4a-94e5-1501626ed141" class="">As mentioned earlier, non-interactive applications produce additional logs, depending on the design of the container. For example, a web server container will generate web logs. So we expect to see <strong>HTTP</strong> web requests like <code>GET</code> in the logs.</p><p id="210a36ee-a731-4b79-9c87-35e676084428" class="">Letâ€™s set up a simple web server that shows its <em>hostname</em>, <em>IP address</em>, and other information:</p><ul id="fa6f19b0-cbce-4bf8-888b-7c5220197eb2" class="bulleted-list"><li style="list-style-type:disc">Create a container using the <code>nginxdemos/hello</code> container image. Setting the container name is important for <strong>Rsyslog</strong> to tag the log:<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="5de820f4-3301-4481-953c-386df5ad376d" class="code"><code class="language-Bash">docker run -P -d --hostname webserver --name webserver nginxdemos/hello</code></pre><figure id="a117dd72-3d29-4ecf-91bf-8a124db6d130" class="image"><a href="Detecting%20Vulnerable-Flask-Application%2028b07495fafd4267886f45a6a50ce273/Untitled%2068.png"><img style="width:680px" src="Detecting%20Vulnerable-Flask-Application%2028b07495fafd4267886f45a6a50ce273/Untitled%2068.png"/></a></figure></li></ul><ul id="98facaa0-a59b-4817-889e-512f4d47e157" class="bulleted-list"><li style="list-style-type:disc">Check that there is a new log file:<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="aab46b52-d963-4785-a79e-076629341c29" class="code"><code class="language-Bash">ls /var/log/docker/webserver.log</code></pre><figure id="2b61efe3-923c-42fd-8e09-06f36d5939c7" class="image"><a href="Detecting%20Vulnerable-Flask-Application%2028b07495fafd4267886f45a6a50ce273/Untitled%2069.png"><img style="width:680px" src="Detecting%20Vulnerable-Flask-Application%2028b07495fafd4267886f45a6a50ce273/Untitled%2069.png"/></a></figure></li></ul><p id="70ce1616-c183-4223-a563-fa93f278ad9f" class="">Configure the manager to store events collected by the agent to <code>/var/ossec/logs/archives/archives.json</code> file. These logs will be used to create rules and decoders. In the <code>/var/ossec/etc/ossec.conf</code> file, change <code>&lt;logall_json&gt;</code> to <code><strong>yes</strong></code>. Later <strong>when rules are being triggered</strong>, we change <code>&lt;logall_json&gt;</code> back to <code><strong>no</strong></code>. This way large volumes of logs are not stored on the manager side:</p><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="062418ed-9084-45b4-9bd3-7bffa6b71dd0" class="code"><code class="language-Bash">&lt;logall_json&gt;yes&lt;/logall_json&gt;</code></pre><figure id="c7d217ee-e000-41ca-ac47-3ddc73d39539" class="image"><a href="Detecting%20Vulnerable-Flask-Application%2028b07495fafd4267886f45a6a50ce273/Untitled%2070.png"><img style="width:708px" src="Detecting%20Vulnerable-Flask-Application%2028b07495fafd4267886f45a6a50ce273/Untitled%2070.png"/></a></figure><p id="42aee131-631f-44cc-8711-d2cdb8df8d8e" class=""><strong>Restart the Wazuh manager for changes to apply:</strong></p><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="94e37ef0-4cc4-43eb-be55-eae15ca89407" class="code"><code class="language-Bash">systemctl restart wazuh-manager</code></pre><figure id="23555ab9-b839-47b3-9f6c-3a4f76995ee1" class="image"><a href="Detecting%20Vulnerable-Flask-Application%2028b07495fafd4267886f45a6a50ce273/Untitled%2071.png"><img style="width:708px" src="Detecting%20Vulnerable-Flask-Application%2028b07495fafd4267886f45a6a50ce273/Untitled%2071.png"/></a></figure><p id="4e83885e-1ea0-4b6b-ac09-ec8815676edc" class="">On the <strong>Linux/Unix</strong> endpoint, get the <strong>IP</strong> address of the <strong>web server</strong> container:</p><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="f4150748-d96c-40c7-b32a-d3e6508f39ed" class="code"><code class="language-Bash">docker inspect webserver | grep IPAddress</code></pre><figure id="81b3673d-2e2b-41ef-8afa-15996c98da5c" class="image"><a href="Detecting%20Vulnerable-Flask-Application%2028b07495fafd4267886f45a6a50ce273/Untitled%2072.png"><img style="width:708px" src="Detecting%20Vulnerable-Flask-Application%2028b07495fafd4267886f45a6a50ce273/Untitled%2072.png"/></a></figure><p id="553bbb29-e098-4fe7-ab78-a5d4582a9e8d" class="">On the <strong>Wazuh manager</strong>, check that it can see the container logs after a curl request is made:</p><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="ba44d9fd-6268-49d6-a533-413d4a25d43a" class="code"><code class="language-Bash">tail -f /var/ossec/logs/archives/archives.json | grep webserver</code></pre><figure id="2242dc73-af39-4264-968f-463935453717" class="image"><a href="Detecting%20Vulnerable-Flask-Application%2028b07495fafd4267886f45a6a50ce273/Untitled%2073.png"><img style="width:708px" src="Detecting%20Vulnerable-Flask-Application%2028b07495fafd4267886f45a6a50ce273/Untitled%2073.png"/></a></figure><p id="3561b5cb-a398-408d-979d-c5e9428a6e15" class="">From a machine that can reach the web server, do a curl request or browse to the <strong>web server </strong>container <strong>IP</strong> address:</p><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="cef10471-2cef-4691-a3ae-93d455d68b42" class="code"><code class="language-Bash">curl &lt;webserver_IP&gt;</code></pre><figure id="e1d818cf-58b1-49c6-9507-fb75f7ddac78" class="image"><a href="Detecting%20Vulnerable-Flask-Application%2028b07495fafd4267886f45a6a50ce273/Untitled%2074.png"><img style="width:708px" src="Detecting%20Vulnerable-Flask-Application%2028b07495fafd4267886f45a6a50ce273/Untitled%2074.png"/></a></figure><p id="e5ed4963-fb93-4516-bf9c-cab7668c1613" class="">The curl request creates an event that is logged to the Wazuh manager archives:</p><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="92155c9d-4d80-46cc-8a5e-67555deda573" class="code"><code class="language-Bash">{&quot;timestamp&quot;:&quot;2022-02-02T11:53:33.058+0000&quot;,&quot;agent&quot;:{&quot;id&quot;:&quot;025&quot;,&quot;name&quot;:&quot;vagrant&quot;,&quot;ip&quot;:&quot;10.0.2.15&quot;},&quot;manager&quot;:{&quot;name&quot;:&quot;wazuh-manager&quot;},&quot;id&quot;:&quot;1643802813.1121072&quot;,&quot;full_log&quot;:&quot;Feb  2 11:53:32 vagrant docker/webserver[24403]: 172.17.0.1 - - [02/Feb/2022:11:53:32 +0000] \&quot;GET / HTTP/1.1\&quot; 200 7228 \&quot;-\&quot; \&quot;curl/7.58.0\&quot; \&quot;-\&quot;&quot;,&quot;predecoder&quot;:{&quot;program_name&quot;:&quot;docker/webserver&quot;,&quot;timestamp&quot;:&quot;Feb  2 11:53:32&quot;,&quot;hostname&quot;:&quot;vagrant&quot;},&quot;decoder&quot;:{&quot;name&quot;:&quot;docker_log_decoder&quot;},&quot;data&quot;:{&quot;srcip&quot;:&quot;172.17.0.1&quot;,&quot;date&quot;:&quot;02/Feb/2022&quot;,&quot;time&quot;:&quot;2022:11:53&quot;,&quot;web_action&quot;:&quot;\&quot;GET / HTTP/1.1\&quot; 200&quot;},&quot;location&quot;:&quot;/var/log/syslog&quot;}</code></pre><figure id="c9456ddd-14cf-4591-ace0-0d13ba8cc805" class="image"><a href="Detecting%20Vulnerable-Flask-Application%2028b07495fafd4267886f45a6a50ce273/Untitled%2075.png"><img style="width:708px" src="Detecting%20Vulnerable-Flask-Application%2028b07495fafd4267886f45a6a50ce273/Untitled%2075.png"/></a></figure><p id="3061cda1-cc3d-45cb-9fec-df3875e5cb4d" class="">The container logs are in the <code>full_log</code> field in the log above. This is the log of interest:</p><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="9ca90fa4-66bd-4956-b251-e721546e68d2" class="code"><code class="language-Bash">Feb  2 11:53:32 vagrant docker/webserver[24403]: 172.17.0.1 - - [02/Feb/2022:11:53:32 +0000] &quot;GET / HTTP/1.1&quot; 200 7228 &quot;-&quot; &quot;curl/7.58.0&quot; &quot;-&quot;&#x27;</code></pre><figure id="8e8c92c0-4a57-409e-a0c5-040606e47121" class="image"><a href="Detecting%20Vulnerable-Flask-Application%2028b07495fafd4267886f45a6a50ce273/Untitled%2076.png"><img style="width:708px" src="Detecting%20Vulnerable-Flask-Application%2028b07495fafd4267886f45a6a50ce273/Untitled%2076.png"/></a></figure><p id="95fadcfb-a21a-4a9d-8f8f-cd90ec4d61b0" class="">Write decoders to extract information from the <code>full_log</code> field. To do it, edit <code>/var/ossec/etc/decoders/local_decoder.xml</code> on the <strong>Wazuh manager</strong>:</p><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="3c61c140-d613-4c2a-9e2e-43348f1adc4c" class="code"><code class="language-Bash">&lt;decoder name=&quot;docker_log_decoder&quot;&gt;
  &lt;program_name&gt;^docker&lt;/program_name&gt;
&lt;/decoder&gt;

&lt;decoder name=&quot;docker_log_decoder_2&quot;&gt;
  &lt;parent&gt;docker_log_decoder&lt;/parent&gt;
  &lt;regex offset=&quot;after_parent&quot;&gt;(\d*.\d*.\d*.\d*)&lt;/regex&gt;
  &lt;order&gt;srcip&lt;/order&gt;
&lt;/decoder&gt;

&lt;decoder name=&quot;docker_log_decoder_2&quot;&gt;
  &lt;parent&gt;docker_log_decoder&lt;/parent&gt;
  &lt;regex offset=&quot;after_parent&quot;&gt;(\d*/\w*/\d*)&lt;/regex&gt;
  &lt;order&gt;date&lt;/order&gt;
&lt;/decoder&gt;

&lt;decoder name=&quot;docker_log_decoder_2&quot;&gt;
  &lt;parent&gt;docker_log_decoder&lt;/parent&gt;
  &lt;regex offset=&quot;after_parent&quot;&gt;(\d*:\d*:\d*)&lt;/regex&gt;
  &lt;order&gt;time&lt;/order&gt;
&lt;/decoder&gt;

&lt;decoder name=&quot;docker_log_decoder_2&quot;&gt;
  &lt;parent&gt;docker_log_decoder&lt;/parent&gt;
  &lt;regex offset=&quot;after_parent&quot;&gt;(&quot;\w*\s/\s\w*/\d.\d&quot;\s\d*)&lt;/regex&gt;
  &lt;order&gt;web_action&lt;/order&gt;
&lt;/decoder&gt;</code></pre><figure id="3cd7c92c-b761-48c5-8b97-635b1d3537db" class="image"><a href="Detecting%20Vulnerable-Flask-Application%2028b07495fafd4267886f45a6a50ce273/Untitled%2077.png"><img style="width:708px" src="Detecting%20Vulnerable-Flask-Application%2028b07495fafd4267886f45a6a50ce273/Untitled%2077.png"/></a></figure><p id="d6c94731-d29b-488c-b193-21bbf34235ba" class="">We run the log test binary to check that the decoder is extracting the event fields:</p><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="e267a70f-b231-49a6-b4ee-b23c386b722f" class="code"><code class="language-Bash">/var/ossec/bin/wazuh-logtest</code></pre><p id="c2b43e13-5289-4f8a-a801-68e16dfaf0f4" class="">Paste the log after the binary starts:</p><figure id="6e2cfee9-f84a-4673-b762-5dadc28bcd60" class="image"><a href="Detecting%20Vulnerable-Flask-Application%2028b07495fafd4267886f45a6a50ce273/Untitled%2078.png"><img style="width:708px" src="Detecting%20Vulnerable-Flask-Application%2028b07495fafd4267886f45a6a50ce273/Untitled%2078.png"/></a></figure><p id="3a40a4e9-91ca-4141-9ec2-e6dde91cad73" class="">To write a custom rule that triggers an alert when a <strong>GET</strong> request is made to the web server, edit <code>/var/ossec/etc/rules/local_rules.xml</code> on the <strong>Wazuh manager</strong>:</p><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="401d1914-39d9-4cf6-9197-1f6db80e1526" class="code"><code class="language-Bash">&lt;group name=&quot;docker-log-rule,&quot;&gt;
  &lt;rule id=&quot;100009&quot; level=&quot;5&quot;&gt;
    &lt;field name=&quot;web_action&quot;&gt;&quot;GET / HTTP/1.1&quot; 200&lt;/field&gt;
    &lt;description&gt;Docker Container: Successful Web GET request on Container: $(program_name) from $(srcip)&lt;/description&gt; &lt;mitre&gt;
      &lt;id&gt;T1016.001&lt;/id&gt;
    &lt;/mitre&gt;
    &lt;group&gt;docker-log-rule,&lt;/group&gt;
  &lt;/rule&gt;
&lt;/group&gt;</code></pre><figure id="f3336879-94a9-4581-8885-0d7f7259eb5b" class="image"><a href="Detecting%20Vulnerable-Flask-Application%2028b07495fafd4267886f45a6a50ce273/Untitled%2079.png"><img style="width:708px" src="Detecting%20Vulnerable-Flask-Application%2028b07495fafd4267886f45a6a50ce273/Untitled%2079.png"/></a></figure><p id="255643ec-7af8-4454-a8da-09c0d3f6b15f" class=""><strong>Restart the Wazuh manager for changes to apply:</strong></p><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="0ed10e50-0fba-4354-9e81-48ebea88cf5b" class="code"><code class="language-Bash">systemctl restart wazuh-manager</code></pre><figure id="3f2319a2-7ce3-4a8a-a216-2b1dbdb53d83" class="image"><a href="Detecting%20Vulnerable-Flask-Application%2028b07495fafd4267886f45a6a50ce273/Untitled%2080.png"><img style="width:708px" src="Detecting%20Vulnerable-Flask-Application%2028b07495fafd4267886f45a6a50ce273/Untitled%2080.png"/></a></figure><p id="206d34ad-eeb3-4222-b110-69ee7dd51683" class="">To trigger alerts for the rule that was created, do a curl request or browse to the web server container <strong>IP</strong> address. In the security events tab of the <strong>Wazuh Dashboard</strong>, we can see an example of a successful <strong>GET</strong> request alert.</p><figure id="2d9f2920-1483-4511-bcaa-78f29988be69" class="image"><a href="Detecting%20Vulnerable-Flask-Application%2028b07495fafd4267886f45a6a50ce273/Untitled%2081.png"><img style="width:708px" src="Detecting%20Vulnerable-Flask-Application%2028b07495fafd4267886f45a6a50ce273/Untitled%2081.png"/></a></figure><figure id="0c7978e8-e1c7-4daa-9681-d2afc8a200c0" class="image"><a href="Detecting%20Vulnerable-Flask-Application%2028b07495fafd4267886f45a6a50ce273/Untitled%2082.png"><img style="width:708px" src="Detecting%20Vulnerable-Flask-Application%2028b07495fafd4267886f45a6a50ce273/Untitled%2082.png"/></a></figure><hr id="cacf50eb-dbb3-4d4c-b0ee-0ed6405364b4"/><h1 id="6038b825-c243-43e2-9971-91e45526eee6" class="">3. Configuring Vulnerable Application</h1><p id="9545ea9e-b69b-435f-8c6a-c3831ec5a728" class="">In the previous steps, we configured <strong>Wazuh</strong> to collect logs and events from <strong>Docker</strong> and its containers. However, if our application is not generating <strong>logs</strong> properly, we need to establish robust logging logic within the application itself. Additionally, we must ensure these logs are correctly monitored by the <strong>Wazuh agent</strong>.</p><hr id="001227ca-8ab4-41a9-aa58-9da8bbfe4dc4"/><figure id="01a0baae-ab09-4e5a-8e87-dc3e629e4ca2" class="image"><a href="Detecting%20Vulnerable-Flask-Application%2028b07495fafd4267886f45a6a50ce273/Untitled%2083.png"><img style="width:708px" src="Detecting%20Vulnerable-Flask-Application%2028b07495fafd4267886f45a6a50ce273/Untitled%2083.png"/></a></figure><p id="21f04bb1-3fcb-4ce9-a3d9-739cca2012b2" class="">To configure logging in <strong>JSON</strong> format for your <strong>Flask</strong> application to detect attacks on the <strong>API</strong>, you can use <strong>Python&#x27;s</strong> <code>logging</code> module in combination with <code>python-json-logger</code>. This will allow you to structure your logs in <strong>JSON</strong> format, making it easier to parse and analyze for potential security incidents.</p><p id="f62b8560-c195-4042-bb13-d66bdcbf921a" class="">To configure good logging in <strong>JSON</strong> format for this <code>Flask</code> app, you can follow these steps:</p><ol type="1" id="79609599-fbac-4f59-9cd4-54b9eda35118" class="numbered-list" start="1"><li><strong>Install a JSON logging library</strong>: Install a library like <code>python-json-logger</code> that allows you to format your logs in <strong>JSON</strong>. You can install it using <code>pip</code>:</li></ol><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="fd04e383-923b-4140-8c70-2a2ed8e679e0" class="code"><code class="language-Bash" style="white-space:pre-wrap;word-break:break-all">pip install python-json-logger</code></pre><figure id="4b82f5d9-7ba0-4d47-bdaa-5e3ffc5b2840" class="image"><a href="Detecting%20Vulnerable-Flask-Application%2028b07495fafd4267886f45a6a50ce273/Untitled%2084.png"><img style="width:708px" src="Detecting%20Vulnerable-Flask-Application%2028b07495fafd4267886f45a6a50ce273/Untitled%2084.png"/></a></figure><ol type="1" id="f269b566-7761-473a-af22-98ed2ce1758f" class="numbered-list" start="1"><li><strong>Configure the logger</strong>: In your <code>app.py</code> file, import the <code>JsonFormatter</code> from <code>pythonjsonlogger.jsonlogger</code> and configure the logger to use it:<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="fc07477c-5e10-4843-a548-bab45277d6ee" class="code"><code class="language-Python" style="white-space:pre-wrap;word-break:break-all">from flask import session, Flask, jsonify, request, Response, render_template, render_template_string, url_for
from flask_sqlalchemy import SQLAlchemy
import shutil
import tempfile
import time
import jwt
from jwt.exceptions import DecodeError, MissingRequiredClaimError, InvalidKeyError
import json
import hashlib
import logging
import datetime
import os
from faker import Faker
import random
from werkzeug.utils import secure_filename
from docx import Document
import yaml
from tornado.wsgi import WSGIContainer
from tornado.httpserver import HTTPServer
from tornado.ioloop import IOLoop
import os
import base64
import logging
from pythonjsonlogger import jsonlogger

app_port = os.environ.get(&#x27;APP_PORT&#x27;, 5050)

app = Flask(__name__, template_folder=&#x27;templates&#x27;)
app.config[&#x27;SQLALCHEMY_DATABASE_URI&#x27;] = &#x27;sqlite:///test.db&#x27;
app.config[&#x27;SECRET_KEY_HMAC&#x27;] = &#x27;secret&#x27;
app.config[&#x27;SECRET_KEY_HMAC_2&#x27;] = &#x27;am0r3C0mpl3xK3y&#x27;
app.secret_key = &#x27;F12Zr47j\3yX R~X@H!jmM]Lwf/,?KT&#x27;
app.config[&#x27;STATIC_FOLDER&#x27;] = None
app.debug = True
db = SQLAlchemy(app)

# Configuration for logging
logHandler = logging.StreamHandler()
fileHandler = logging.FileHandler(&#x27;app.log&#x27;)
formatter = jsonlogger.JsonFormatter()

logHandler.setFormatter(formatter)
fileHandler.setFormatter(formatter)
app.logger.addHandler(logHandler)
app.logger.addHandler(fileHandler)
app.logger.setLevel(logging.DEBUG)
</code></pre><ul id="d1d11a06-3fd4-4320-ab68-0dcb7b3faddc" class="bulleted-list"><li style="list-style-type:disc"><strong>Handlers</strong>:<ul id="bf305103-7659-4587-9b44-de98343fa56d" class="bulleted-list"><li style="list-style-type:circle"><code>logHandler = logging.StreamHandler()</code>: Creates a stream handler for logging (logs to the console).</li></ul><ul id="50f95eea-1b6e-4c50-83b6-f5365098a8e8" class="bulleted-list"><li style="list-style-type:circle"><code>fileHandler = logging.FileHandler(&#x27;app.log&#x27;)</code>: Creates a file handler to log messages to <code>app.log</code>.</li></ul></li></ul><ul id="55362cd7-8229-4561-ad47-a6413435d4f0" class="bulleted-list"><li style="list-style-type:disc"><strong>Formatter</strong>:<ul id="e7234615-31fd-4f47-8f86-898f054f166d" class="bulleted-list"><li style="list-style-type:circle"><code>formatter = jsonlogger.JsonFormatter()</code>: Creates a <strong>JSON</strong> formatter for the logs.</li></ul></li></ul><ul id="b8d6d3ec-0dd3-4b06-aac6-7966fc1934d5" class="bulleted-list"><li style="list-style-type:disc"><strong>Attach Handlers to Application Logger</strong>:<ul id="b028ce50-cc5d-4b93-9ce6-9b2db72eb51e" class="bulleted-list"><li style="list-style-type:circle"><code>logHandler.setFormatter(formatter)</code>, <code>fileHandler.setFormatter(formatter)</code>: Sets the <strong>JSON</strong> formatter for both handlers.</li></ul><ul id="b64f35e8-77b2-4dc2-b657-6e934dd65e80" class="bulleted-list"><li style="list-style-type:circle"><code>app.logger.addHandler(logHandler)</code>, <code>app.logger.addHandler(fileHandler)</code>: Adds the handlers to the <strong>Flask</strong> application logger.</li></ul><ul id="067d7e26-e336-4d83-bfbc-363c724e346b" class="bulleted-list"><li style="list-style-type:circle"><code>app.logger.setLevel(logging.DEBUG)</code>: Sets the logging level to <code>DEBUG</code> for detailed log messages.</li></ul><p id="725609fc-5281-4998-bffd-5fb34826cce9" class="">Before delving into the function itself, it&#x27;s important to understand that the <strong>Flask</strong> application is configured to log messages at the <code>DEBUG</code> level, and it uses <strong>JSON</strong> formatting for these logs. The logs are output to both the console and a file named <code>app.log</code>.</p></li></ul></li></ol><ol type="1" id="a94a2b9b-93c8-4289-be1d-ab5dc8986c0b" class="numbered-list" start="2"><li><strong>Use the logger throughout your app</strong>: Now, you can use the <code>app.logger</code> object to log messages throughout your Flask app. For example:</li></ol><p id="13b8fe3e-02c5-4030-bf87-44f3ff331fbd" class=""><div class="indented"><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="abfb301d-8819-4515-bf70-6997ca44d15d" class="code"><code class="language-Python">@app.before_first_request
def setup_users():
    app.logger.info(&quot;Setting up initial users and customers&quot;)
    db.create_all()

    if not User.query.first():
        user = User()
        user.username = &#x27;admin&#x27;
        user.password = &#x27;admin123&#x27;
        db.session.add(user)
        db.session.commit()
	app.logger.info(&quot;Admin user created&quot;)

    if not Customer.query.first():
        for i in range(0,5):
            fake = Faker()
            cust = Customer()
            cust.first_name = fake.first_name()
            cust.last_name = fake.last_name()
            cust.email = fake.simple_profile(sex = None)[&#x27;mail&#x27;]
            cust.username = fake.simple_profile(sex = None)[&#x27;username&#x27;]
            cust.password = str(base64.b64encode(os.urandom(16)))
            cust.ccn = fake.credit_card_number(card_type=None)
            db.session.add(cust)
            db.session.commit()
	    app.logger.info(&quot;Customer %s created&quot;, cust.username)
</code></pre><p id="d9dab5cd-1989-4c00-b9c7-84a58776ac81" class="">This function is designed to be executed once before the first request to the application. It performs initial setup tasks, including the creation of database tables and the addition of initial user and customer records.The <code>setup_users</code> function uses logging to provide real-time feedback about the setup process.</p><hr id="e80b752e-c7b4-49c1-ad0c-b835f1fd10a3"/><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="49efe42b-e0b3-4857-a6ae-88c1c54e9eae" class="code"><code class="language-Python">@app.route(&#x27;/&#x27;, methods = [&#x27;GET&#x27;])
def sitemap():
    links = []
    for rule in app.url_map.iter_rules():
        print(rule)
	app.logger.info(&quot;Processing rule: %s&quot;,rule)
        if (&quot;GET&quot; in rule.methods or &quot;POST&quot; in rule.methods) and has_no_empty_params(rule):
            if not &#x27;static&#x27; in rule.endpoint:
                url = url_for(rule.endpoint, **(rule.defaults or {}))
                links.append((url, rule.endpoint, &#x27;,&#x27;.join(rule.methods)))

    return render_template(&#x27;index.html&#x27;, urls = links)


@app.route(&#x27;/register/user&#x27;, methods = [&#x27;POST&#x27;])
def reg_customer():
    try:
	app.logger.debug(&quot;Received request to register a new user&quot;)
        content = request.json
        if content:
            username = content[&#x27;username&#x27;]
            password = content[&#x27;password&#x27;]
	    app.logger.debug(&quot;Received username: %s&quot;, username)
            hash_pass = hashlib.md5(password).hexdigest()
	    app.logger.debug(&quot;Hashed password: %s&quot;, hash_pass)
            new_user = User(username, hash_pass)
            db.session.add(new_user)
            db.session.commit()
            user_created = &#x27;User: {0} has been created&#x27;.format(username)
	    app.logger.info(&quot;User %s has been created&quot;, username)
            return jsonify({&#x27;Created&#x27;: user_created}),200
    except Exception as e:
	app.logger.error(&quot;Error registering user: %s&quot;, str(e))
        return jsonify({&#x27;Error&#x27;: str(e.message)}),404
</code></pre><p id="24664c71-b85a-4e04-bdf2-30340845ac8a" class=""><code>sitemap</code> route generates a sitemap of all the <strong>URL</strong> rules defined in the <strong>Flask</strong> application. It logs the processing of each <strong>URL</strong> rule.</p><p id="cb41fb73-dd19-4532-9506-64d7974c91a4" class=""><code>reg_customer</code> route handles the registration of a new user via a <strong>POST</strong> request. It includes several <em>debug</em> and <em>error</em> logs to track the registration process and handle exceptions.</p><hr id="8c4b1d91-e2c8-47bf-8fd2-7bd607f951a7"/><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="dc6cda41-df21-4fa1-8150-9e400a0d1028" class="code"><code class="language-Python">@app.route(&#x27;/register/customer&#x27;, methods=[&#x27;POST&#x27;])
def reg_user():
    try:
	app.logger.debug(&quot;Received request to register a new customer&quot;)
        content = request.json
        if content:
            username = content[&#x27;username&#x27;]
	    app.logger.debug(&quot;Received username: %s&quot;, username)
            password = content[&#x27;password&#x27;]
	    app.logger.debug(&quot;Received password&quot;)
            first_name = content[&#x27;first_name&#x27;]
	    app.logger.debug(&quot;Received first name: %s&quot;, first_name)
            last_name = content[&#x27;last_name&#x27;]
	    app.logger.debug(&quot;Received last name: %s&quot;, last_name)
            email = content[&#x27;email&#x27;]
	    app.logger.debug(&quot;Received email: %s&quot;, email)
            ccn = content.get(&#x27;ccn&#x27;)  # ccn is nullable, so use .get() to handle None
            app.logger.debug(&quot;Received credit card number: %s&quot;, ccn)
	    new_customer = Customer(
                first_name=first_name,
                last_name=last_name,
                email=email,
                username=username,
                password=password,
                ccn=ccn
            )
            db.session.add(new_customer)
            db.session.commit()
	    app.logger.info(&quot;Customer %s has been created&quot;, username)
            user_created = &#x27;Customer: {0} has been created&#x27;.format(username)
            return jsonify({&#x27;Created&#x27;: user_created}), 200
    except Exception as e:
	app.logger.error(&quot;Error registering customer: %s&quot;, str(e))
        return jsonify({&#x27;Error&#x27;: str(e)}), 404


@app.route(&#x27;/login&#x27;, methods = [&#x27;POST&#x27;])
def login():
    &#x27;&#x27;&#x27;
    You will need to authenticate to this URI first. You will need to pass a JSON body with a username and password key.
    If you enter a valid username and password, a JWT token is returned in the HTTP Response in the Authorization header.
    This token can be used for subsequent requests.
    &#x27;&#x27;&#x27;
    try:
	app.logger.debug(&quot;Received login request&quot;)
        content = request.json
	app.logger.debug(&quot;Received request content: %s&quot;, content)
        print(content)
        username = content[&#x27;username&#x27;]
	app.logger.debug(&quot;Received username: %s&quot;, username)
        password = content[&#x27;password&#x27;]
	app.logger.debug(&quot;Received password&quot;)
        auth_user = User.query.filter_by(username = username, password = password).first()
        if auth_user:
	    app.logger.debug(&quot;Valid user found, generating JWT token&quot;)
            auth_token = jwt.encode({&#x27;user&#x27;: username, &#x27;exp&#x27;: get_exp_date(), &#x27;nbf&#x27;: datetime.datetime.utcnow(), &#x27;iss&#x27;: &#x27;we45&#x27;, &#x27;iat&#x27;: datetime.datetime.utcnow()}, app.config[&#x27;SECRET_KEY_HMAC&#x27;], algorithm=&#x27;HS256&#x27;)
            resp = Response(json.dumps({&#x27;Authenticated&#x27;: True, &quot;User&quot;: username}))
            #resp.set_cookie(&#x27;SESSIONID&#x27;, auth_token)
            resp.headers[&#x27;Authorization&#x27;] = &quot;{0}&quot;.format(auth_token)
            resp.status_code = 200
            resp.mimetype = &#x27;application/json&#x27;
            app.logger.info(&quot;User %s authenticated successfully&quot;, username)
	    return resp
        else:
	    app.logger.warning(&quot;Invalid username or password&quot;)
            return jsonify({&#x27;Error&#x27;: &#x27;No User here...&#x27;}),404
    except:
	app.logger.error(&quot;Error in login endpoint: %s&quot;, str(e))
        return jsonify({&#x27;Error&#x27;: &#x27;Unable to recognize Input&#x27;}),404

@app.route(&#x27;/fetch/customer&#x27;, methods=[&#x27;POST&#x27;])
def fetch_customer():
    app.logger.debug(&quot;Received request to fetch customer details&quot;)
    token = request.headers.get(&#x27;Authorization&#x27;)
    app.logger.debug(&quot;Authorization header: %s&quot;, token)
    if not token or not token.startswith(&#x27;Bearer &#x27;):
	app.logger.warning(&quot;Missing or invalid token&quot;)
        return jsonify({&#x27;Error&#x27;: &#x27;Missing or invalid token&#x27;}), 403

    token = token.split(&#x27; &#x27;)[1]  # Extract the token by removing &#x27;Bearer &#x27;
    app.logger.debug(&quot;Token after split: %s&quot;, token)

    if not verify_jwt(token):
	app.logger.warning(&quot;Invalid token or token expired&quot;)
        return jsonify({&#x27;Error&#x27;: &#x27;Invalid token or token expired&#x27;}), 403

    # Continue with fetching the customer details
    content = request.json
    app.logger.debug(&quot;Request content: %s&quot;, content)
    if content:
        customer_id = content[&#x27;id&#x27;]
	app.logger.debug(&quot;Requested customer ID: %s&quot;, customer_id)
        customer_record = Customer.query.get(customer_id)
        if customer_record:
	    app.logger.debug(&quot;Customer record found&quot;)
            customer_dict = {
                &#x27;id&#x27;: customer_record.id,
                &#x27;firstname&#x27;: customer_record.first_name,
                &#x27;lastname&#x27;: customer_record.last_name,
                &#x27;email&#x27;: customer_record.email,
                &#x27;cc_num&#x27;: customer_record.ccn,
                &#x27;username&#x27;: customer_record.username
            }
	    app.logger.debug(&quot;Customer details: %s&quot;, customer_dict)
            return jsonify(customer_dict), 200
        else:
	    app.logger.warning(&quot;No customer found with the given ID&quot;)
            return jsonify({&#x27;Error&#x27;: &#x27;No Customer Found&#x27;}), 404
    else:
	app.logger.warning(&quot;Invalid request content&quot;)
        return jsonify({&#x27;Error&#x27;: &#x27;Invalid Request&#x27;}), 400</code></pre><p id="01cda874-5a1d-4348-8af3-36c221f212dd" class="">The logging implemented in these routes serves multiple purposes:</p><ul id="7d57ed24-27ca-4912-be47-92b3cd6c51f4" class="bulleted-list"><li style="list-style-type:disc"><strong>Traceability</strong>: Detailed logs of received data and actions taken make it easier to trace the flow of requests and responses.</li></ul><ul id="db339206-fb92-40a4-817f-9409261ea4a2" class="bulleted-list"><li style="list-style-type:disc"><strong>Debugging</strong>: Debug logs provide insights into the state of the application and the data being processed, aiding in identifying and resolving issues.</li></ul><ul id="ef725246-fff2-45c1-89ea-3eb69f2ad793" class="bulleted-list"><li style="list-style-type:disc"><strong>Error Handling</strong>: Error and warning logs capture issues and anomalies, allowing for quicker diagnosis and resolution.</li></ul><ul id="b4618120-6b9e-4d2e-b2e7-922ec882ab7e" class="bulleted-list"><li style="list-style-type:disc"><strong>Audit and Monitoring</strong>: Info logs provide a record of significant events, such as successful registrations and logins, which is useful for auditing and monitoring the application&#x27;s performance and security.</li></ul><hr id="2dabd295-5637-492b-a2b5-263f9917b75c"/><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="50536e3c-a833-49c2-83bb-5df96f3a56e1" class="code"><code class="language-Python">@app.route(&#x27;/get/&lt;cust_id&gt;&#x27;, methods=[&#x27;GET&#x27;])
def get_customer(cust_id):
    try:
        app.logger.debug(&quot;Received request for customer ID: {cust_id}&quot;)
        token = request.headers.get(&#x27;Authorization&#x27;)
        app.logger.debug(&quot;Authorization header: {token}&quot;)
        if not token or not token.startswith(&#x27;Bearer &#x27;):
            app.logger.warning(&quot;Missing or invalid token&quot;)
            return jsonify({&#x27;Error&#x27;: &#x27;Missing or invalid token&#x27;}), 403

        token = token.split(&#x27; &#x27;)[1]
        app.logger.debug(&quot;Token after split: {token}&quot;)

        if not insecure_verify(token):
            app.logger.warning(&quot;Invalid Token&quot;)
            return jsonify({&#x27;Error&#x27;: &#x27;Invalid Token&#x27;}), 403

        if cust_id:
            customer_record = Customer.query.get(cust_id)
            if customer_record:
                customer_dict = {
                    &#x27;id&#x27;: customer_record.id,
                    &#x27;firstname&#x27;: customer_record.first_name,
                    &#x27;lastname&#x27;: customer_record.last_name,
                    &#x27;email&#x27;: customer_record.email,
                    &#x27;cc_num&#x27;: customer_record.ccn,
                    &#x27;username&#x27;: customer_record.username
                }
                app.logger.debug(&quot;Customer record found: {customer_dict}&quot;)
                return jsonify(customer_dict), 200
            else:
                app.logger.warning(&quot;No Customer Found&quot;)
                return jsonify({&#x27;Error&#x27;: &#x27;No Customer Found&#x27;}), 404
        else:
            app.logger.warning(&quot;Invalid Request&quot;)
            return jsonify({&#x27;Error&#x27;: &#x27;Invalid Request&#x27;}), 400
    except Exception as e:
        app.logger.error(&quot;Error in /get/&lt;cust_id&gt;: {e}&quot;)
        return jsonify({&#x27;Error&#x27;: &#x27;Internal Server Error&#x27;}), 500
</code></pre><p id="cb22e912-31dd-4435-856f-a0bb2dd0fee5" class="">This route retrieves customer information based on the provided <code>cust_id</code> via a <strong>GET</strong> request.</p><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="bf8a0ee2-5c0b-4510-a82c-7a8ac85c7a01" class="code"><code class="language-Python">@app.route(&#x27;/search&#x27;, methods=[&#x27;POST&#x27;])
def search_customer():
    app.logger.debug(&quot;Received search request&quot;)
    token = request.headers.get(&#x27;Authorization&#x27;)
    app.logger.debug(&quot;Authorization header: %s&quot;, token)
    # Check if token exists and has the correct format
    if not token or not token.startswith(&#x27;Bearer &#x27;):
        app.logger.warning(&quot;Missing or invalid token&quot;)
        return jsonify({&#x27;Error&#x27;: &#x27;Not Authenticated!&#x27;}), 403

    # Extract the token part
    token = token.split(&#x27; &#x27;)[1]
    app.logger.debug(&quot;Token after split: %s&quot;, token)
    # Verify JWT token
    if not verify_jwt(token):
        app.logger.warning(&quot;Invalid token&quot;)
        return jsonify({&#x27;Error&#x27;: &#x27;Invalid Token&#x27;}), 403

    # Process the request body
    content = request.json
    app.logger.debug(&quot;Request content: %s&quot;, content)
    if not content or &#x27;search&#x27; not in content:
        app.logger.warning(&quot;Invalid request content&quot;)
        return jsonify({&#x27;Error&#x27;: &#x27;Invalid Request&#x27;}), 400

    # Perform the search based on the &#x27;search&#x27; parameter
    try:
        search_term = content[&#x27;search&#x27;]
        app.logger.debug(&quot;Search term: {}&quot;.format(search_term))

        # Example: Direct SQL query (Not recommended due to SQL injection risk)
        str_query = &quot;SELECT first_name, last_name, username FROM customer WHERE username = &#x27;{}&#x27;&quot;.format(search_term)
        search_query = db.engine.execute(str_query)
        results = [list(result) for result in search_query]

        app.logger.debug(&quot;Search results: {}&quot;.format(results))
        return jsonify(results), 200

    except Exception as e:
        app.logger.error(&quot;Error in /search endpoint: {}&quot;.format(e))
        return jsonify({&#x27;Error&#x27;: &#x27;Internal Server Error&#x27;}), 500
</code></pre><p id="3d16ee7c-448e-423c-bed4-490fe9b7f012" class="">This code defines a <strong>Flask</strong> route for a <code>/search</code> endpoint that processes <strong>POST</strong> requests. It checks for an <em>authorization token</em> in the <strong>request headers</strong>, <em>verifies</em> it, and then performs a search in a database based on the provided search term. The results are returned as <strong>JSON</strong>. This route handles customer searches based on a provided search term.</p><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="37ec742e-4105-4b01-83c0-51c9a0fbf986" class="code"><code class="language-Python">@app.route(&quot;/xxe&quot;)
def index():
    return render_template(
        &#x27;test.html&#x27;)



@app.route(&quot;/xxe_uploader&quot;, methods=[&#x27;POST&#x27;])
def hello():
    if request.method == &#x27;POST&#x27;:
        try:
	    app.logger.debug(json.dumps({&quot;event&quot;: &quot;File upload request received&quot;}))
            f = request.files[&#x27;file&#x27;]
            if f.filename == &#x27;&#x27;:
		app.logger.warning(json.dumps({&quot;event&quot;: &quot;No file selected&quot;}))
                return &quot;No file selected&quot;, 400
            
            # Generate a random filename to avoid clashes
            rand = str(random.randint(1, 100))
            fname = secure_filename(f.filename)
            file_path = os.path.join(tempfile.mkdtemp(), rand + &#x27;_&#x27; + fname)
            app.logger.debug(json.dumps({&quot;event&quot;: &quot;Saving file&quot;, &quot;file_path&quot;: file_path}))

            # Save file locally
            f.save(file_path)
            
	    
            # Access saved file
            document = Document(file_path)
            content = &#x27;\n&#x27;.join([para.text for para in document.paragraphs])
	    app.logger.debug(json.dumps({&quot;event&quot;: &quot;File content extracted&quot;}))

            # Get file details and permissions
            file_stat = os.stat(file_path)
            file_details = {
                &quot;size&quot;: file_stat.st_size,
                &quot;permissions&quot;: oct(file_stat.st_mode)[-3:],
                &quot;owner&quot;: file_stat.st_uid,
                &quot;group&quot;: file_stat.st_gid,
                &quot;last_accessed&quot;: file_stat.st_atime,
                &quot;last_modified&quot;: file_stat.st_mtime,
                &quot;created&quot;: file_stat.st_ctime,
                &quot;name&quot;: f.filename,
                &quot;format&quot;: f.content_type
            }
            log_event = {&quot;event&quot;: &quot;File details before deletion&quot;, &quot;file_details&quot;: file_details}
            app.logger.debug(json.dumps(log_event))

	    # Clean up the temporary directory
            shutil.rmtree(os.path.dirname(file_path))
            app.logger.debug(json.dumps({&quot;event&quot;: &quot;Temporary directory cleaned up&quot;, &quot;temp_dir&quot;: file_path}))
            # Render template with file content
            return render_template(&#x27;view.html&#x27;, name=content)
        
        except Exception as e:
	    app.logger.error(json.dumps({&quot;event&quot;: &quot;Error processing file&quot;, &quot;error&quot;: str(e)}))
            return str(e), 400
    
    return &quot;Method not allowed&quot;, 405
    app.logger.warning(json.dumps({&quot;event&quot;: &quot;Invalid method&quot;, &quot;method&quot;: request.method}))
</code></pre><ol type="1" id="0b5adb84-0d99-49fa-b2b5-cb8320e0f935" class="numbered-list" start="1"><li>The <code>/xxe</code> route renders a <code>test.html</code> template.</li></ol><ol type="1" id="6690b5df-ba8e-43f0-a411-1b8bd251e134" class="numbered-list" start="2"><li>The <code>/xxe_uploader</code> route handles file uploads via <strong>POST</strong> requests. It logs file upload events, saves the file locally with a <em>unique name</em>, extracts the content from the file, <em>logs file details</em>, and then cleans up the temporary directory. If successful, it renders a <code>view.html</code> template with the file content. The code includes error handling and logs various events and errors for debugging purposes.</li></ol><hr id="2b838da8-5e61-4930-94ca-932127273698"/><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="40825ab0-3b66-40f5-8076-167e831bd5a4" class="code"><code class="language-JSON" style="white-space:pre-wrap;word-break:break-all">{&quot;message&quot;: &quot;Received request to register a new customer&quot;}
{&quot;message&quot;: &quot;Received username: Inno&quot;}
{&quot;message&quot;: &quot;Received password&quot;}
{&quot;message&quot;: &quot;Received first name: Inno&quot;}
{&quot;message&quot;: &quot;Received last name: Polis&quot;}
{&quot;message&quot;: &quot;Received email: john.doe@example.com&quot;}
{&quot;message&quot;: &quot;Received credit card number: 1234-5678-9012-3456&quot;}
{&quot;message&quot;: &quot;Customer Inno has been created&quot;}</code></pre><p id="bda89793-a2e0-44f2-9627-afbf5b4a8105" class="">This approach provides a structured and machine-readable format for your logs, making it easier to analyze and integrate with various logging and monitoring tools.</p><figure id="113d6734-49e0-457a-bbfc-8ebd365e4c45" class="image"><a href="Detecting%20Vulnerable-Flask-Application%2028b07495fafd4267886f45a6a50ce273/Untitled%2085.png"><img style="width:684px" src="Detecting%20Vulnerable-Flask-Application%2028b07495fafd4267886f45a6a50ce273/Untitled%2085.png"/></a></figure><figure id="24c22bb3-2500-4911-b8b4-ca8e5ca0731f" class="image"><a href="Detecting%20Vulnerable-Flask-Application%2028b07495fafd4267886f45a6a50ce273/Untitled%2086.png"><img style="width:684px" src="Detecting%20Vulnerable-Flask-Application%2028b07495fafd4267886f45a6a50ce273/Untitled%2086.png"/></a></figure><p id="377cad51-5920-4920-89fc-c705a90a66f0" class="">You need to add a <code>&lt;localfile&gt;</code> entry to monitor the log file generated by your <strong>Flask </strong>application. Assuming your <strong>Flask</strong> logs are stored in <code>app.log</code>, you would add the following configuration:</p><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="55fcabee-06a5-4b98-b1d7-f512bd1371e2" class="code"><code class="language-Bash">&lt;localfile&gt;
    &lt;log_format&gt;syslog&lt;/log_format&gt;
    &lt;location&gt;/path/to/your/app.log&lt;/location&gt;
&lt;/localfile&gt;</code></pre><figure id="e0ecd3b1-4daf-4b75-b633-4d52ca455cff" class="image"><a href="Detecting%20Vulnerable-Flask-Application%2028b07495fafd4267886f45a6a50ce273/Untitled%2087.png"><img style="width:660px" src="Detecting%20Vulnerable-Flask-Application%2028b07495fafd4267886f45a6a50ce273/Untitled%2087.png"/></a></figure><ul id="522bbde5-0a9b-4abf-af1c-126083f676e7" class="bulleted-list"><li style="list-style-type:disc">Replace <code>/path/to/your/app.log</code> with the actual path to the log file on the host.</li></ul><ul id="5589e36a-52c6-48f8-8c5a-112fe8a3e912" class="bulleted-list"><li style="list-style-type:disc">After adding the <code>&lt;localfile&gt;</code> entry, save the changes and exit the text editor.</li></ul><ul id="15e5cb9d-1ad5-462d-ba30-b80c6ca1df6c" class="bulleted-list"><li style="list-style-type:disc">For the changes to take effect, restart the <strong>Wazuh agent</strong> service. You can do this with the following command:</li></ul><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="0fa90540-4577-4d0f-9680-30e78b609c87" class="code"><code class="language-Bash">sudo systemctl restart wazuh-agent</code></pre><figure id="0ee0eee9-d8b1-42a4-b9df-7c3440660644" class="image"><a href="Detecting%20Vulnerable-Flask-Application%2028b07495fafd4267886f45a6a50ce273/Untitled%2088.png"><img style="width:652px" src="Detecting%20Vulnerable-Flask-Application%2028b07495fafd4267886f45a6a50ce273/Untitled%2088.png"/></a></figure></div></p><hr id="db32d8d3-99ba-4611-8049-655b0a609530"/><h1 id="32fc649c-6426-4ebc-9252-7780f5bc7cce" class="">4 Detecting Attacks on Endpoints</h1><p id="0b85fc98-a6b9-4167-be1f-ef6ba9c01aaa" class="">In this section, we will focus on detecting attacks on our application&#x27;s endpoints. We will write custom decoders and rules in <strong>Wazuh</strong> to identify suspicious activities or attacks, and test these configurations to ensure they work effectively.</p><p id="3ca0bdca-a818-4581-9cc4-6fb565448861" class=""><strong>Identifying Attacks</strong></p><p id="920e4104-9f48-409f-9ada-d4337a55e250" class="">To detect attacks, we first need to identify what kind of attacks we&#x27;re looking for. Common types of attacks on web applications include:</p><ul id="f00e3b8f-f521-4c68-96d3-060eb550ae5f" class="bulleted-list"><li style="list-style-type:disc"><code>SQL Injection</code></li></ul><ul id="89f0d2c5-ceee-4c54-94df-db12b1cf0c6c" class="bulleted-list"><li style="list-style-type:disc"><code>Cross-Site Scripting (XSS)</code></li></ul><ul id="3091ab72-db34-42e7-b258-2e964e4f6381" class="bulleted-list"><li style="list-style-type:disc"><code>Command Injection</code></li></ul><ul id="c9afd597-b52f-437a-8534-0633089b6d30" class="bulleted-list"><li style="list-style-type:disc"><code>Directory Traversal</code></li></ul><ul id="5650fe8b-f4f0-4088-ac60-d312397a78c0" class="bulleted-list"><li style="list-style-type:disc"><code>Brute Force Attacks</code> </li></ul><p id="603893d8-eabf-4304-bd91-c4b6ba630613" class=""><strong>Decoders</strong></p><p id="6ed71bd8-f6a1-4e44-998d-6ca69a3ee0fa" class="">First, let&#x27;s define the <strong>decoders</strong> that will <em>parse</em> and <em>analyze</em> the logs from our <strong>Laravel</strong> application. These decoders will help extract relevant information from <strong>JSON logs</strong> and identify potential <em>unauthorized</em> access attempts.</p><p id="b18a1dfd-4926-45f9-a108-753321ebc558" class=""><strong>Wazuh</strong> already has a built-in <strong>JSON</strong> decoder that can parse <strong>JSON-formatted</strong> logs. This makes it easier to extract specific fields from the <strong>JSON</strong> logs for analysis and detection purposes.</p><p id="e9f16206-4afb-4c27-9461-1b8ee78378b9" class="">The <strong>JSON</strong> decoder in <strong>Wazuh</strong> is defined as follows:</p><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="81919183-35c7-4ca9-8ed7-57cbf1b2fdd2" class="code"><code class="language-XML" style="white-space:pre-wrap;word-break:break-all">&lt;decoder name=&quot;json&quot;&gt;
  &lt;prematch&gt;^{\\s*&quot;&lt;/prematch&gt;
  &lt;plugin_decoder&gt;JSON_Decoder&lt;/plugin_decoder&gt;
&lt;/decoder&gt;
</code></pre><p id="c68f337a-3414-431e-9096-b426207bb20a" class="">This decoder uses the <code>prematch</code> tag to identify the beginning of a <strong>JSON</strong>-formatted log line, which starts with an opening curly brace followed by whitespace and a double quote.</p><p id="e01c9ac4-a087-4324-9bcd-250269598b1b" class="">The <code>plugin_decoder</code> tag specifies that the built-in <code>JSON_Decoder</code> plugin should be used to parse the <strong>JSON</strong> content.</p><p id="a948b02b-7f80-4560-be5d-2f207e4a1797" class="">Once the <strong>JSON decoder</strong> is in place, you can easily extract specific fields from the JSON logs using the <code>field</code> tag in your <strong>Wazuh</strong> rules. For example:</p><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="680b6fea-7d77-4289-9e23-dff797555899" class="code"><code class="language-XML" style="white-space:pre-wrap;word-break:break-all">&lt;group name=&quot;flask_rules,&quot;&gt;
    &lt;rule id=&quot;100031&quot; level=&quot;10&quot;&gt;
      &lt;field name=&quot;message&quot; type=&quot;pcre2&quot;&gt;(?i)(\b(ALTER|CREATE|DELETE|DROP|EXEC(UTE)?|INSERT( +INTO)?|MERGE|SELECT|UPDATE|OR|UNION( +ALL)?)\b.*?)|&#x27;|\`|--.*|\/\*.*?\*\/&lt;/field&gt;
      &lt;mitre&gt;
        &lt;id&gt;T1190&lt;/id&gt;
      &lt;/mitre&gt;
      &lt;group&gt;attack,sql_injection,pci_dss_6.5,pci_dss_11.4,pci_dss_6.5.1,gdpr_IV_35.7.d,nist_800_53_SA.11,nist_800_53_SI.4,tsc_CC6.6,tsc_CC7.1,tsc_CC8.1,tsc_CC6.1,tsc_CC6.8,tsc_CC7.2,tsc_CC7.3,&lt;/group&gt;
      &lt;description&gt;Potential SQL attempt detected&lt;/description&gt;
    &lt;/rule&gt;
&lt;/group&gt;</code></pre><p id="fd9c53cd-6231-45b0-9aa4-7be79846b46d" class="">The provided Wazuh rule is designed to detect potential <strong>SQL injection</strong> attempts in the logs generated by the <strong>Flask</strong> application. Let&#x27;s break down the rule in detail:</p><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="78e4a1e5-7b03-461b-b672-857ae82492c3" class="code"><code class="language-XML" style="white-space:pre-wrap;word-break:break-all">&lt;group name=&quot;flask_rules,&quot;&gt;</code></pre><p id="cecf4601-76b1-4c1e-af9e-20aa9f2e29f4" class="">This defines a group named <code>flask_rules</code> that will contain the <strong>SQL injection</strong> detection rule.</p><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="7e60d43f-b196-4eef-9a2b-e50827bfac16" class="code"><code class="language-XML" style="white-space:pre-wrap;word-break:break-all">&lt;rule id=&quot;100031&quot; level=&quot;10&quot;&gt;</code></pre><p id="14288e6c-54ed-40e0-8428-6f239dfb7ff7" class="">This defines a rule with an <strong>ID</strong> of <code>100031</code> and a severity level of <strong>10 (the highest level)</strong>.</p><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="6ed6ad44-91be-47c7-844e-f398d71a03c4" class="code"><code class="language-XML" style="white-space:pre-wrap;word-break:break-all">&lt;field name=&quot;message&quot; type=&quot;pcre2&quot;&gt;(?i)(\\b(ALTER|CREATE|DELETE|DROP|EXEC(UTE)?|INSERT( +INTO)?|MERGE|SELECT|UPDATE|OR|UNION( +ALL)?)\\b.*?)|&#x27;|\\`|--.*|\\/\\*.*?\\*\\/&lt;/field&gt;</code></pre><p id="37c36489-1004-4281-9660-f2befda613c9" class="">This is the core of the rule. It uses a <strong>PCRE2</strong> regular expression to match specific patterns in the <code>message</code> field of the log entries. The regular expression looks for the following:</p><ol type="1" id="7be3dc75-5f08-4877-9553-4c224e091811" class="numbered-list" start="1"><li><strong>SQL keywords</strong>: <code>ALTER</code>, <code>CREATE</code>, <code>DELETE</code>, <code>DROP</code>, <code>EXEC(UTE)</code>, <code>INSERT (INTO)</code>, <code>MERGE</code>, <code>SELECT</code>, <code>UPDATE</code>, <code>OR</code>, <code>UNION (ALL)</code> - these are matched as whole words using <code>\b</code> (word boundary).</li></ol><ol type="1" id="9b7dbf2c-19d3-420a-93ba-ece8cb034a50" class="numbered-list" start="2"><li><strong>SQL keywords followed by any characters</strong> using <code>.*?</code></li></ol><ol type="1" id="8b229868-f9e9-499c-b74e-757b5aca8b66" class="numbered-list" start="3"><li><strong>Single quotes (&#x27;)</strong>, backticks (\`), and <strong>SQL</strong> comments (-- and /* */) - these are common <strong>SQL</strong> injection techniques.</li></ol><p id="81be7c56-ae2b-4498-8d9d-21bc1543e92a" class="">The <code>(?i)</code> at the beginning makes the matching case-insensitive.</p><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="061af97e-171a-4179-bb7d-8f9b9bc0f89e" class="code"><code class="language-XML" style="white-space:pre-wrap;word-break:break-all">&lt;mitre&gt;
  &lt;id&gt;T1190&lt;/id&gt;
&lt;/mitre&gt;
</code></pre><p id="e89b8545-e856-4b20-9b97-36a75369bbd8" class="">This maps the rule to the <strong>MITRE ATT&amp;CK</strong> technique <strong>T1190</strong> (Exploit Public-Facing Application), which is related to <strong>SQL</strong> injection attacks.</p><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="c5539c40-4851-4d3e-8519-479849c86b58" class="code"><code class="language-XML" style="white-space:pre-wrap;word-break:break-all">&lt;group&gt;attack,sql_injection,pci_dss_6.5,pci_dss_11.4,pci_dss_6.5.1,gdpr_IV_35.7.d,nist_800_53_SA.11,nist_800_53_SI.4,tsc_CC6.6,tsc_CC7.1,tsc_CC8.1,tsc_CC6.1,tsc_CC6.8,tsc_CC7.2,tsc_CC7.3,&lt;/group&gt;
</code></pre><p id="0b6d72a3-9907-4907-8180-4672482922ea" class="">This associates the rule with various compliance standards and frameworks, such as <strong>PCI DSS</strong>, <strong>GDPR</strong>, <strong>NIST 800-53</strong>, and <strong>TSC</strong>. These mappings help in compliance reporting and auditing.</p><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="3656a841-f597-4306-888f-ce0f48befc8b" class="code"><code class="language-XML" style="white-space:pre-wrap;word-break:break-all">&lt;description&gt;Potential SQL attempt detected&lt;/description&gt;
</code></pre><p id="a15d414f-8e15-43ed-9448-ddca51699882" class="">This provides a description for the rule, indicating that it detects potential <strong>SQL</strong> injection attempts.</p><p id="a2cdfd7b-a156-4a5a-b462-5d009221ce50" class="">When this rule is applied to the logs generated by the <strong>Flask</strong> application, <strong>Wazuh</strong> will scan each log entry and match the <code>message</code> field against the provided regular expression. If a match is found, indicating a potential <strong>SQL injection</strong> attempt, <strong>Wazuh</strong> will trigger an alert with the specified severity level and include the matched log entry in the alert details.</p><hr id="5450ac08-700c-4d1c-a115-78913839a54e"/><h2 id="ed36f70c-c345-4bc1-86fc-33a8e730b8aa" class="">4.1 Search</h2><p id="dc09bd8c-1034-416b-96f7-98f16799e565" class="">The <code>/search</code> endpoint is vulnerable to <strong>SQL injection</strong> due to the direct insertion of user input into the <strong>SQL query</strong> without proper sanitization. For example, the following line of code:</p><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="d3c1f733-65f3-45c6-b751-2e34bc8c66f2" class="code"><code class="language-Python" style="white-space:pre-wrap;word-break:break-all">str_query = &quot;SELECT first_name, last_name, username FROM customer WHERE username = &#x27;{}&#x27;&quot;.format(search_term)
</code></pre><p id="0e44722e-8c24-4630-828d-e310c97e6b5e" class="">If <code>search_term</code> contains malicious input like <code>admin&#x27; OR &#x27;1&#x27;=&#x27;1</code>, it can manipulate the <strong>SQL</strong> query to return unintended results.</p><p id="876daf65-782a-481a-a755-aa2a7ee80b90" class="">Since <strong>Wazuh</strong> has a built-in <strong>JSON</strong> decoder enabled by default, it can parse the logs generated by your <strong>Flask</strong> application that are formatted as <strong>JSON</strong>. This allows you to extract fields easily.</p><p id="6395400f-e7ab-46a5-8247-c86d60a6bfaf" class="">You need to create a custom rule that detects patterns indicative of <strong>SQL injection</strong> attempts. Hereâ€™s an example rule that you can add to your <strong>Wazuh</strong> rules configuration:</p><p id="e8b518f8-7766-41c9-abff-ce6de4b3fbc0" class=""><strong>Example Rule Configuration</strong>:</p><p id="54140ef6-da02-44e9-ac0a-6aadb241f344" class="">Create a new rules file in the Wazuh rules directory, typically located at <code>/var/ossec/etc/rules/</code>. You could name it <code>custom_sql_injection_rules.xml</code>.</p><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="f2653e93-1e05-4be7-a230-6e16ceaf0762" class="code"><code class="language-XML" style="white-space:pre-wrap;word-break:break-all">&lt;group name=&quot;flask_rules,&quot;&gt;
    &lt;rule id=&quot;100031&quot; level=&quot;10&quot;&gt;
      &lt;field name=&quot;message&quot; type=&quot;pcre2&quot;&gt;(?i)(\b(ALTER|CREATE|DELETE|DROP|EXEC(UTE)?|INSERT( +INTO)?|MERGE|SELECT|UPDATE|OR|UNION( +ALL)?)\b.*?)|&#x27;|\`|--.*|\/\*.*?\*\/&lt;/field&gt;
      &lt;mitre&gt;
        &lt;id&gt;T1190&lt;/id&gt;
      &lt;/mitre&gt;
      &lt;group&gt;attack,sql_injection,pci_dss_6.5,pci_dss_11.4,pci_dss_6.5.1,gdpr_IV_35.7.d,nist_800_53_SA.11,nist_800_53_SI.4,tsc_CC6.6,tsc_CC7.1,tsc_CC8.1,tsc_CC6.1,tsc_CC6.8,tsc_CC7.2,tsc_CC7.3,&lt;/group&gt;
      &lt;description&gt;Potential SQL attempt detected&lt;/description&gt;
    &lt;/rule&gt;
&lt;/group&gt;</code></pre><p id="4353542e-9411-40cd-b17e-500149168a47" class="">After adding the custom rule, restart the Wazuh manager to apply the changes:</p><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="f28538d7-e44b-4265-b48c-7109d43fa2e5" class="code"><code class="language-Shell" style="white-space:pre-wrap;word-break:break-all">sudo systemctl restart wazuh-manager
</code></pre><p id="38715895-5b26-442f-bea7-755e70e65a5c" class=""><strong>Testing the Detection</strong></p><p id="a345212d-1e6e-4d2c-9aa7-190d20d60a47" class="">To test if the detection works, you can perform a search request with an <strong>SQL injection</strong> payload, such as:</p><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="8d5e7e7c-0047-4a0b-b1ed-c1b7eef04d0d" class="code"><code class="language-JSON" style="white-space:pre-wrap;word-break:break-all">{
  &quot;search&quot;: &quot;admin&#x27; OR &#x27;1&#x27;=&#x27;1&quot;
}
</code></pre><p id="ce7fbbcc-f84e-45e3-8239-dfe4cef0af22" class="">Here is the <strong>cURL</strong> command:</p><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="5a65ed4e-bb68-4422-a1cc-c527e2e96a98" class="code"><code class="language-Bash">curl --location &#x27;http://localhost:5050/search&#x27; \
--header &#x27;Content-Type: application/json&#x27; \
--header &#x27;Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJ3ZTQ1IiwiaWF0IjoxNzIxNzMwNDI3LCJ1c2VyIjoiYWRtaW4iLCJleHAiOjE3MjE3NDQ4MjcsIm5iZiI6MTcyMTczMDQyN30.Ir4xb6bRdAWYRMumyWmPAvHMkYPzd77gruKlUfD4FIk&#x27; \
--data &#x27;{
  &quot;search&quot;: &quot;admin&#x27;\&#x27;&#x27; OR &#x27;\&#x27;&#x27;1&#x27;\&#x27;&#x27;=&#x27;\&#x27;&#x27;1&quot;
}
&#x27;</code></pre><figure id="5af59e1e-f972-4462-8afd-d3cdfcfae267" class="image"><a href="Detecting%20Vulnerable-Flask-Application%2028b07495fafd4267886f45a6a50ce273/Untitled%2089.png"><img style="width:708px" src="Detecting%20Vulnerable-Flask-Application%2028b07495fafd4267886f45a6a50ce273/Untitled%2089.png"/></a></figure><p id="7efacd8b-b852-4efa-8958-73b6482347d2" class="">Here are the logs from <code>laravel.log</code> :</p><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="fd7b7719-f135-48e3-9bd0-b62720c4addd" class="code"><code class="language-JSON">{&quot;message&quot;: &quot;Search term: admin&#x27; OR &#x27;1&#x27;=&#x27;1&quot;}
{&quot;message&quot;: &quot;Search results: [[u&#x27;Nathan&#x27;, u&#x27;Young&#x27;, u&#x27;millerjessica&#x27;], [u&#x27;Kara&#x27;, u&#x27;Kemp&#x27;, u&#x27;martineznorma&#x27;], [u&#x27;Monica&#x27;, u&#x27;Gray&#x27;, u&#x27;olsoncaitlin&#x27;], [u&#x27;Elizabeth&#x27;, u&#x27;Flores&#x27;, u&#x27;dleon&#x27;], [u&#x27;Shaun&#x27;, u&#x27;Sawyer&#x27;, u&#x27;gwagner&#x27;], [u&#x27;Inno&#x27;, u&#x27;Polis&#x27;, u&#x27;Inno&#x27;], [u&#x27;Inno&#x27;, u&#x27;Polis&#x27;, u&#x27;Inno&#x27;]]&quot;}</code></pre><figure id="116ed6a1-1848-4ad3-9ae7-ea78d29a6603" class="image"><a href="Detecting%20Vulnerable-Flask-Application%2028b07495fafd4267886f45a6a50ce273/Untitled%2090.png"><img style="width:708px" src="Detecting%20Vulnerable-Flask-Application%2028b07495fafd4267886f45a6a50ce273/Untitled%2090.png"/></a></figure><p id="e69be488-11b4-48b4-a52a-70cbdf91efde" class="">Now we can check it via <strong>Wazuh Ruleset Test</strong> tool:</p><figure id="7ee648e3-7848-4f6b-9b00-c9b856fd44f7" class="image"><a href="Detecting%20Vulnerable-Flask-Application%2028b07495fafd4267886f45a6a50ce273/Untitled%2091.png"><img style="width:708px" src="Detecting%20Vulnerable-Flask-Application%2028b07495fafd4267886f45a6a50ce273/Untitled%2091.png"/></a></figure><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="6921534f-f004-4af8-8641-ec94dc06abbc" class="code"><code class="language-Bash">**Messages:
	WARNING: (7003): &#x27;4f1e2973&#x27; token expires
	INFO: (7202): Session initialized with token &#x27;68096ff2&#x27;

**Phase 1: Completed pre-decoding.
	full event: &#x27;[2024-07-21 11:18:32] local.INFO: Request: {&quot;method&quot;:&quot;GET&quot;,&quot;url&quot;:&quot;http://localhost/vapi/api7/user/key&quot;,&quot;headers&quot;:{&quot;host&quot;:[&quot;localhost&quot;],&quot;user-agent&quot;:[&quot;curl/7.81.0&quot;],&quot;accept&quot;:[&quot;*/*&quot;],&quot;content-type&quot;:[&quot;application/json&quot;],&quot;origin&quot;:[&quot;https://bing.com&quot;]},&quot;body&quot;:[]} &#x27;

**Phase 2: Completed decoding.
	name: &#x27;laravel_logs_parent&#x27;
	parent: &#x27;laravel_logs_parent&#x27;
	body: &#x27;[]&#x27;
	headers.accept: &#x27;[&quot;*/*&quot;]&#x27;
	headers.content-type: &#x27;[&quot;application/json&quot;]&#x27;
	headers.host: &#x27;[&quot;localhost&quot;]&#x27;
	headers.origin: &#x27;[&quot;https://bing.com&quot;]&#x27;
	headers.user-agent: &#x27;[&quot;curl/7.81.0&quot;]&#x27;
	method: &#x27;GET&#x27;
	response_or_request: &#x27;Request&#x27;
	url: &#x27;http://localhost/vapi/api7/user/key&#x27;

**Phase 3: Completed filtering (rules).
	id: &#x27;100028&#x27;
	level: &#x27;8&#x27;
	description: &#x27;Unauthorized header origin: [&quot;https://bing.com&quot;] detected in GET http://localhost/vapi/api7/user/key&#x27;
	groups: &#x27;[&quot;laravel&quot;]&#x27;
	firedtimes: &#x27;1&#x27;
	mail: &#x27;false&#x27;
**Alert to be generated.

**Phase 1: Completed pre-decoding.
	full event: &#x27;[2024-07-21 11:18:32] local.INFO: Response: {&quot;status&quot;:403,&quot;headers&quot;:{&quot;cache-control&quot;:[&quot;no-cache, private&quot;],&quot;date&quot;:[&quot;Sun, 21 Jul 2024 11:18:32 GMT&quot;],&quot;content-type&quot;:[&quot;application/json&quot;]},&quot;body&quot;:&quot;{\&quot;success\&quot;:\&quot;false\&quot;,\&quot;cause\&quot;:\&quot;userNotLoggedIn\&quot;}&quot;} &#x27;

**Phase 2: Completed decoding.
	name: &#x27;laravel_logs_parent&#x27;
	parent: &#x27;laravel_logs_parent&#x27;
	body: &#x27;{&quot;success&quot;:&quot;false&quot;,&quot;cause&quot;:&quot;userNotLoggedIn&quot;}&#x27;
	headers.cache-control: &#x27;[&quot;no-cache, private&quot;]&#x27;
	headers.content-type: &#x27;[&quot;application/json&quot;]&#x27;
	headers.date: &#x27;[&quot;Sun, 21 Jul 2024 11:18:32 GMT&quot;]&#x27;
	response_or_request: &#x27;Response&#x27;
	status: &#x27;403&#x27;</code></pre><p id="965b2fa4-4080-46d2-9523-593431eede8c" class=""><strong>Wazuh</strong> <em>processes</em> and <em>analyzes</em> <strong>log</strong> entries from a <strong>Flask</strong> application to detect potential<strong> SQL</strong> injection attempts. It highlights the importance of monitoring user inputs, especially in search queries, and the effectiveness of using predefined rules to identify malicious patterns.</p><hr id="41b93d1d-1d29-40e5-8dcf-56235007b523"/><h2 id="549a142e-437c-48f6-9d7f-10c2ecd2e8dc" class="">4.2 XXE</h2><p id="e64a9c3a-801a-4b58-9ce7-746190d6e07f" class="">The <code>/xxe_uploader</code> endpoint allows users to upload files, which can be exploited if the application processes <strong>XML</strong> files without proper validation. An attacker could upload a malicious <strong>XML</strong> file that includes external entities, potentially allowing them to read sensitive files on the server or even execute commands.</p><h3 id="9c62885d-5616-40f3-b398-a9bca78d0c4d" class="">4.2.1 Enabling File Integrity Monitoring (FIM) in Wazuh</h3><p id="71235391-8f51-4c00-96da-ea4413340de1" class="">To monitor for potential <strong>XXE</strong> attacks, you should enable the <strong>File Integrity Monitoring (FIM)</strong> module in Wazuh and configure it to monitor the <code>/tmp</code> directory where temporary files are created.</p><ul id="8dd88218-151f-4d06-987f-c28077283da3" class="bulleted-list"><li style="list-style-type:disc"><strong>Add the </strong><code><strong>/tmp</strong></code><strong> Directory</strong>: Ensure that the <code>/tmp</code> directory is included in the <strong>FIM</strong> configuration for the host. This allows Wazuh to monitor changes to files in that directory.<figure id="581b9247-19dc-40da-a89e-4f0de0b030e4" class="image"><a href="Detecting%20Vulnerable-Flask-Application%2028b07495fafd4267886f45a6a50ce273/Untitled%2092.png"><img style="width:680px" src="Detecting%20Vulnerable-Flask-Application%2028b07495fafd4267886f45a6a50ce273/Untitled%2092.png"/></a></figure></li></ul><h3 id="c9d5b141-7541-4192-9771-96d42823b3bf" class="">4.2.2 Docker Considerations</h3><p id="294d2f13-e11a-406b-a241-ff1fbc885661" class="">If your application is running inside a Docker container, you need to monitor the appropriate path within the container. You can do this by adding the <code>/tmp</code> folder under the container&#x27;s merged directory, typically located at:</p><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="6f1daef9-fed7-42ea-9404-2ec540b863dc" class="code"><code class="language-Plain Text" style="white-space:pre-wrap;word-break:break-all">/var/lib/docker/overlay2/&lt;container_id&gt;/merged/tmp
</code></pre><p id="976d771d-f376-4bdc-b5f3-b351e43e0041" class="">This allows Wazuh to detect any changes to temporary files created by the application.</p><h3 id="24b02058-9975-4429-b852-2e5791b8ca17" class="">4.2.3. Enhancing Application Logging</h3><p id="239abf17-e482-4b26-88aa-3522becbcb12" class="">To aid in detecting potential XXE attacks, you can enhance the logging in your <strong>Flask</strong> application to record details about uploaded files. This can include:</p><ul id="3a691542-d694-4127-a428-03c4dbcb05df" class="bulleted-list"><li style="list-style-type:disc"><strong>File Name</strong>: Log the name of the uploaded file.</li></ul><ul id="84dd721f-6a28-49f2-854b-4b5983971fc0" class="bulleted-list"><li style="list-style-type:disc"><strong>File Extension</strong>: Log the file extension to ensure it matches expected types (e.g., XML).</li></ul><ul id="3be521cc-039d-42be-8796-d06d45b6ad45" class="bulleted-list"><li style="list-style-type:disc"><strong>File Size</strong>: Log the size of the uploaded file to identify unusually large files.</li></ul><p id="fdf9692b-ebc7-4076-8631-7c099d60c6c0" class=""><strong>Example Logging Implementation</strong>:</p><p id="9a6596fd-8485-4ab2-8749-49c38b20b493" class="">The provided code is a Flask route handler for uploading and processing XML files. The route is defined at <code>&quot;/xxe_uploader&quot;</code> and accepts <code>POST</code> requests. Here&#x27;s a detailed breakdown of what the code does:</p><p id="85ae73f8-e637-4f83-b0de-560add6545e0" class="">You can modify the <code>/xxe_uploader</code> endpoint like this:</p><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="d0e6d826-933e-402b-b0b5-6fef5bc8d4ed" class="code"><code class="language-Python" style="white-space:pre-wrap;word-break:break-all">@app.route(&quot;/xxe_uploader&quot;, methods=[&#x27;POST&#x27;])
def hello():
    if request.method == &#x27;POST&#x27;:
        try:
	    app.logger.debug(json.dumps({&quot;event&quot;: &quot;File upload request received&quot;}))
            f = request.files[&#x27;file&#x27;]
            if f.filename == &#x27;&#x27;:
		app.logger.warning(json.dumps({&quot;event&quot;: &quot;No file selected&quot;}))
                return &quot;No file selected&quot;, 400
            
            # Generate a random filename to avoid clashes
            rand = str(random.randint(1, 100))
            fname = secure_filename(f.filename)
            file_path = os.path.join(tempfile.mkdtemp(), rand + &#x27;_&#x27; + fname)
            app.logger.debug(json.dumps({&quot;event&quot;: &quot;Saving file&quot;, &quot;file_path&quot;: file_path}))

            # Save file locally
            f.save(file_path)
            
	    
            # Access saved file
            document = Document(file_path)
            content = &#x27;\n&#x27;.join([para.text for para in document.paragraphs])
	    app.logger.debug(json.dumps({&quot;event&quot;: &quot;File content extracted&quot;}))

            # Get file details and permissions
            file_stat = os.stat(file_path)
            file_details = {
                &quot;size&quot;: file_stat.st_size,
                &quot;permissions&quot;: oct(file_stat.st_mode)[-3:],
                &quot;owner&quot;: file_stat.st_uid,
                &quot;group&quot;: file_stat.st_gid,
                &quot;last_accessed&quot;: file_stat.st_atime,
                &quot;last_modified&quot;: file_stat.st_mtime,
                &quot;created&quot;: file_stat.st_ctime,
                &quot;name&quot;: f.filename,
                &quot;format&quot;: f.content_type
            }
            log_event = {&quot;event&quot;: &quot;File details before deletion&quot;, &quot;file_details&quot;: file_details}
            app.logger.debug(json.dumps(log_event))

	    # Clean up the temporary directory
            shutil.rmtree(os.path.dirname(file_path))
            app.logger.debug(json.dumps({&quot;event&quot;: &quot;Temporary directory cleaned up&quot;, &quot;temp_dir&quot;: file_path}))
            # Render template with file content
            return render_template(&#x27;view.html&#x27;, name=content)
        
        except Exception as e:
	    app.logger.error(json.dumps({&quot;event&quot;: &quot;Error processing file&quot;, &quot;error&quot;: str(e)}))
            return str(e), 400
    
    return &quot;Method not allowed&quot;, 405
    app.logger.warning(json.dumps({&quot;event&quot;: &quot;Invalid method&quot;, &quot;method&quot;: request.method}))</code></pre><ol type="1" id="7379465e-f6b8-4948-b27e-26fd2f650a4b" class="numbered-list" start="1"><li><strong>Route Definition and Method Check:</strong><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="2a5d18fe-8a55-433b-a385-211b6d471762" class="code"><code class="language-Python" style="white-space:pre-wrap;word-break:break-all">@app.route(&quot;/xxe_uploader&quot;, methods=[&#x27;POST&#x27;])
def hello():
    if request.method == &#x27;POST&#x27;:
</code></pre></li></ol><ol type="1" id="982e7990-76fb-48e4-8207-66994d386a79" class="numbered-list" start="2"><li><strong>Logging File Upload Request:</strong><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="95da3bdc-584a-42c0-9bc1-7e5e48f92f72" class="code"><code class="language-Python" style="white-space:pre-wrap;word-break:break-all">app.logger.debug(json.dumps({&quot;event&quot;: &quot;File upload request received&quot;}))
</code></pre><p id="5b298d8d-fd6c-475d-aeca-f8ca58b49c7e" class="">A debug log entry is created to indicate that a file upload request has been received.</p></li></ol><ol type="1" id="c7190d36-d042-4630-a167-d0050ae93136" class="numbered-list" start="3"><li><strong>File Retrieval and Validation:</strong><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="4123dde1-3540-44fe-9d6c-282d77b06e21" class="code"><code class="language-Python" style="white-space:pre-wrap;word-break:break-all">f = request.files[&#x27;file&#x27;]
if f.filename == &#x27;&#x27;:
    app.logger.warning(json.dumps({&quot;event&quot;: &quot;No file selected&quot;}))
    return &quot;No file selected&quot;, 400
</code></pre><p id="acd8ab5a-7625-43f7-9f30-fe0c6cf5d41d" class="">The uploaded file is retrieved from the request. If no file is selected, a warning log entry is created, and a<strong> 400 Bad Request response</strong> is returned.</p></li></ol><ol type="1" id="95b9130e-b8df-404b-8a61-65f119250cde" class="numbered-list" start="4"><li><strong>Generating a Random Filename:</strong><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="5d552314-b48a-4670-aea7-3c5e656bbece" class="code"><code class="language-Python" style="white-space:pre-wrap;word-break:break-all">rand = str(random.randint(1, 100))
fname = secure_filename(f.filename)
file_path = os.path.join(tempfile.mkdtemp(), rand + &#x27;_&#x27; + fname)
app.logger.debug(json.dumps({&quot;event&quot;: &quot;Saving file&quot;, &quot;file_path&quot;: file_path}))
</code></pre><p id="16d47731-81d1-4c7f-8ede-4ba833e1ed85" class="">A random integer between 1 and 100 is generated to create a unique filename. The original filename is sanitized using <code>secure_filename</code>, and a temporary directory is created to store the file securely. The file path is logged for debugging purposes.</p></li></ol><ol type="1" id="6c9b1652-7e2b-4c2b-9b46-2f3664f7b9d4" class="numbered-list" start="5"><li><strong>Saving the File Locally:</strong><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="114963ac-dc39-4852-9ef8-f69d89687649" class="code"><code class="language-Python" style="white-space:pre-wrap;word-break:break-all">f.save(file_path)
</code></pre><p id="f291bf0e-260a-441d-b588-1ebeb76dbb6b" class="">The file is saved to the generated file path.</p></li></ol><ol type="1" id="907a2d48-ac19-44e0-b6f8-6da2975e3832" class="numbered-list" start="6"><li><strong>Processing the Saved File:</strong><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="0b89e117-7be2-42a2-94b3-4e3a0e1bff71" class="code"><code class="language-Python" style="white-space:pre-wrap;word-break:break-all">document = Document(file_path)
content = &#x27;\\n&#x27;.join([para.text for para in document.paragraphs])
app.logger.debug(json.dumps({&quot;event&quot;: &quot;File content extracted&quot;}))
</code></pre><p id="7bbb4a3d-0dd5-435a-9176-3b1c34fb6900" class="">The saved file is processed using the <code>Document</code> class (likely from <code>python-docx</code>), and its content is extracted into a string. A debug log entry is created to indicate that the file content has been successfully extracted.</p></li></ol><ol type="1" id="b069495a-176a-4d8c-bc03-a3ae88aa8418" class="numbered-list" start="7"><li><strong>Retrieving File Details:</strong><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="7327a5b6-8358-4de5-afc0-f915562e8297" class="code"><code class="language-Python" style="white-space:pre-wrap;word-break:break-all">file_stat = os.stat(file_path)
file_details = {
    &quot;size&quot;: file_stat.st_size,
    &quot;permissions&quot;: oct(file_stat.st_mode)[-3:],
    &quot;owner&quot;: file_stat.st_uid,
    &quot;group&quot;: file_stat.st_gid,
    &quot;last_accessed&quot;: file_stat.st_atime,
    &quot;last_modified&quot;: file_stat.st_mtime,
    &quot;created&quot;: file_stat.st_ctime,
    &quot;name&quot;: f.filename,
    &quot;format&quot;: f.content_type
}
log_event = {&quot;event&quot;: &quot;File details before deletion&quot;, &quot;file_details&quot;: file_details}
app.logger.debug(json.dumps(log_event))
</code></pre><p id="90976298-ed8b-4e9a-819f-72d32cc1dd0c" class="">The file&#x27;s metadata (size, permissions, owner, group, timestamps) is retrieved and logged.</p></li></ol><ol type="1" id="980f3370-23a7-44b3-96bc-7ad7d2317133" class="numbered-list" start="8"><li><strong>Cleaning Up:</strong><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="cd0233aa-9d7f-4824-8e85-bc36227ed0fa" class="code"><code class="language-Python" style="white-space:pre-wrap;word-break:break-all">shutil.rmtree(os.path.dirname(file_path))
app.logger.debug(json.dumps({&quot;event&quot;: &quot;Temporary directory cleaned up&quot;, &quot;temp_dir&quot;: file_path}))
</code></pre><p id="2fdf58a3-536b-4ad6-b61e-e1e7db79d281" class="">The temporary directory containing the uploaded file is deleted, and a debug log entry is created to confirm the cleanup.</p></li></ol><ol type="1" id="fda11081-cd1e-49cd-9a29-e9281488dc37" class="numbered-list" start="9"><li><strong>Returning the Content:</strong><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="667457df-5c5f-4c77-9a9e-e56a80db3d7f" class="code"><code class="language-Python" style="white-space:pre-wrap;word-break:break-all">return render_template(&#x27;view.html&#x27;, name=content)
</code></pre><p id="689e8180-a89c-4647-bfc8-e1f4857983cc" class="">The extracted content is rendered using a template (<code>view.html</code>) and returned to the client.</p></li></ol><ol type="1" id="8ba37044-1655-42b1-8de2-cb7c3dfeafe6" class="numbered-list" start="10"><li><strong>Error Handling:</strong><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="b9390618-a4ea-48f5-a7b1-4b8e77412d69" class="code"><code class="language-Python" style="white-space:pre-wrap;word-break:break-all">except Exception as e:
    app.logger.error(json.dumps({&quot;event&quot;: &quot;Error processing file&quot;, &quot;error&quot;: str(e)}))
    return str(e), 400
</code></pre><p id="8243ad7e-5940-41b0-83a6-2f5d1f184db7" class="">If any exception occurs during processing, an error log entry is created, and a 400 Bad Request response is returned with the error message.</p></li></ol><ol type="1" id="39697af9-f497-4487-b271-bf7555906497" class="numbered-list" start="11"><li><strong>Handling Invalid Methods:</strong><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="535e6947-25e5-453b-b907-a150233131aa" class="code"><code class="language-Python" style="white-space:pre-wrap;word-break:break-all">return &quot;Method not allowed&quot;, 405
app.logger.warning(json.dumps({&quot;event&quot;: &quot;Invalid method&quot;, &quot;method&quot;: request.method}))
</code></pre><p id="a3bb1172-031a-4626-9a2f-edc00bb0ba54" class="">If the request method is not <code>POST</code>, a 405 Method Not Allowed response is returned, and a warning log entry is created.</p></li></ol><p id="a48c42b9-43c1-44d1-9920-b2371367d092" class=""><strong>So we can try to test and see what we get in logs:</strong></p><figure id="026e68ae-2eac-4b93-ab36-9e2712d8c246" class="image"><a href="Detecting%20Vulnerable-Flask-Application%2028b07495fafd4267886f45a6a50ce273/Untitled%2093.png"><img style="width:708px" src="Detecting%20Vulnerable-Flask-Application%2028b07495fafd4267886f45a6a50ce273/Untitled%2093.png"/></a></figure><p id="a578476d-d679-4a5b-93b9-bca860e3f0f3" class=""><strong>The result of the executed command:</strong></p><figure id="25c853dd-f29b-4a85-86af-7f983be91629" class="image"><a href="Detecting%20Vulnerable-Flask-Application%2028b07495fafd4267886f45a6a50ce273/Untitled%2094.png"><img style="width:708px" src="Detecting%20Vulnerable-Flask-Application%2028b07495fafd4267886f45a6a50ce273/Untitled%2094.png"/></a></figure><p id="e96440c1-255a-45f6-b70e-de5431a62228" class=""><strong>The running application logs:</strong></p><figure id="c6d61774-fae8-4083-88d7-da594be17f54" class="image"><a href="Detecting%20Vulnerable-Flask-Application%2028b07495fafd4267886f45a6a50ce273/Untitled%2095.png"><img style="width:708px" src="Detecting%20Vulnerable-Flask-Application%2028b07495fafd4267886f45a6a50ce273/Untitled%2095.png"/></a></figure><p id="b61bb0f1-ab80-41e2-93b4-d6233e13cf95" class=""><strong>The final logs which will be save in </strong><code><strong>app.log</strong></code></p><figure id="c2ace640-b6f7-42a8-baf7-b2231f13f511" class="image"><a href="Detecting%20Vulnerable-Flask-Application%2028b07495fafd4267886f45a6a50ce273/Untitled%2096.png"><img style="width:1920px" src="Detecting%20Vulnerable-Flask-Application%2028b07495fafd4267886f45a6a50ce273/Untitled%2096.png"/></a></figure><ol type="1" id="c9bd5635-8aba-4e5d-a993-e0db5b68cb64" class="numbered-list" start="1"><li><strong>File Upload Request</strong>:<ul id="ba63c69f-8df7-46c3-b7a8-010e22e9c4ca" class="bulleted-list"><li style="list-style-type:disc"><strong>Log Entry</strong>: <code>{&quot;message&quot;: &quot;{\\&quot;event\\&quot;: \\&quot;File upload request received\\&quot;}&quot;}</code></li></ul><ul id="0a65075a-5a92-4500-889a-450af5567244" class="bulleted-list"><li style="list-style-type:disc">This log indicates that a file upload request has been received by the application.</li></ul></li></ol><ol type="1" id="f71e938c-d975-4ec5-aeb0-a608307c0943" class="numbered-list" start="2"><li><strong>Saving File</strong>:<ul id="578c30f1-76c2-49d2-a0d3-130aea1b3a10" class="bulleted-list"><li style="list-style-type:disc"><strong>Log Entry</strong>: <code>{&quot;message&quot;: &quot;{\\&quot;event\\&quot;: \\&quot;Saving file\\&quot;, \\&quot;file_path\\&quot;: \\&quot;/tmp/tmpocGxSg/46_xxe.docx\\&quot;}&quot;}</code></li></ul><ul id="adfe1921-5b9c-4bfd-b3d0-d1ddf9fa7ca6" class="bulleted-list"><li style="list-style-type:disc">This log shows that the application is saving the uploaded file to a temporary directory (<code>/tmp/tmpocGxSg/46_xxe.docx</code>).</li></ul></li></ol><ol type="1" id="1786ac32-ff0c-4389-8650-41f28f14238e" class="numbered-list" start="3"><li><strong>File Content Extraction</strong>:<ul id="74150eb6-04f5-4b4f-9645-f5fa595220b2" class="bulleted-list"><li style="list-style-type:disc"><strong>Log Entry</strong>: <code>{&quot;message&quot;: &quot;{\\&quot;event\\&quot;: \\&quot;File content extracted\\&quot;}&quot;}</code></li></ul><ul id="e6668365-f145-4555-a5d5-e25ad593b971" class="bulleted-list"><li style="list-style-type:disc">This indicates that the content of the uploaded file has been extracted, which is a critical step in processing the file.</li></ul></li></ol><ol type="1" id="e76bedf4-f51e-470a-b2e2-e0a7bb48abca" class="numbered-list" start="4"><li><strong>File Details Before Deletion</strong>:<ul id="5201fae2-aa05-4374-b808-46dd521273f7" class="bulleted-list"><li style="list-style-type:disc"><strong>Log Entry</strong>: <code>{&quot;message&quot;: &quot;{\\&quot;event\\&quot;: \\&quot;File details before deletion\\&quot;, \\&quot;file_details\\&quot;: {\\&quot;last_accessed\\&quot;: 1721733924.8265226, \\&quot;group\\&quot;: 1000, \\&quot;name\\&quot;: \\&quot;xxe.docx\\&quot;, \\&quot;last_modified\\&quot;: 1721733924.8225224, \\&quot;created\\&quot;: 1721733924.8225224, \\&quot;owner\\&quot;: 1000, \\&quot;format\\&quot;: \\&quot;application/vnd.openxmlformats-officedocument.wordprocessingml.document\\&quot;, \\&quot;permissions\\&quot;: \\&quot;664\\&quot;, \\&quot;size\\&quot;: 42139}}&quot;}</code></li></ul><ul id="36fb715f-9b83-4ca4-8bc3-a7969ec8d313" class="bulleted-list"><li style="list-style-type:disc">This log provides detailed information about the uploaded file, including its name, format, permissions, and size. This information can be useful for monitoring and detecting unusual file uploads.</li></ul></li></ol><ol type="1" id="fe55ae6c-b109-4b32-8ef2-404a5a1b8871" class="numbered-list" start="5"><li><strong>Temporary Directory Cleaned Up</strong>:<ul id="1eb7a52e-7f04-4fd7-9c63-478732a0c10b" class="bulleted-list"><li style="list-style-type:disc"><strong>Log Entry</strong>: <code>{&quot;message&quot;: &quot;{\\&quot;event\\&quot;: \\&quot;Temporary directory cleaned up\\&quot;, \\&quot;temp_dir\\&quot;: \\&quot;/tmp/tmpocGxSg/46_xxe.docx\\&quot;}&quot;}</code></li></ul><ul id="4be56fdc-b1d4-428d-be54-5b4fc86f4f1f" class="bulleted-list"><li style="list-style-type:disc">This indicates that the temporary directory used for the file has been cleaned up after processing, which is a good practice to prevent lingering temporary files.</li></ul></li></ol><p id="bddd669c-3a27-45a2-8bb8-b0d42de1501f" class="">To detect potential <strong>XXE injection</strong> attempts based on the logs, you can create a custom <strong>Wazuh</strong> rule that looks for specific patterns in the log entries, especially focusing on <strong>XML-</strong>related file uploads.</p><h1 id="554cb541-0508-40e0-9963-44dc907a618b" class="">Conclusion</h1><p id="afc50c37-018c-4b93-b5fc-40516ea8eb4d" class="">The <strong>Vulnerable Flask Application</strong> project provides an invaluable learning environment for <em>understanding</em> and <em>mitigating</em> common web vulnerabilities. Through hands-on interaction, security enthusiasts, software developers, and students can deepen their knowledge of web security concepts and techniques. By simulating <em>real-life</em> vulnerabilities, the project offers practical insights into identifying and addressing security risks in web applications.</p><p id="3510f71c-cdac-4357-92d5-653ceee8a3ba" class="">Integrating <strong>Wazuh</strong> for detection enhances the project&#x27;s educational value, offering a comprehensive view of <em>security monitoring</em> and <em>incident response</em>. The detailed logging strategies outlined in this guide further augment the ability to <em>trace</em>, <em>debug</em>, and <em>manage application activities effectively</em>, ensuring that potential security issues are promptly identified and mitigated.</p><p id="7b126676-a73f-4420-8d69-aa7dadce3a66" class="">By following this guide, users can develop a robust understanding of both offensive and defensive security measures in a<strong> Flask-based</strong> web application. The skills and knowledge gained from this project will be instrumental in building more secure web applications and fostering a proactive security mindset in their professional endeavors.</p><p id="428bdea5-833b-4aef-900a-aef0e977e6a5" class="">
</p></div></article><span class="sans" style="font-size:14px;padding-top:2em"></span></body></html>